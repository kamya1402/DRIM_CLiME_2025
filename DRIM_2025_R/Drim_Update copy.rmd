---
title: "DRIM Update"
author: "Kamya Khandelwal"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    code_download: true
    theme: journal  
---

```{r knitting parameters, include=FALSE}

# Knitting Parameters

  knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    message = FALSE,
    out.width = '100%',
    fig.retina =3
  )
```



```{r set up, warning=FALSE, message=FALSE, results='hide'}

# Load libraries
library(readxl)
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(tidycensus)
library(tidyverse)
library(ggplot2)
library(sf)
library(tmap)
library(tigris)
library(ggthemes)
library(purrr)
library(scales)
library(ggrepel)  # Helps prevent text overlap
library(ggcorrplot)
library(plotly)
library(reshape2)

# Census API key from https://api.census.gov/data/key_signup.html
census_api_key("7a0a7e8bbee07791cd0618b03c7374e384173a2e",overwrite=TRUE)

# Invoke color palettes to be used
palette <- c('#feedde', '#fdbe85', '#fd8d3c', '#e6550d', '#a63603')

palettea <- c("#EA526F","#E76B74","#D7AF70","#937D64","#585B56")

paletteb <- c("#f7b267", "#f79d65", "#f4845f", "#f27059", "#f25c54")

palettec <- c("#fde725","#5ec962","#21918c","#3b528b","#440154")

paletted <- c("#25CB10", "#5AB60C", "#8FA108", "#C48C04", "#FA7800")

palettee <- c("#ffd700","#ffb14e","#ea5f94","#9d02d7","#0000ff")

palettef <- c('#fdae61','#d7191c','#2c7bb6','#ffffbf','#abd9e9')

paletteg <- c("#981FAC","#CB0F8B","#FF006A","#FE4C35","#FE9900")

paletteh <- c("#981FAC","#FF006A","#FE4C35","#FE9900")

palettei <- c("#981FAC","#FF006A")

# Theme functions
mapTheme <- function(base_size = 12) {
  theme(
    text = element_text( color = "black"),
    plot.title = element_text(size = 15,colour = "black"),
    plot.subtitle=element_text(face="italic"),
    plot.caption=element_text(hjust=0),
    axis.ticks = element_blank(),
    panel.background = element_blank(),axis.title = element_blank(),
    axis.text = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=2),
    strip.text.x = element_text(size = 14))
}

plotTheme <- function(base_size = 12) {
  theme(
    text = element_text( color = "black"),
    plot.title = element_text(color = "darkred", size=15, face="bold"),
    plot.subtitle = element_text(face="italic"),
    plot.caption = element_text(hjust=0),
    axis.ticks = element_blank(),
    panel.background = element_blank(),
    panel.grid.major = element_line("grey80", size = 0.1),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=2),
    strip.background = element_rect(fill = "grey80", color = "white"),
    strip.text = element_text(size=12),
    axis.title = element_text(size=12),
    axis.text = element_text(size=10),
    plot.background = element_blank(),
    legend.background = element_blank(),
    legend.title = element_text(colour = "black", face = "italic"),
    legend.text = element_text(colour = "black", face = "italic"),
    strip.text.x = element_text(size = 14)
  )
}

```


``` {r base data, message=FALSE, warning=FALSE, message=FALSE, results='hide'}

# Load census data
acs_2023 <- load_variables(year = 2023, dataset = "acs5", cache = TRUE) #this is 2023 5-year acs
acs_2022 <- load_variables(year = 2022, dataset = "acs5", cache = TRUE) #this is 2022 5-year acs
acs_2021 <- load_variables(year = 2021, dataset = "acs5", cache = TRUE) #this is 2021 5-year acs
acs_2020 <- load_variables(year = 2020, dataset = "acs5", cache = TRUE) #this is 2020 5-year acs
acs_2019 <- load_variables(year = 2019, dataset = "acs5", cache = TRUE) #this is 2019 5-year acs
acs_2018 <- load_variables(year = 2018, dataset = "acs5", cache = TRUE) #this is 2018 5-year acs
acs_2017 <- load_variables(year = 2017, dataset = "acs5", cache = TRUE) #this is 2017 5-year acs
acs_2016 <- load_variables(year = 2016, dataset = "acs5", cache = TRUE) #this is 2016 5-year acs
acs_2015 <- load_variables(year = 2015, dataset = "acs5", cache = TRUE) #this is 2015 5-year acs
acs_2014 <- load_variables(year = 2014, dataset = "acs5", cache = TRUE) #this is 2014 5-year acs
acs_2013 <- load_variables(year = 2013, dataset = "acs5", cache = TRUE) #this is 2013 5-year acs
acs_2012 <- load_variables(year = 2012, dataset = "acs5", cache = TRUE) #this is 2012 5-year acs
acs_2011 <- load_variables(year = 2011, dataset = "acs5", cache = TRUE) #this is 2011 5-year acs
acs_2010 <- load_variables(year = 2010, dataset = "acs5", cache = TRUE) #this is 2010 5-year acs
dc_2020 <- load_variables(2020, "pl", cache = TRUE) #this is 2020 decennial, p1 because only restricted data available for 2020 DC
dc_2010 <- load_variables(2010, "pl", cache = TRUE) #this is 2010 decennial
dc_2000 <- load_variables(2000, "pl", cache = TRUE) #this is 2000 decennial

# Define ACS Variables for Newark Displacement & Gentrification Analysis
vars_acs_2023 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    family_without_health_insurance = "C27021_005",
    nonfamily_without_health_insuracne = "C27021_015",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    no_internet_access = "B28002_013", # households with no internet access
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2023

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2023 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2023,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Read the CSV file containing Newark census tracts
newark_tracts <- read_csv("Newark_CT_Geographies_3807320187672480848.csv") 

# Read the CSV file containing Newark neighborhoods 
newark_nbd <- read_csv("Newark_Nbd_Geographies_449486632812707134.csv") 

# The column with tract GEOIDs is named 'GEOID'
newark_tract_geoids <- as.character(newark_tracts$GEOID)  

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2023 <- tract_data_2023 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2023)

# Ensure Newark data is in sf format
newark_tract_2023 <- newark_tract_2023 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2023 <- newark_tract_2023 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2023)

# Remove columns with "moe" in their names
newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2023"
colnames(newark_tract_wide_2023) <- gsub("estimate", "2023", colnames(newark_tract_wide_2023))

# Remove "; Essex County; New Jersey" from the NAME column
newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  mutate(NAME = str_replace(NAME, "; Essex County; New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2023)




# ACS 2022 data

vars_acs_2022 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    family_without_health_insurance = "C27021_005",
    nonfamily_without_health_insuracne = "C27021_015",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    no_internet_access = "B28002_013", # households with no internet access
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2022

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2022 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2022,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)


# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2022 <- tract_data_2022 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2022)

# Ensure Newark data is in sf format
newark_tract_2022 <- newark_tract_2022 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2022 <- newark_tract_2022 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2022)

# Remove columns with "moe" in their names
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2022"
colnames(newark_tract_wide_2022) <- gsub("estimate", "2022", colnames(newark_tract_wide_2022))

# Remove "; Essex County; New Jersey" from the NAME column
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  mutate(NAME = str_replace(NAME, "; Essex County; New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2022)




# ACS 2021 data

vars_acs_2021 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    family_without_health_insurance = "C27021_005",
    nonfamily_without_health_insuracne = "C27021_015",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    no_internet_access = "B28002_013", # households with no internet access
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2021

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2021 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2021,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)


# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2021 <- tract_data_2021 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2021)

# Ensure Newark data is in sf format
newark_tract_2021 <- newark_tract_2021 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2021 <- newark_tract_2021 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2021)

# Remove columns with "moe" in their names
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2021"
colnames(newark_tract_wide_2021) <- gsub("estimate", "2021", colnames(newark_tract_wide_2021))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2021)



# ACS 2020 data

vars_acs_2020 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    family_without_health_insurance = "C27021_005",
    nonfamily_without_health_insuracne = "C27021_015",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    no_internet_access = "B28002_013", # households with no internet access
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2020

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2020 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2020,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)


# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2020 <- tract_data_2020 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2020)

# Ensure Newark data is in sf format
newark_tract_2020 <- newark_tract_2020 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2020 <- newark_tract_2020 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2020)

# Remove columns with "moe" in their names
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2020"
colnames(newark_tract_wide_2020) <- gsub("estimate", "2020", colnames(newark_tract_wide_2020))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2020)




# ACS 2019 data

vars_acs_2019 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    family_without_health_insurance = "C27021_005",
    nonfamily_without_health_insuracne = "C27021_015",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    no_internet_access = "B28002_013", # households with no internet access
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2019

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2019 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2019,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2019 <- tract_data_2019 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2019)

# Ensure Newark data is in sf format
newark_tract_2019 <- newark_tract_2019 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2019 <- newark_tract_2019 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2019)

# Remove columns with "moe" in their names
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2019"
colnames(newark_tract_wide_2019) <- gsub("estimate", "2019", colnames(newark_tract_wide_2019))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2019)




# ACS 2018 data

vars_acs_2018 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    family_without_health_insurance = "C27021_005",
    nonfamily_without_health_insuracne = "C27021_015",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    no_internet_access = "B28002_013", # households with no internet access
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2018

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2018 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2018,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2018 <- tract_data_2018 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2018)

# Ensure Newark data is in sf format
newark_tract_2018 <- newark_tract_2018 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2018 <- newark_tract_2018 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2018)

# Remove columns with "moe" in their names
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2018"
colnames(newark_tract_wide_2018) <- gsub("estimate", "2018", colnames(newark_tract_wide_2018))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2018)






# ACS 2017 data

vars_acs_2017 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    family_without_health_insurance = "C27021_005",
    nonfamily_without_health_insuracne = "C27021_015",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    no_internet_access = "B28002_013", # households with no internet access
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2017

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2017 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2017,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2017 <- tract_data_2017 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2017)

# Ensure Newark data is in sf format
newark_tract_2017 <- newark_tract_2017 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2017 <- newark_tract_2017 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2017)

# Remove columns with "moe" in their names
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2017"
colnames(newark_tract_wide_2017) <- gsub("estimate", "2017", colnames(newark_tract_wide_2017))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2017)






# ACS 2016 data

vars_acs_2016 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2016

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2016 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2016,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2016 <- tract_data_2016 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2016)

# Ensure Newark data is in sf format
newark_tract_2016 <- newark_tract_2016 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2016 <- newark_tract_2016 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2016)

# Remove columns with "moe" in their names
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2016"
colnames(newark_tract_wide_2016) <- gsub("estimate", "2016", colnames(newark_tract_wide_2016))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2016)






# ACS 2015 data

vars_acs_2015 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B15003_022",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    highschool_dropout = "B15003_002", # adults 25+ without high school diploma
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B23025_002", # total workers or civilian labor force
    total_employed = "B23025_004", # total employed population
    total_unemployed = "B23025_005",
    remote_workers = "B08006_017", # working from home (remote work trends)
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Health (Limited ACS Data on Health, but Housing & Poverty Affect Health Outcomes)
    disabled_population = "B18101_001",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    rent_2500_2999 = "B25063_024",
    rent_3000_3499 = "B25063_025",
    rent_3500_plus = "B25063_026",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    units_built_2020plus = "B25034_002",
    units_built_2010_2019 = "B25034_003",
    units_built_2000_2009 = "B25034_004",
    households_cash_rent = "B25063_002",
    households_no_cash_rent = "B25063_027",
    overcrowded_owner_occupied_households = "B25014_007", # Households experiencing severe overcrowding (2+ persons per room)
    housing_before_1939 = "B25034_011", # Older units may indicate disinvestment, increasing gentrification potential
    households_receiving_assistance = "B19058_002", #This variable provides the total number of households receiving either cash public assistance or Food Stamps/SNAP, making it useful for analyzing households benefiting from these programs.
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    recent_movers = "B07201_003", # households that moved into the City in last year, i.e. different house one year ago
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012",
    
    # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08134_061", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009"
)

# Set Year for Analysis
year_selected <- 2015

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2015 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2015,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2015 <- tract_data_2015 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2015)

# Ensure Newark data is in sf format
newark_tract_2015 <- newark_tract_2015 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2015 <- newark_tract_2015 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2015)

# Remove columns with "moe" in their names
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2015"
colnames(newark_tract_wide_2015) <- gsub("estimate", "2015", colnames(newark_tract_wide_2015))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2015)


# ACS 2014 data

vars_acs_2014 <- c(
  
  # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B23006_023",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B10058_002", # total workers or civilian labor force
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    overcrowded_owner_occupied_households = "B25014_007", 
    housing_before_1939 = "B25034_010", 
    households_receiving_assistance = "B19058_002",
    
        # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08301_010", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009",
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012"
)

# Set Year for Analysis
year_selected <- 2014

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2014 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2014,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2014 <- tract_data_2014 %>%
  filter(GEOID %in% newark_tract_geoids)

# Ensure Newark data is in sf format
newark_tract_2014 <- newark_tract_2014 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2014 <- newark_tract_2014 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Remove columns with "moe" in their names
newark_tract_wide_2014 <- newark_tract_wide_2014 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2014"
colnames(newark_tract_wide_2014) <- gsub("estimate", "2014", colnames(newark_tract_wide_2014))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2014 <- newark_tract_wide_2014 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2014)


# ACS 2013 data

vars_acs_2013 <- c(
  
  # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B23006_023",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B10058_002", # total workers or civilian labor force
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    overcrowded_owner_occupied_households = "B25014_007", 
    housing_before_1939 = "B25034_010", 
    households_receiving_assistance = "B19058_002",
    
        # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08301_010", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009",
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012"
)

# Set Year for Analysis
year_selected <- 2013

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2013 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2013,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2013 <- tract_data_2013 %>%
  filter(GEOID %in% newark_tract_geoids)

# Ensure Newark data is in sf format
newark_tract_2013 <- newark_tract_2013 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2013 <- newark_tract_2013 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Remove columns with "moe" in their names
newark_tract_wide_2013 <- newark_tract_wide_2013 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2013"
colnames(newark_tract_wide_2013) <- gsub("estimate", "2013", colnames(newark_tract_wide_2013))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2013 <- newark_tract_wide_2013 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2013)



# ACS 2012 data

vars_acs_2012 <- c(

# Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B23006_023",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B10058_002", # total workers or civilian labor force
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    overcrowded_owner_occupied_households = "B25014_007", 
    housing_before_1939 = "B25034_010", 
    households_receiving_assistance = "B19058_002",
    
        # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08301_010", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009",
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012"
)

# Set Year for Analysis
year_selected <- 2012

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2012 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2012,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2012 <- tract_data_2012 %>%
  filter(GEOID %in% newark_tract_geoids)

# Ensure Newark data is in sf format
newark_tract_2012 <- newark_tract_2012 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2012 <- newark_tract_2012 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Remove columns with "moe" in their names
newark_tract_wide_2012 <- newark_tract_wide_2012 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2012"
colnames(newark_tract_wide_2012) <- gsub("estimate", "2012", colnames(newark_tract_wide_2012))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2012 <- newark_tract_wide_2012 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2012)

  
  
  
# ACS 2011 data

vars_acs_2011 <- c(  
  
   # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B23006_023",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B10058_002", # total workers or civilian labor force
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    overcrowded_owner_occupied_households = "B25014_007", 
    housing_before_1939 = "B25034_010", 
    households_receiving_assistance = "B19058_002",
    
        # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08301_010", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009",
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012"
)


# Set Year for Analysis
year_selected <- 2011

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2011 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2011,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2011 <- tract_data_2011 %>%
  filter(GEOID %in% newark_tract_geoids)

# Ensure Newark data is in sf format
newark_tract_2011 <- newark_tract_2011 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2011 <- newark_tract_2011 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Remove columns with "moe" in their names
newark_tract_wide_2011 <- newark_tract_wide_2011 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2011"
colnames(newark_tract_wide_2011) <- gsub("estimate", "2011", colnames(newark_tract_wide_2011))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2011 <- newark_tract_wide_2011 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2011)




  
  
# ACS 2010 data

vars_acs_2010 <- c(

    # Business and Economy: Gentrification and displacement are often linked to economic shifts, such as rising business investments, self-employment trends, and industry transitions.
    self_employed_incorporated = "B08128_004", # signals entrepreneurship growth
    self_employed_not_incorporated = "B08128_009", # indicates local small business activity
    employment_industry = "C24030_001", # tracks workforce composition
    worker_class = "B24080_001", # private vs govt vs self-employed
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Education: Higher educational attainment in historically lower-income areas can indicate an influx of more affluent populations (a sign of gentrification).
    bachelor_degree_or_higher = "B23006_023",
    bachelor_male = "B15002_015",
    masters_male = "B15002_016",
    doctorate_male = "B15002_018",
    bachelor_female = "B15002_032",
    masters_female = "B15002_033",
    doctorate_female = "B15002_035",
    educational_attainment_total = "B15002_001", 
    professional_degree_male = "B15002_017",
    professional_degree_female = "B15002_034",
    
    # Employment: Changes in employment types and income levels impact housing affordability and displacement risks.
    total_labor_force = "B10058_002", # total workers or civilian labor force
    median_hh_income = "B19013_001", # to track economic shifts
    poverty_level = "B17001_002",
    service_industry = "B24011_018", #This includes food service workers, janitors, security guards, and personal care aides who typically rely on affordable housing near their workplaces and may be displaced by rising rents.
    mgmt_business_sc_arts_industry = "B24011_002", # job growth in professional, scientific, and technical services 
    
    # Families and living arrangements: Family structure impacts housing stability, and displacement disproportionately affects single-parent and low-income households.
    total_households = "B11001_001",
    family_households = "B11001_002",
    nonfamily_households = "B11001_007",
    households_with_children = "B11003_001",
    
    # Housing: Housing affordability and instability are one of the strongest displacement indicators.
    total_housing_units = "B25001_001",
    median_gross_rent = "B25064_001",
    median_home_value = "B25077_001",
    rent_burden_30plus = "B25070_007",
    rent_burden_50plus = "B25070_010",
    owner_occupied_units = "B25003_002",
    renter_occupied_units = "B25003_003",
    rent_100_below = "B25063_003",
    rent_100_149 = "B25063_004",
    rent_150_199 = "B25063_005",
    rent_200_249 = "B25063_006",
    rent_250_299 = "B25063_007",
    rent_300_349 = "B25063_008",
    rent_350_399 = "B25063_009",
    rent_400_449 = "B25063_010",
    rent_450_499 = "B25063_011",
    rent_500_549 = "B25063_012",
    rent_550_599 = "B25063_013",
    rent_600_649 = "B25063_014",
    rent_650_699 = "B25063_015",
    rent_700_749 = "B25063_016",
    rent_750_799 = "B25063_017",
    rent_800_899 = "B25063_018",
    rent_900_999 = "B25063_019",
    rent_1000_1249 = "B25063_020",
    rent_1250_1499 = "B25063_021",
    rent_1500_1999 = "B25063_022",
    rent_2000_2499 = "B25063_023",
    total_occupied_units = "B25002_002",
    total_vacant_units = "B25002_003",
    overcrowded_owner_occupied_households = "B25014_007", 
    housing_before_1939 = "B25034_010", 
    households_receiving_assistance = "B19058_002",
    
        # Transportation and mobility: Rising transit use signals affordability shifts and changing commuting patterns.
    public_transit_users = "B08301_010", 
    mean_commute_time = "B08303_001",
    no_vehicle_households = "B08201_002", 
    commute_alone = "B08101_009",
    
    # Income and poverty: Income inequality shapes affordability and determines displacement risks.
    median_hh_income = "B19013_001", # to track economic shifts
    per_capita_income = "B19301_001", # wealth concentration measure
    gini_index = "B19083_001",  # rising income inequality is a sign of economic displacement
    
    # Population and people (migration and displacement indicators): Tracking population shifts can reveal where displacement is occurring.
    total_population = "B01003_001",
    total_male_population = "B01001_002",
    total_female_population = "B01001_026",
    median_age = "B01002_001",
    male_median_age ="B01002_002",
    female_median_age = "B01002_003",
    foreign_born_population = "B05006_001", # new immigrants are often displaced first
    
    # Race and ethnicity: Tracking racial composition changes is key to identifying gentrification patterns.
    white_NH_race = "B03002_003",
    black_NH_race = "B03002_004",
    asian_NH_race = "B03002_006",
    hisp_race = "B03002_012"
)


# Set Year for Analysis
year_selected <- 2010

# Retrieve ACS Data at Tract Level for Essex County
tract_data_2010 <- get_acs(
  geography = "tract",  # Getting data at census tract level
  state = 34, 
  county = "013",  # Essex County
  variables = vars_acs_2010,  # Your defined variables
  year = year_selected,
  survey = "acs5",
  geometry = TRUE  # Keep spatial data for mapping
)

# Filter the Essex County ACS data to keep only Newark tracts
newark_tract_2010 <- tract_data_2010 %>%
  filter(GEOID %in% newark_tract_geoids)

# Check the filtered data
head(newark_tract_2010)

# Ensure Newark data is in sf format
newark_tract_2010 <- newark_tract_2010 %>%
  st_as_sf()

# Convert Newark tract data from long to wide format
newark_tract_wide_2010 <- newark_tract_2010 %>%
  pivot_wider(
    names_from = variable,    # Column names become variables
    values_from = c(estimate, moe)  # Keep estimates and margin of error
  )

# Display Sample Data
head(newark_tract_wide_2010)

# Remove columns with "moe" in their names
newark_tract_wide_2010 <- newark_tract_wide_2010 %>%
  select(-contains("moe"))

# Rename columns by replacing "estimate" with "2010"
colnames(newark_tract_wide_2010) <- gsub("estimate", "2010", colnames(newark_tract_wide_2010))

# Remove ", Essex County, New Jersey" from the NAME column
newark_tract_wide_2010 <- newark_tract_wide_2010 %>%
  mutate(NAME = str_replace(NAME, ", Essex County, New Jersey", ""))

# Check cleaned dataset
head(newark_tract_wide_2010)

```

```{r trial plots variables, warning=FALSE, message=FALSE, results='hide'}


# Define years and datasets
years <- 2010:2023
datasets <- list(
  newark_tract_wide_2010, newark_tract_wide_2011, newark_tract_wide_2012, newark_tract_wide_2013, newark_tract_wide_2014, newark_tract_wide_2015, newark_tract_wide_2016, newark_tract_wide_2017,
  newark_tract_wide_2018, newark_tract_wide_2019, newark_tract_wide_2020,
  newark_tract_wide_2021, newark_tract_wide_2022, newark_tract_wide_2023
)

# Remove spatial geometry to keep only tabular data
datasets <- lapply(datasets, st_drop_geometry)

# Extract GEOID, NAME, and total population for each year, renaming columns
population_data <- reduce(
  map2(datasets, years, function(data, year) {
    data %>%
      select(GEOID, NAME, !!paste0("population_", year) := !!sym(paste0(year, "_total_population")))
  }),
  full_join, by = c("GEOID", "NAME")
)


# Fix duplicates: Ensure only one row per GEOID
population_data_clean <- population_data %>%
  group_by(GEOID) %>%
  summarise(
    NAME = first(NAME),  # Keep the first occurrence of NAME
    across(starts_with("population_"), sum, na.rm = TRUE),  # Sum population correctly
    .groups = "drop"
  )

# Check for duplicates (should be empty if fixed)
duplicated_geoids <- population_data_clean %>%
  group_by(GEOID) %>%
  filter(n() > 1)

print(duplicated_geoids)  # If empty, issue is resolved



# Compute population change from 2010 to 2023
population_data_clean <- population_data_clean %>%
  mutate(pop_change = population_2023 - population_2010)

# Merge with geographic boundaries for mapping
newark_map <- newark_tract_wide_2023 %>% 
  select(GEOID, geometry) %>% 
  left_join(population_data_clean, by = "GEOID")

# Plot the choropleth map
ggplot(newark_map) +
  geom_sf(aes(fill = pop_change), color = "white", size = 0.2) +
  scale_fill_gradient2(low = "red", mid = "white", high = "blue", midpoint = 0,
                       name = "Pop Change (2015-2023)") +
  labs(title = "Population Change in Newark Census Tracts (2015-2023)",
       subtitle = "Red = Population Decline, Blue = Growth",
       caption = "Source: ACS 5-Year Estimates") +
  theme_minimal()






# file path to the SHP file
newark_nbd_sf <- st_read("Newark_Neighborhoods.shp")


newark_tracts_sf <- newark_tracts %>%
  st_as_sf(coords = c("INTPTLON", "INTPTLAT"), crs = 4326) # Convert to spatial using tract centroids

st_crs(newark_tracts_sf)
st_crs(newark_nbd_sf)


# Transform newark_tracts_sf to match the neighborhood CRS
newark_tracts_sf <- st_transform(newark_tracts_sf, st_crs(newark_nbd_sf))

# Assign each census tract to a neighborhood
newark_tracts_with_nbd <- st_join(newark_tracts_sf, newark_nbd_sf, join = st_within)

# Select only useful columns: GEOID (Tract ID), Census Tract Name, and Neighborhood Name
newark_tracts_with_nbd <- newark_tracts_with_nbd %>%
  select(GEOID, NAMELSAD, name, geometry)  # Keep Census Tract and Neighborhood Name

# Rename for clarity
colnames(newark_tracts_with_nbd) <- c("GEOID", "Census_Tract", "Neighborhood", "geometry")


# List of years
years <- 2010:2023

# Initialize an empty list to store data
pop_data_list <- list()

# Loop through each year's dataset and extract population data
for (year in years) {
  
  # Construct the dataset name dynamically
  df_name <- paste0("newark_tract_wide_", year)
  
  # Load the dataset (assuming all are loaded in the environment)
  df <- get(df_name)
  
  # Extract relevant columns dynamically
  total_pop_col <- paste0(year, "_total_population")
  race_cols <- c(
    "white" = paste0(year, "_white_NH_race"),
    "black" = paste0(year, "_black_NH_race"),
    "asian" = paste0(year, "_asian_NH_race"),
    "hispanic" = paste0(year, "_hisp_race")
  )
  
  # Aggregate total population by summing all rows
  pop_summary <- df %>%
    summarise(
      total_population = sum(.data[[total_pop_col]], na.rm = TRUE),
      across(all_of(race_cols), ~ sum(.x, na.rm = TRUE))  # Summing race populations
    ) %>%
    mutate(
      other = total_population - (white + black + asian + hispanic),  # Compute 'other' category
      year = as.character(year)  # Ensure year is a character
    ) %>%
    select(year, white, black, asian, hispanic, other)  # Keep only race categories and year

  # Store in list
  pop_data_list[[as.character(year)]] <- pop_summary
}

# Combine all years into a single data frame
pop_data <- bind_rows(pop_data_list) 

str(pop_data)

# Ensure `year` is a character type to avoid type mismatch
pop_data$year <- as.character(pop_data$year)

# Remove geometry column before pivoting
pop_data_no_geom <- st_drop_geometry(pop_data)

# Convert data to long format explicitly selecting only race columns
pop_data_long <- pop_data_no_geom %>%
  pivot_longer(
    cols = c("white", "black", "asian", "hispanic", "other"),  # Select only valid race columns
    names_to = "race",
    values_to = "population"
  )

# Verify the transformation
head(pop_data_long)

# Define colors for racial groups
race_colors <- c("white" = "blue", "black" = "red", "asian" = "green", "hispanic" = "orange", "other" = "purple")

# **Plot stacked bar chart**
ggplot(pop_data_long, aes(x = factor(year), y = population, fill = race)) +
  geom_bar(stat = "identity", position = "stack", width = 0.7) +
  scale_fill_manual(values = race_colors, name = "Race") +
  scale_y_continuous(labels = comma) +  # Convert Y-axis to readable format
  theme_minimal() +
  labs(
    title = "Population Change by Race (2010-2023)",
    x = "Year",
    y = "Population",
    fill = "Race"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    legend.position = "right",
    text = element_text(size = 14)  # Increase font size for readability
  )


# Define the range of years
years <- 2010:2023

# Initialize an empty list to store data
income_data_list <- list()

# Loop through each year's dataset and extract median household income
for (year in years) {
  # Construct the dataset name dynamically
  df_name <- paste0("newark_tract_wide_", year)
  
  # Load the dataset dynamically (assuming all are loaded in the environment)
  df <- get(df_name)
  
  # Define the column name dynamically based on year
  income_col <- paste0(year, "_median_hh_income")
  
  # Select relevant columns (GEOID for spatial mapping + median income)
  income_data <- df %>%
    select(GEOID, all_of(income_col)) %>%
    rename(median_income = all_of(income_col)) %>%
    mutate(year = year)  # Add year column
  
  # Store the cleaned data in the list
  income_data_list[[as.character(year)]] <- income_data
}

# Combine all years into a single dataframe
median_hh_income_data <- bind_rows(income_data_list)

# View the final dataset
head(median_hh_income_data)

# Convert to long format for ggplot
income_long <- median_hh_income_data %>%
  group_by(year) %>%
  summarize(median_income = mean(median_income, na.rm = TRUE))

# Plot the multi-line chart
ggplot(income_long, aes(x = year, y = median_income)) +
  geom_line(size = 1.5, color = "blue") +
  geom_point(size = 3, color = "blue") +
  scale_y_continuous(labels = dollar) +  # Format Y-axis as currency
  theme_minimal() +
  labs(title = "Median Household Income in Newark (2010-2023)",
       x = "Year",
       y = "Median Household Income ($)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(size = 14))


### Merge Census Tract Data with Household Income Data** ###
# Drop geometry from census tracts dataset and select required columns
newark_tracts_no_geom <- newark_tracts_with_nbd %>%
  st_drop_geometry() %>%
  mutate(GEOID = as.character(GEOID)) %>%  # Convert GEOID to character
  select(GEOID, Census_Tract, Neighborhood)

# Convert GEOID to character in the income dataset to ensure a correct join
median_hh_income_data <- median_hh_income_data %>%
  mutate(GEOID = as.character(GEOID))

# Merge household income data with neighborhood info using GEOID
income_nbd_data <- median_hh_income_data %>%
  left_join(newark_tracts_no_geom, by = "GEOID")

# View data to confirm the merge worked correctly
head(income_nbd_data)

### Aggregate Census Tract Data to Neighborhood Level** ###
income_nbd_agg <- income_nbd_data %>%
  group_by(Neighborhood, year) %>%
  summarise(
    median_income = mean(median_income, na.rm = TRUE),  # Compute average income per neighborhood
    total_tracts = n()  # Count number of tracts per neighborhood
  ) %>%
  ungroup()

# View the aggregated data
head(income_nbd_agg)

### **Step 3: Ensure Neighborhood Polygon Data is Ready for Spatial Join** ###
# Rename "NAME" column in newark_nbd_sf to match the Neighborhood column
newark_nbd_sf <- newark_nbd_sf %>%
  rename(Neighborhood = name)

# Check CRS of both datasets
st_crs(newark_nbd_sf)  # Check CRS of neighborhood polygons
st_crs(income_nbd_agg)  # Should be NA since it's not spatial

### Convert Aggregated Data to SF Object & Ensure Matching CRS** ###
# Convert income data into an sf object
income_nbd_agg_sf <- st_as_sf(income_nbd_agg, coords = NULL, crs = st_crs(newark_nbd_sf))

# Ensure both datasets use the same CRS
income_nbd_agg_sf <- st_transform(income_nbd_agg_sf, st_crs(newark_nbd_sf))

### **Step 5: Perform Spatial Join Using `st_join()` to Attach Income Data to Neighborhoods** ###
income_nbd_sf <- st_join(newark_nbd_sf, income_nbd_agg_sf, join = st_intersects)

# Drop any duplicate columns (if needed)
income_nbd_sf <- income_nbd_sf %>%
  select(-Neighborhood.y) %>%
  rename(Neighborhood = Neighborhood.x)

# View the final dataset
head(income_nbd_sf)

tm_shape(income_nbd_sf) +
  tm_polygons("median_income",
              palette = "Blues",
              style = "quantile",
              title = "Median Household Income ($)") +
  tm_facets("year", free.scales = FALSE) +  # Show multiple years in one map
  tm_layout(title = "Median Household Income by Neighborhood (2015-2023)",
            legend.outside = TRUE)

# Summarize median income by Neighborhood and Year
income_summary <- income_nbd_sf %>%
  group_by(Neighborhood, year) %>%
  summarise(median_income = mean(median_income, na.rm = TRUE)) %>%
  pivot_wider(names_from = year, values_from = median_income)

# View the summarized dataset
print(income_summary)


```




```{r nbd aggregate data, warning=FALSE, message=FALSE, results='hide'}

# Ensure all spatial datasets have the same CRS as newark_nbd_sf
target_crs <- st_crs(newark_nbd_sf)  # Get CRS from neighborhood data

# Load the shapefile
newark_ward_sf <- st_read("Newark_Wards.shp")

newark_tract_wide_2023 <- st_transform(newark_tract_wide_2023, target_crs)
newark_tract_wide_2022 <- st_transform(newark_tract_wide_2022, target_crs)
newark_tract_wide_2021 <- st_transform(newark_tract_wide_2021, target_crs)
newark_tract_wide_2020 <- st_transform(newark_tract_wide_2020, target_crs)
newark_tract_wide_2019 <- st_transform(newark_tract_wide_2019, target_crs)
newark_tract_wide_2018 <- st_transform(newark_tract_wide_2018, target_crs)
newark_tract_wide_2017 <- st_transform(newark_tract_wide_2017, target_crs)
newark_tract_wide_2016 <- st_transform(newark_tract_wide_2016, target_crs)
newark_tract_wide_2015 <- st_transform(newark_tract_wide_2015, target_crs)
newark_tract_wide_2014 <- st_transform(newark_tract_wide_2014, target_crs)
newark_tract_wide_2013 <- st_transform(newark_tract_wide_2013, target_crs)
newark_tract_wide_2012 <- st_transform(newark_tract_wide_2012, target_crs)
newark_tract_wide_2011 <- st_transform(newark_tract_wide_2011, target_crs)
newark_tract_wide_2010 <- st_transform(newark_tract_wide_2010, target_crs)
newark_nbd_sf <- st_transform(newark_nbd_sf, target_crs)
newark_tracts_with_nbd <- st_transform(newark_tracts_with_nbd, target_crs)
newark_ward_sf <- st_transform(newark_ward_sf, target_crs)

# Remove geometry column from newark_tract_wide_2023
newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2023)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2023)

# Rename columns: Remove "2023_" prefix and add "_2023" suffix
colnames(newark_tract_wide_2023) <- gsub("^2023_", "", colnames(newark_tract_wide_2023))
colnames(newark_tract_wide_2023) <- paste0(colnames(newark_tract_wide_2023), "_2023")
colnames(newark_tract_wide_2023)[colnames(newark_tract_wide_2023) %in% c("GEOID_2023", "Census_Tract_2023", "Neighborhood_2023", "geometry_2023")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")

# Remove geometry column from newark_tract_wide_2022
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2022)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2022)

# Rename columns: Remove "2022_" prefix and add "_2022" suffix
colnames(newark_tract_wide_2022) <- gsub("^2022_", "", colnames(newark_tract_wide_2022))
colnames(newark_tract_wide_2022) <- paste0(colnames(newark_tract_wide_2022), "_2022")
colnames(newark_tract_wide_2022)[colnames(newark_tract_wide_2022) %in% c("GEOID_2022", "Census_Tract_2022", "Neighborhood_2022", "geometry_2022")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")


# Remove geometry column from newark_tract_wide_2021
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2021)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2021)

# Rename columns: Remove "2021_" prefix and add "_2021" suffix
colnames(newark_tract_wide_2021) <- gsub("^2021_", "", colnames(newark_tract_wide_2021))
colnames(newark_tract_wide_2021) <- paste0(colnames(newark_tract_wide_2021), "_2021")
colnames(newark_tract_wide_2021)[colnames(newark_tract_wide_2021) %in% c("GEOID_2021", "Census_Tract_2021", "Neighborhood_2021", "geometry_2021")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")


# Remove geometry column from newark_tract_wide_2020
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2020)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2020)

# Rename columns: Remove "2020_" prefix and add "_2020" suffix
colnames(newark_tract_wide_2020) <- gsub("^2020_", "", colnames(newark_tract_wide_2020))
colnames(newark_tract_wide_2020) <- paste0(colnames(newark_tract_wide_2020), "_2020")
colnames(newark_tract_wide_2020)[colnames(newark_tract_wide_2020) %in% c("GEOID_2020", "Census_Tract_2020", "Neighborhood_2020", "geometry_2020")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")


# Remove geometry column from newark_tract_wide_2019
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2019)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2019)

# Rename columns: Remove "2019_" prefix and add "_2019" suffix
colnames(newark_tract_wide_2019) <- gsub("^2019_", "", colnames(newark_tract_wide_2019))
colnames(newark_tract_wide_2019) <- paste0(colnames(newark_tract_wide_2019), "_2019")
colnames(newark_tract_wide_2019)[colnames(newark_tract_wide_2019) %in% c("GEOID_2019", "Census_Tract_2019", "Neighborhood_2019", "geometry_2019")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")



# Remove geometry column from newark_tract_wide_2018
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2018)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2018)

# Rename columns: Remove "2018_" prefix and add "_2018" suffix
colnames(newark_tract_wide_2018) <- gsub("^2018_", "", colnames(newark_tract_wide_2018))
colnames(newark_tract_wide_2018) <- paste0(colnames(newark_tract_wide_2018), "_2018")
colnames(newark_tract_wide_2018)[colnames(newark_tract_wide_2018) %in% c("GEOID_2018", "Census_Tract_2018", "Neighborhood_2018", "geometry_2018")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")


# Remove geometry column from newark_tract_wide_2017
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2017)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2017)

# Rename columns: Remove "2017_" prefix and add "_2017" suffix
colnames(newark_tract_wide_2017) <- gsub("^2017_", "", colnames(newark_tract_wide_2017))
colnames(newark_tract_wide_2017) <- paste0(colnames(newark_tract_wide_2017), "_2017")
colnames(newark_tract_wide_2017)[colnames(newark_tract_wide_2017) %in% c("GEOID_2017", "Census_Tract_2017", "Neighborhood_2017", "geometry_2017")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")


# Remove geometry column from newark_tract_wide_2016
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2016)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2016)

# Rename columns: Remove "2016_" prefix and add "_2016" suffix
colnames(newark_tract_wide_2016) <- gsub("^2016_", "", colnames(newark_tract_wide_2016))
colnames(newark_tract_wide_2016) <- paste0(colnames(newark_tract_wide_2016), "_2016")
colnames(newark_tract_wide_2016)[colnames(newark_tract_wide_2016) %in% c("GEOID_2016", "Census_Tract_2016", "Neighborhood_2016", "geometry_2016")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")



# Remove geometry column from newark_tract_wide_2015
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2015)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2015)

# Rename columns: Remove "2015_" prefix and add "_2015" suffix
colnames(newark_tract_wide_2015) <- gsub("^2015_", "", colnames(newark_tract_wide_2015))
colnames(newark_tract_wide_2015) <- paste0(colnames(newark_tract_wide_2015), "_2015")
colnames(newark_tract_wide_2015)[colnames(newark_tract_wide_2015) %in% c("GEOID_2015", "Census_Tract_2015", "Neighborhood_2015", "geometry_2015")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")



# Remove geometry column from newark_tract_wide_2014
newark_tract_wide_2014 <- newark_tract_wide_2014 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2014)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2014 <- newark_tract_wide_2014 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2014 <- newark_tract_wide_2014 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2014)

# Rename columns: Remove "2014_" prefix and add "_2014" suffix
colnames(newark_tract_wide_2014) <- gsub("^2014_", "", colnames(newark_tract_wide_2014))
colnames(newark_tract_wide_2014) <- paste0(colnames(newark_tract_wide_2014), "_2014")
colnames(newark_tract_wide_2014)[colnames(newark_tract_wide_2014) %in% c("GEOID_2014", "Census_Tract_2014", "Neighborhood_2014", "geometry_2014")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")




# Remove geometry column from newark_tract_wide_2013
newark_tract_wide_2013 <- newark_tract_wide_2013 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2013)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2013 <- newark_tract_wide_2013 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2013 <- newark_tract_wide_2013 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2013)

# Rename columns: Remove "2013_" prefix and add "_2013" suffix
colnames(newark_tract_wide_2013) <- gsub("^2013_", "", colnames(newark_tract_wide_2013))
colnames(newark_tract_wide_2013) <- paste0(colnames(newark_tract_wide_2013), "_2013")
colnames(newark_tract_wide_2013)[colnames(newark_tract_wide_2013) %in% c("GEOID_2013", "Census_Tract_2013", "Neighborhood_2013", "geometry_2013")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")



# Remove geometry column from newark_tract_wide_2012
newark_tract_wide_2012 <- newark_tract_wide_2012 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2012)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2012 <- newark_tract_wide_2012 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2012 <- newark_tract_wide_2012 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2012)

# Rename columns: Remove "2012_" prefix and add "_2012" suffix
colnames(newark_tract_wide_2012) <- gsub("^2012_", "", colnames(newark_tract_wide_2012))
colnames(newark_tract_wide_2012) <- paste0(colnames(newark_tract_wide_2012), "_2012")
colnames(newark_tract_wide_2012)[colnames(newark_tract_wide_2012) %in% c("GEOID_2012", "Census_Tract_2012", "Neighborhood_2012", "geometry_2012")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")




# Remove geometry column from newark_tract_wide_2011
newark_tract_wide_2011 <- newark_tract_wide_2011 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2011)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2011 <- newark_tract_wide_2011 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2011 <- newark_tract_wide_2011 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2011)

# Rename columns: Remove "2011_" prefix and add "_2011" suffix
colnames(newark_tract_wide_2011) <- gsub("^2011_", "", colnames(newark_tract_wide_2011))
colnames(newark_tract_wide_2011) <- paste0(colnames(newark_tract_wide_2011), "_2011")
colnames(newark_tract_wide_2011)[colnames(newark_tract_wide_2011) %in% c("GEOID_2011", "Census_Tract_2011", "Neighborhood_2011", "geometry_2011")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")





# Remove geometry column from newark_tract_wide_2010
newark_tract_wide_2010 <- newark_tract_wide_2010 %>%
  st_drop_geometry()

# View the updated DataFrame
print(newark_tract_wide_2010)

# Rename column 'NAME' to 'Census_Tract'
newark_tract_wide_2010 <- newark_tract_wide_2010 %>%
  rename(Census_Tract = NAME)

# Join only the "Neighborhood" column from newark_tracts_with_nbd
newark_tract_wide_2010 <- newark_tract_wide_2010 %>%
  left_join(newark_tracts_with_nbd %>% select(Census_Tract, Neighborhood), 
            by = "Census_Tract")

# View the updated DataFrame
print(newark_tract_wide_2010)

# Rename columns: Remove "2010_" prefix and add "_2010" suffix
colnames(newark_tract_wide_2010) <- gsub("^2010_", "", colnames(newark_tract_wide_2010))
colnames(newark_tract_wide_2010) <- paste0(colnames(newark_tract_wide_2010), "_2010")
colnames(newark_tract_wide_2010)[colnames(newark_tract_wide_2010) %in% c("GEOID_2010", "Census_Tract_2010", "Neighborhood_2010", "geometry_2010")] <- 
  c("GEOID", "Census_Tract", "Neighborhood", "geometry")







newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2014 <- newark_tract_wide_2014 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2013 <- newark_tract_wide_2013 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2012 <- newark_tract_wide_2012 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2011 <- newark_tract_wide_2011 %>%
  relocate(Neighborhood, .after = Census_Tract)
newark_tract_wide_2010 <- newark_tract_wide_2010 %>%
  relocate(Neighborhood, .after = Census_Tract)


# Aggregate data by Neighborhood
newark_nbd_wide_2023 <- newark_tract_wide_2023 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2023 = sum(total_population_2023, na.rm = TRUE),
    total_male_population_2023 = sum(total_male_population_2023, na.rm = TRUE),
    total_female_population_2023 = sum(total_female_population_2023, na.rm = TRUE),
    median_age_2023 = mean(median_age_2023, na.rm = TRUE),
    male_median_age_2023 = mean(male_median_age_2023, na.rm = TRUE),
    female_median_age_2023 = mean(female_median_age_2023, na.rm = TRUE),
    recent_movers_2023 = sum(recent_movers_2023, na.rm = TRUE),
    foreign_born_population_2023 = sum(foreign_born_population_2023, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2023 = sum(self_employed_incorporated_2023, na.rm = TRUE),
    self_employed_not_incorporated_2023 = sum(self_employed_not_incorporated_2023, na.rm = TRUE),
    employment_industry_2023 = sum(employment_industry_2023, na.rm = TRUE),
    worker_class_2023 = sum(worker_class_2023, na.rm = TRUE),
    median_hh_income_2023 = mean(median_hh_income_2023, na.rm = TRUE),
    per_capita_income_2023 = mean(per_capita_income_2023, na.rm = TRUE),
    gini_index_2023 = mean(gini_index_2023, na.rm = TRUE),
    poverty_level_2023 = sum(poverty_level_2023, na.rm = TRUE), ####

    # Education
    bachelor_degree_or_higher_2023 = sum(bachelor_degree_or_higher_2023, na.rm = TRUE),
    bachelor_male_2023 = sum(bachelor_male_2023, na.rm = TRUE),
    masters_male_2023 = sum(masters_male_2023, na.rm = TRUE),
    doctorate_male_2023 = sum(doctorate_male_2023, na.rm = TRUE),
    bachelor_female_2023 = sum(bachelor_female_2023, na.rm = TRUE),
    masters_female_2023 = sum(masters_female_2023, na.rm = TRUE),
    doctorate_female_2023 = sum(doctorate_female_2023, na.rm = TRUE),
    professional_degree_male_2023 = sum(professional_degree_male_2023, na.rm = TRUE),
    professional_degree_female_2023 = sum(professional_degree_female_2023, na.rm = TRUE),
    educational_attainment_total_2023 = sum(educational_attainment_total_2023, na.rm = TRUE),
    highschool_dropout_2023 = sum(highschool_dropout_2023, na.rm = TRUE),

    # Employment
    total_labor_force_2023 = sum(total_labor_force_2023, na.rm = TRUE),
    total_employed_2023 = sum(total_employed_2023, na.rm = TRUE),
    total_unemployed_2023 = sum(total_unemployed_2023, na.rm = TRUE),
    remote_workers_2023 = sum(remote_workers_2023, na.rm = TRUE),
    service_industry_2023 = sum(service_industry_2023, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2023 = sum(mgmt_business_sc_arts_industry_2023, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2023 = sum(total_households_2023, na.rm = TRUE),
    family_households_2023 = sum(family_households_2023, na.rm = TRUE),
    nonfamily_households_2023 = sum(nonfamily_households_2023, na.rm = TRUE),
    households_with_children_2023 = sum(households_with_children_2023, na.rm = TRUE),

    # Health
    disabled_population_2023 = sum(disabled_population_2023, na.rm = TRUE),

    # Housing
    total_housing_units_2023 = sum(total_housing_units_2023, na.rm = TRUE),
    median_gross_rent_2023 = mean(median_gross_rent_2023, na.rm = TRUE),
    median_home_value_2023 = mean(median_home_value_2023, na.rm = TRUE),
    rent_burden_30plus_2023 = sum(rent_burden_30plus_2023, na.rm = TRUE),
    rent_burden_50plus_2023 = sum(rent_burden_50plus_2023, na.rm = TRUE),
    owner_occupied_units_2023 = sum(owner_occupied_units_2023, na.rm = TRUE),
    renter_occupied_units_2023 = sum(renter_occupied_units_2023, na.rm = TRUE),
    total_occupied_units_2023 = sum(total_occupied_units_2023, na.rm = TRUE),
    total_vacant_units_2023 = sum(total_vacant_units_2023, na.rm = TRUE),
    units_built_2020plus_2023 = sum(units_built_2020plus_2023, na.rm = TRUE),
    units_built_2010_2019_2023 = sum(units_built_2010_2019_2023, na.rm = TRUE),
    units_built_2000_2009_2023 = sum(units_built_2000_2009_2023, na.rm = TRUE),
    overcrowded_owner_occupied_households_2023 = sum(overcrowded_owner_occupied_households_2023, na.rm = TRUE),
    housing_before_1939_2023 = sum(housing_before_1939_2023, na.rm = TRUE),
    households_receiving_assistance_2023 = sum(households_receiving_assistance_2023, na.rm = TRUE),
    rent_100_below_2023 = sum(rent_100_below_2023, na.rm = TRUE),
    rent_100_149_2023 = sum(rent_100_149_2023, na.rm = TRUE),
    rent_150_199_2023 = sum(rent_150_199_2023, na.rm = TRUE),
    rent_200_249_2023 = sum(rent_200_249_2023, na.rm = TRUE),
    rent_250_299_2023 = sum(rent_250_299_2023, na.rm = TRUE),
    rent_300_349_2023 = sum(rent_300_349_2023, na.rm = TRUE),
    rent_350_399_2023 = sum(rent_350_399_2023, na.rm = TRUE),
    rent_400_449_2023 = sum(rent_400_449_2023, na.rm = TRUE),
    rent_450_499_2023 = sum(rent_450_499_2023, na.rm = TRUE),
    rent_500_549_2023 = sum(rent_500_549_2023, na.rm = TRUE),
    rent_550_599_2023 = sum(rent_550_599_2023, na.rm = TRUE),
    rent_600_649_2023 = sum(rent_600_649_2023, na.rm = TRUE),
    rent_650_699_2023 = sum(rent_650_699_2023, na.rm = TRUE),
    rent_700_749_2023 = sum(rent_700_749_2023, na.rm = TRUE),
    rent_750_799_2023 = sum(rent_750_799_2023, na.rm = TRUE),
    rent_800_899_2023 = sum(rent_800_899_2023, na.rm = TRUE),
    rent_900_999_2023 = sum(rent_900_999_2023, na.rm = TRUE),
    rent_1000_1249_2023 = sum(rent_1000_1249_2023, na.rm = TRUE),
    rent_1250_1499_2023 = sum(rent_1250_1499_2023, na.rm = TRUE),
    rent_1500_1999_2023 = sum(rent_1500_1999_2023, na.rm = TRUE),
    rent_2000_2499_2023 = sum(rent_2000_2499_2023, na.rm = TRUE),
    rent_2500_2999_2023 = sum(rent_2500_2999_2023, na.rm = TRUE),
    rent_3000_3499_2023 = sum(rent_3000_3499_2023, na.rm = TRUE),
    rent_3500_plus_2023 = sum(rent_3500_plus_2023, na.rm = TRUE),
    households_cash_rent_2023 = sum(households_cash_rent_2023, na.rm = TRUE),
    households_no_cash_rent_2023 = sum(households_no_cash_rent_2023, na.rm = TRUE),

    # Race & Ethnicity
    white_NH_race_2023 = sum(white_NH_race_2023, na.rm = TRUE),
    black_NH_race_2023 = sum(black_NH_race_2023, na.rm = TRUE),
    asian_NH_race_2023 = sum(asian_NH_race_2023, na.rm = TRUE),
    hisp_race_2023 = sum(hisp_race_2023, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2023 = sum(public_transit_users_2023, na.rm = TRUE),
    mean_commute_time_2023 = mean(mean_commute_time_2023, na.rm = TRUE),
    no_vehicle_households_2023 = sum(no_vehicle_households_2023, na.rm = TRUE),
    commute_alone_2023 = sum(commute_alone_2023, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2023)

# Aggregate data by Neighborhood
newark_nbd_wide_2022 <- newark_tract_wide_2022 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2022 = sum(total_population_2022, na.rm = TRUE),
    total_male_population_2022 = sum(total_male_population_2022, na.rm = TRUE),
    total_female_population_2022 = sum(total_female_population_2022, na.rm = TRUE),
    median_age_2022 = mean(median_age_2022, na.rm = TRUE),
    male_median_age_2022 = mean(male_median_age_2022, na.rm = TRUE),
    female_median_age_2022 = mean(female_median_age_2022, na.rm = TRUE),
    recent_movers_2022 = sum(recent_movers_2022, na.rm = TRUE),
    foreign_born_population_2022 = sum(foreign_born_population_2022, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2022 = sum(self_employed_incorporated_2022, na.rm = TRUE),
    self_employed_not_incorporated_2022 = sum(self_employed_not_incorporated_2022, na.rm = TRUE),
    employment_industry_2022 = sum(employment_industry_2022, na.rm = TRUE),
    worker_class_2022 = sum(worker_class_2022, na.rm = TRUE),
    median_hh_income_2022 = mean(median_hh_income_2022, na.rm = TRUE),
    per_capita_income_2022 = mean(per_capita_income_2022, na.rm = TRUE),
    gini_index_2022 = mean(gini_index_2022, na.rm = TRUE),
    poverty_level_2022 = sum(poverty_level_2022, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2022 = sum(bachelor_degree_or_higher_2022, na.rm = TRUE),
    bachelor_male_2022 = sum(bachelor_male_2022, na.rm = TRUE),
    masters_male_2022 = sum(masters_male_2022, na.rm = TRUE),
    doctorate_male_2022 = sum(doctorate_male_2022, na.rm = TRUE),
    bachelor_female_2022 = sum(bachelor_female_2022, na.rm = TRUE),
    masters_female_2022 = sum(masters_female_2022, na.rm = TRUE),
    doctorate_female_2022 = sum(doctorate_female_2022, na.rm = TRUE),
    professional_degree_male_2022 = sum(professional_degree_male_2022, na.rm = TRUE),
    professional_degree_female_2022 = sum(professional_degree_female_2022, na.rm = TRUE),
    educational_attainment_total_2022 = sum(educational_attainment_total_2022, na.rm = TRUE),
    highschool_dropout_2022 = sum(highschool_dropout_2022, na.rm = TRUE),

    # Employment
    total_labor_force_2022 = sum(total_labor_force_2022, na.rm = TRUE),
    total_employed_2022 = sum(total_employed_2022, na.rm = TRUE),
    total_unemployed_2022 = sum(total_unemployed_2022, na.rm = TRUE),
    remote_workers_2022 = sum(remote_workers_2022, na.rm = TRUE),
    service_industry_2022 = sum(service_industry_2022, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2022 = sum(mgmt_business_sc_arts_industry_2022, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2022 = sum(total_households_2022, na.rm = TRUE),
    family_households_2022 = sum(family_households_2022, na.rm = TRUE),
    nonfamily_households_2022 = sum(nonfamily_households_2022, na.rm = TRUE),
    households_with_children_2022 = sum(households_with_children_2022, na.rm = TRUE),

    # Health
    disabled_population_2022 = sum(disabled_population_2022, na.rm = TRUE),

    # Housing
    total_housing_units_2022 = sum(total_housing_units_2022, na.rm = TRUE),
    median_gross_rent_2022 = mean(median_gross_rent_2022, na.rm = TRUE),
    median_home_value_2022 = mean(median_home_value_2022, na.rm = TRUE),
    rent_burden_30plus_2022 = sum(rent_burden_30plus_2022, na.rm = TRUE),
    rent_burden_50plus_2022 = sum(rent_burden_50plus_2022, na.rm = TRUE),
    owner_occupied_units_2022 = sum(owner_occupied_units_2022, na.rm = TRUE),
    renter_occupied_units_2022 = sum(renter_occupied_units_2022, na.rm = TRUE),
    total_occupied_units_2022 = sum(total_occupied_units_2022, na.rm = TRUE),
    total_vacant_units_2022 = sum(total_vacant_units_2022, na.rm = TRUE),
    units_built_2020plus_2022 = sum(units_built_2020plus_2022, na.rm = TRUE),
    units_built_2010_2019_2022 = sum(units_built_2010_2019_2022, na.rm = TRUE),
    units_built_2000_2009_2022 = sum(units_built_2000_2009_2022, na.rm = TRUE),
    overcrowded_owner_occupied_households_2022 = sum(overcrowded_owner_occupied_households_2022, na.rm = TRUE),
    housing_before_1939_2022 = sum(housing_before_1939_2022, na.rm = TRUE),
    households_receiving_assistance_2022 = sum(households_receiving_assistance_2022, na.rm = TRUE),
    rent_100_below_2022 = sum(rent_100_below_2022, na.rm = TRUE),
    rent_100_149_2022 = sum(rent_100_149_2022, na.rm = TRUE),
    rent_150_199_2022 = sum(rent_150_199_2022, na.rm = TRUE),
    rent_200_249_2022 = sum(rent_200_249_2022, na.rm = TRUE),
    rent_250_299_2022 = sum(rent_250_299_2022, na.rm = TRUE),
    rent_300_349_2022 = sum(rent_300_349_2022, na.rm = TRUE),
    rent_350_399_2022 = sum(rent_350_399_2022, na.rm = TRUE),
    rent_400_449_2022 = sum(rent_400_449_2022, na.rm = TRUE),
    rent_450_499_2022 = sum(rent_450_499_2022, na.rm = TRUE),
    rent_500_549_2022 = sum(rent_500_549_2022, na.rm = TRUE),
    rent_550_599_2022 = sum(rent_550_599_2022, na.rm = TRUE),
    rent_600_649_2022 = sum(rent_600_649_2022, na.rm = TRUE),
    rent_650_699_2022 = sum(rent_650_699_2022, na.rm = TRUE),
    rent_700_749_2022 = sum(rent_700_749_2022, na.rm = TRUE),
    rent_750_799_2022 = sum(rent_750_799_2022, na.rm = TRUE),
    rent_800_899_2022 = sum(rent_800_899_2022, na.rm = TRUE),
    rent_900_999_2022 = sum(rent_900_999_2022, na.rm = TRUE),
    rent_1000_1249_2022 = sum(rent_1000_1249_2022, na.rm = TRUE),
    rent_1250_1499_2022 = sum(rent_1250_1499_2022, na.rm = TRUE),
    rent_1500_1999_2022 = sum(rent_1500_1999_2022, na.rm = TRUE),
    rent_2000_2499_2022 = sum(rent_2000_2499_2022, na.rm = TRUE),
    rent_2500_2999_2022 = sum(rent_2500_2999_2022, na.rm = TRUE),
    rent_3000_3499_2022 = sum(rent_3000_3499_2022, na.rm = TRUE),
    rent_3500_plus_2022 = sum(rent_3500_plus_2022, na.rm = TRUE),
    households_cash_rent_2022 = sum(households_cash_rent_2022, na.rm = TRUE),
    households_no_cash_rent_2022 = sum(households_no_cash_rent_2022, na.rm = TRUE),

    # Race & Ethnicity
    white_NH_race_2022 = sum(white_NH_race_2022, na.rm = TRUE),
    black_NH_race_2022 = sum(black_NH_race_2022, na.rm = TRUE),
    asian_NH_race_2022 = sum(asian_NH_race_2022, na.rm = TRUE),
    hisp_race_2022 = sum(hisp_race_2022, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2022 = sum(public_transit_users_2022, na.rm = TRUE),
    mean_commute_time_2022 = mean(mean_commute_time_2022, na.rm = TRUE),
    no_vehicle_households_2022 = sum(no_vehicle_households_2022, na.rm = TRUE),
    commute_alone_2022 = sum(commute_alone_2022, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2022)


# Aggregate data by Neighborhood
newark_nbd_wide_2021 <- newark_tract_wide_2021 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2021 = sum(total_population_2021, na.rm = TRUE),
    total_male_population_2021 = sum(total_male_population_2021, na.rm = TRUE),
    total_female_population_2021 = sum(total_female_population_2021, na.rm = TRUE),
    median_age_2021 = mean(median_age_2021, na.rm = TRUE),
    male_median_age_2021 = mean(male_median_age_2021, na.rm = TRUE),
    female_median_age_2021 = mean(female_median_age_2021, na.rm = TRUE),
    recent_movers_2021 = sum(recent_movers_2021, na.rm = TRUE),
    foreign_born_population_2021 = sum(foreign_born_population_2021, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2021 = sum(self_employed_incorporated_2021, na.rm = TRUE),
    self_employed_not_incorporated_2021 = sum(self_employed_not_incorporated_2021, na.rm = TRUE),
    employment_industry_2021 = sum(employment_industry_2021, na.rm = TRUE),
    worker_class_2021 = sum(worker_class_2021, na.rm = TRUE),
    median_hh_income_2021 = mean(median_hh_income_2021, na.rm = TRUE),
    per_capita_income_2021 = mean(per_capita_income_2021, na.rm = TRUE),
    gini_index_2021 = mean(gini_index_2021, na.rm = TRUE),
    poverty_level_2021 = sum(poverty_level_2021, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2021 = sum(bachelor_degree_or_higher_2021, na.rm = TRUE),
    bachelor_male_2021 = sum(bachelor_male_2021, na.rm = TRUE),
    masters_male_2021 = sum(masters_male_2021, na.rm = TRUE),
    doctorate_male_2021 = sum(doctorate_male_2021, na.rm = TRUE),
    bachelor_female_2021 = sum(bachelor_female_2021, na.rm = TRUE),
    masters_female_2021 = sum(masters_female_2021, na.rm = TRUE),
    doctorate_female_2021 = sum(doctorate_female_2021, na.rm = TRUE),
    professional_degree_male_2021 = sum(professional_degree_male_2021, na.rm = TRUE),
    professional_degree_female_2021 = sum(professional_degree_female_2021, na.rm = TRUE),
    educational_attainment_total_2021 = sum(educational_attainment_total_2021, na.rm = TRUE),
    highschool_dropout_2021 = sum(highschool_dropout_2021, na.rm = TRUE),

    # Employment
    total_labor_force_2021 = sum(total_labor_force_2021, na.rm = TRUE),
    total_employed_2021 = sum(total_employed_2021, na.rm = TRUE),
    total_unemployed_2021 = sum(total_unemployed_2021, na.rm = TRUE),
    remote_workers_2021 = sum(remote_workers_2021, na.rm = TRUE),
    service_industry_2021 = sum(service_industry_2021, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2021 = sum(mgmt_business_sc_arts_industry_2021, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2021 = sum(total_households_2021, na.rm = TRUE),
    family_households_2021 = sum(family_households_2021, na.rm = TRUE),
    nonfamily_households_2021 = sum(nonfamily_households_2021, na.rm = TRUE),
    households_with_children_2021 = sum(households_with_children_2021, na.rm = TRUE),

    # Health
    disabled_population_2021 = sum(disabled_population_2021, na.rm = TRUE),

    # Housing
    total_housing_units_2021 = sum(total_housing_units_2021, na.rm = TRUE),
    median_gross_rent_2021 = mean(median_gross_rent_2021, na.rm = TRUE),
    median_home_value_2021 = mean(median_home_value_2021, na.rm = TRUE),
    rent_burden_30plus_2021 = sum(rent_burden_30plus_2021, na.rm = TRUE),
    rent_burden_50plus_2021 = sum(rent_burden_50plus_2021, na.rm = TRUE),
    owner_occupied_units_2021 = sum(owner_occupied_units_2021, na.rm = TRUE),
    renter_occupied_units_2021 = sum(renter_occupied_units_2021, na.rm = TRUE),
    total_occupied_units_2021 = sum(total_occupied_units_2021, na.rm = TRUE),
    total_vacant_units_2021 = sum(total_vacant_units_2021, na.rm = TRUE),
    units_built_2020plus_2021 = sum(units_built_2020plus_2021, na.rm = TRUE),
units_built_2010_2019_2021 = sum(units_built_2010_2019_2021, na.rm = TRUE),
units_built_2000_2009_2021 = sum(units_built_2000_2009_2021, na.rm = TRUE),
overcrowded_owner_occupied_households_2021 = sum(overcrowded_owner_occupied_households_2021, na.rm = TRUE),
housing_before_1939_2021 = sum(housing_before_1939_2021, na.rm = TRUE),
households_receiving_assistance_2021 = sum(households_receiving_assistance_2021, na.rm = TRUE),
rent_100_below_2021 = sum(rent_100_below_2021, na.rm = TRUE),
rent_100_149_2021 = sum(rent_100_149_2021, na.rm = TRUE),
rent_150_199_2021 = sum(rent_150_199_2021, na.rm = TRUE),
rent_200_249_2021 = sum(rent_200_249_2021, na.rm = TRUE),
rent_250_299_2021 = sum(rent_250_299_2021, na.rm = TRUE),
rent_300_349_2021 = sum(rent_300_349_2021, na.rm = TRUE),
rent_350_399_2021 = sum(rent_350_399_2021, na.rm = TRUE),
rent_400_449_2021 = sum(rent_400_449_2021, na.rm = TRUE),
rent_450_499_2021 = sum(rent_450_499_2021, na.rm = TRUE),
rent_500_549_2021 = sum(rent_500_549_2021, na.rm = TRUE),
rent_550_599_2021 = sum(rent_550_599_2021, na.rm = TRUE),
rent_600_649_2021 = sum(rent_600_649_2021, na.rm = TRUE),
rent_650_699_2021 = sum(rent_650_699_2021, na.rm = TRUE),
rent_700_749_2021 = sum(rent_700_749_2021, na.rm = TRUE),
rent_750_799_2021 = sum(rent_750_799_2021, na.rm = TRUE),
rent_800_899_2021 = sum(rent_800_899_2021, na.rm = TRUE),
rent_900_999_2021 = sum(rent_900_999_2021, na.rm = TRUE),
rent_1000_1249_2021 = sum(rent_1000_1249_2021, na.rm = TRUE),
rent_1250_1499_2021 = sum(rent_1250_1499_2021, na.rm = TRUE),
rent_1500_1999_2021 = sum(rent_1500_1999_2021, na.rm = TRUE),
rent_2000_2499_2021 = sum(rent_2000_2499_2021, na.rm = TRUE),
rent_2500_2999_2021 = sum(rent_2500_2999_2021, na.rm = TRUE),
rent_3000_3499_2021 = sum(rent_3000_3499_2021, na.rm = TRUE),
rent_3500_plus_2021 = sum(rent_3500_plus_2021, na.rm = TRUE),
households_cash_rent_2021 = sum(households_cash_rent_2021, na.rm = TRUE),
households_no_cash_rent_2021 = sum(households_no_cash_rent_2021, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2021 = sum(white_NH_race_2021, na.rm = TRUE),
    black_NH_race_2021 = sum(black_NH_race_2021, na.rm = TRUE),
    asian_NH_race_2021 = sum(asian_NH_race_2021, na.rm = TRUE),
    hisp_race_2021 = sum(hisp_race_2021, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2021 = sum(public_transit_users_2021, na.rm = TRUE),
    mean_commute_time_2021 = mean(mean_commute_time_2021, na.rm = TRUE),
    no_vehicle_households_2021 = sum(no_vehicle_households_2021, na.rm = TRUE),
    commute_alone_2021 = sum(commute_alone_2021, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2021)


# Aggregate data by Neighborhood
newark_nbd_wide_2020 <- newark_tract_wide_2020 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2020 = sum(total_population_2020, na.rm = TRUE),
    total_male_population_2020 = sum(total_male_population_2020, na.rm = TRUE),
    total_female_population_2020 = sum(total_female_population_2020, na.rm = TRUE),
    median_age_2020 = mean(median_age_2020, na.rm = TRUE),
    male_median_age_2020 = mean(male_median_age_2020, na.rm = TRUE),
    female_median_age_2020 = mean(female_median_age_2020, na.rm = TRUE),
    recent_movers_2020 = sum(recent_movers_2020, na.rm = TRUE),
    foreign_born_population_2020 = sum(foreign_born_population_2020, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2020 = sum(self_employed_incorporated_2020, na.rm = TRUE),
    self_employed_not_incorporated_2020 = sum(self_employed_not_incorporated_2020, na.rm = TRUE),
    employment_industry_2020 = sum(employment_industry_2020, na.rm = TRUE),
    worker_class_2020 = sum(worker_class_2020, na.rm = TRUE),
    median_hh_income_2020 = mean(median_hh_income_2020, na.rm = TRUE),
    per_capita_income_2020 = mean(per_capita_income_2020, na.rm = TRUE),
    gini_index_2020 = mean(gini_index_2020, na.rm = TRUE),
    poverty_level_2020 = sum(poverty_level_2020, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2020 = sum(bachelor_degree_or_higher_2020, na.rm = TRUE),
    bachelor_male_2020 = sum(bachelor_male_2020, na.rm = TRUE),
    masters_male_2020 = sum(masters_male_2020, na.rm = TRUE),
    doctorate_male_2020 = sum(doctorate_male_2020, na.rm = TRUE),
    bachelor_female_2020 = sum(bachelor_female_2020, na.rm = TRUE),
    masters_female_2020 = sum(masters_female_2020, na.rm = TRUE),
    doctorate_female_2020 = sum(doctorate_female_2020, na.rm = TRUE),
    professional_degree_male_2020 = sum(professional_degree_male_2020, na.rm = TRUE),
    professional_degree_female_2020 = sum(professional_degree_female_2020, na.rm = TRUE),
    educational_attainment_total_2020 = sum(educational_attainment_total_2020, na.rm = TRUE),
    highschool_dropout_2020 = sum(highschool_dropout_2020, na.rm = TRUE),

    # Employment
    total_labor_force_2020 = sum(total_labor_force_2020, na.rm = TRUE),
    total_employed_2020 = sum(total_employed_2020, na.rm = TRUE),
    total_unemployed_2020 = sum(total_unemployed_2020, na.rm = TRUE),
    remote_workers_2020 = sum(remote_workers_2020, na.rm = TRUE),
    service_industry_2020 = sum(service_industry_2020, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2020 = sum(mgmt_business_sc_arts_industry_2020, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2020 = sum(total_households_2020, na.rm = TRUE),
    family_households_2020 = sum(family_households_2020, na.rm = TRUE),
    nonfamily_households_2020 = sum(nonfamily_households_2020, na.rm = TRUE),
    households_with_children_2020 = sum(households_with_children_2020, na.rm = TRUE),

    # Health
    disabled_population_2020 = sum(disabled_population_2020, na.rm = TRUE),

    # Housing
    total_housing_units_2020 = sum(total_housing_units_2020, na.rm = TRUE),
    median_gross_rent_2020 = mean(median_gross_rent_2020, na.rm = TRUE),
    median_home_value_2020 = mean(median_home_value_2020, na.rm = TRUE),
    rent_burden_30plus_2020 = sum(rent_burden_30plus_2020, na.rm = TRUE),
    rent_burden_50plus_2020 = sum(rent_burden_50plus_2020, na.rm = TRUE),
    owner_occupied_units_2020 = sum(owner_occupied_units_2020, na.rm = TRUE),
    renter_occupied_units_2020 = sum(renter_occupied_units_2020, na.rm = TRUE),
    total_occupied_units_2020 = sum(total_occupied_units_2020, na.rm = TRUE),
    total_vacant_units_2020 = sum(total_vacant_units_2020, na.rm = TRUE),
    units_built_2020plus_2020 = sum(units_built_2020plus_2020, na.rm = TRUE),
units_built_2010_2019_2020 = sum(units_built_2010_2019_2020, na.rm = TRUE),
units_built_2000_2009_2020 = sum(units_built_2000_2009_2020, na.rm = TRUE),
overcrowded_owner_occupied_households_2020 = sum(overcrowded_owner_occupied_households_2020, na.rm = TRUE),
housing_before_1939_2020 = sum(housing_before_1939_2020, na.rm = TRUE),
households_receiving_assistance_2020 = sum(households_receiving_assistance_2020, na.rm = TRUE),
rent_100_below_2020 = sum(rent_100_below_2020, na.rm = TRUE),
rent_100_149_2020 = sum(rent_100_149_2020, na.rm = TRUE),
rent_150_199_2020 = sum(rent_150_199_2020, na.rm = TRUE),
rent_200_249_2020 = sum(rent_200_249_2020, na.rm = TRUE),
rent_250_299_2020 = sum(rent_250_299_2020, na.rm = TRUE),
rent_300_349_2020 = sum(rent_300_349_2020, na.rm = TRUE),
rent_350_399_2020 = sum(rent_350_399_2020, na.rm = TRUE),
rent_400_449_2020 = sum(rent_400_449_2020, na.rm = TRUE),
rent_450_499_2020 = sum(rent_450_499_2020, na.rm = TRUE),
rent_500_549_2020 = sum(rent_500_549_2020, na.rm = TRUE),
rent_550_599_2020 = sum(rent_550_599_2020, na.rm = TRUE),
rent_600_649_2020 = sum(rent_600_649_2020, na.rm = TRUE),
rent_650_699_2020 = sum(rent_650_699_2020, na.rm = TRUE),
rent_700_749_2020 = sum(rent_700_749_2020, na.rm = TRUE),
rent_750_799_2020 = sum(rent_750_799_2020, na.rm = TRUE),
rent_800_899_2020 = sum(rent_800_899_2020, na.rm = TRUE),
rent_900_999_2020 = sum(rent_900_999_2020, na.rm = TRUE),
rent_1000_1249_2020 = sum(rent_1000_1249_2020, na.rm = TRUE),
rent_1250_1499_2020 = sum(rent_1250_1499_2020, na.rm = TRUE),
rent_1500_1999_2020 = sum(rent_1500_1999_2020, na.rm = TRUE),
rent_2000_2499_2020 = sum(rent_2000_2499_2020, na.rm = TRUE),
rent_2500_2999_2020 = sum(rent_2500_2999_2020, na.rm = TRUE),
rent_3000_3499_2020 = sum(rent_3000_3499_2020, na.rm = TRUE),
rent_3500_plus_2020 = sum(rent_3500_plus_2020, na.rm = TRUE),
households_cash_rent_2020 = sum(households_cash_rent_2020, na.rm = TRUE),
households_no_cash_rent_2020 = sum(households_no_cash_rent_2020, na.rm = TRUE),

    # Race & Ethnicity
    white_NH_race_2020 = sum(white_NH_race_2020, na.rm = TRUE),
    black_NH_race_2020 = sum(black_NH_race_2020, na.rm = TRUE),
    asian_NH_race_2020 = sum(asian_NH_race_2020, na.rm = TRUE),
    hisp_race_2020 = sum(hisp_race_2020, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2020 = sum(public_transit_users_2020, na.rm = TRUE),
    mean_commute_time_2020 = mean(mean_commute_time_2020, na.rm = TRUE),
    no_vehicle_households_2020 = sum(no_vehicle_households_2020, na.rm = TRUE),
    commute_alone_2020 = sum(commute_alone_2020, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2020)


# Aggregate data by Neighborhood
newark_nbd_wide_2019 <- newark_tract_wide_2019 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2019 = sum(total_population_2019, na.rm = TRUE),
    total_male_population_2019 = sum(total_male_population_2019, na.rm = TRUE),
    total_female_population_2019 = sum(total_female_population_2019, na.rm = TRUE),
    median_age_2019 = mean(median_age_2019, na.rm = TRUE),
    male_median_age_2019 = mean(male_median_age_2019, na.rm = TRUE),
    female_median_age_2019 = mean(female_median_age_2019, na.rm = TRUE),
    recent_movers_2019 = sum(recent_movers_2019, na.rm = TRUE),
    foreign_born_population_2019 = sum(foreign_born_population_2019, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2019 = sum(self_employed_incorporated_2019, na.rm = TRUE),
    self_employed_not_incorporated_2019 = sum(self_employed_not_incorporated_2019, na.rm = TRUE),
    employment_industry_2019 = sum(employment_industry_2019, na.rm = TRUE),
    worker_class_2019 = sum(worker_class_2019, na.rm = TRUE),
    median_hh_income_2019 = mean(median_hh_income_2019, na.rm = TRUE),
    per_capita_income_2019 = mean(per_capita_income_2019, na.rm = TRUE),
    gini_index_2019 = mean(gini_index_2019, na.rm = TRUE),
    poverty_level_2019 = sum(poverty_level_2019, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2019 = sum(bachelor_degree_or_higher_2019, na.rm = TRUE),
    bachelor_male_2019 = sum(bachelor_male_2019, na.rm = TRUE),
    masters_male_2019 = sum(masters_male_2019, na.rm = TRUE),
    doctorate_male_2019 = sum(doctorate_male_2019, na.rm = TRUE),
    bachelor_female_2019 = sum(bachelor_female_2019, na.rm = TRUE),
    masters_female_2019 = sum(masters_female_2019, na.rm = TRUE),
    doctorate_female_2019 = sum(doctorate_female_2019, na.rm = TRUE),
    professional_degree_male_2019 = sum(professional_degree_male_2019, na.rm = TRUE),
    professional_degree_female_2019 = sum(professional_degree_female_2019, na.rm = TRUE),
    educational_attainment_total_2019 = sum(educational_attainment_total_2019, na.rm = TRUE),
    highschool_dropout_2019 = sum(highschool_dropout_2019, na.rm = TRUE),

    # Employment
    total_labor_force_2019 = sum(total_labor_force_2019, na.rm = TRUE),
    total_employed_2019 = sum(total_employed_2019, na.rm = TRUE),
    total_unemployed_2019 = sum(total_unemployed_2019, na.rm = TRUE),
    remote_workers_2019 = sum(remote_workers_2019, na.rm = TRUE),
    service_industry_2019 = sum(service_industry_2019, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2019 = sum(mgmt_business_sc_arts_industry_2019, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2019 = sum(total_households_2019, na.rm = TRUE),
    family_households_2019 = sum(family_households_2019, na.rm = TRUE),
    nonfamily_households_2019 = sum(nonfamily_households_2019, na.rm = TRUE),
    households_with_children_2019 = sum(households_with_children_2019, na.rm = TRUE),

    # Health
    disabled_population_2019 = sum(disabled_population_2019, na.rm = TRUE),

    # Housing
    total_housing_units_2019 = sum(total_housing_units_2019, na.rm = TRUE),
    median_gross_rent_2019 = mean(median_gross_rent_2019, na.rm = TRUE),
    median_home_value_2019 = mean(median_home_value_2019, na.rm = TRUE),
    rent_burden_30plus_2019 = sum(rent_burden_30plus_2019, na.rm = TRUE),
    rent_burden_50plus_2019 = sum(rent_burden_50plus_2019, na.rm = TRUE),
    owner_occupied_units_2019 = sum(owner_occupied_units_2019, na.rm = TRUE),
    renter_occupied_units_2019 = sum(renter_occupied_units_2019, na.rm = TRUE),
    total_occupied_units_2019 = sum(total_occupied_units_2019, na.rm = TRUE),
    total_vacant_units_2019 = sum(total_vacant_units_2019, na.rm = TRUE),
    units_built_2020plus_2019 = sum(units_built_2020plus_2019, na.rm = TRUE),
units_built_2010_2019_2019 = sum(units_built_2010_2019_2019, na.rm = TRUE),
units_built_2000_2009_2019 = sum(units_built_2000_2009_2019, na.rm = TRUE),
overcrowded_owner_occupied_households_2019 = sum(overcrowded_owner_occupied_households_2019, na.rm = TRUE),
housing_before_1939_2019 = sum(housing_before_1939_2019, na.rm = TRUE),
households_receiving_assistance_2019 = sum(households_receiving_assistance_2019, na.rm = TRUE),
rent_100_below_2019 = sum(rent_100_below_2019, na.rm = TRUE),
rent_100_149_2019 = sum(rent_100_149_2019, na.rm = TRUE),
rent_150_199_2019 = sum(rent_150_199_2019, na.rm = TRUE),
rent_200_249_2019 = sum(rent_200_249_2019, na.rm = TRUE),
rent_250_299_2019 = sum(rent_250_299_2019, na.rm = TRUE),
rent_300_349_2019 = sum(rent_300_349_2019, na.rm = TRUE),
rent_350_399_2019 = sum(rent_350_399_2019, na.rm = TRUE),
rent_400_449_2019 = sum(rent_400_449_2019, na.rm = TRUE),
rent_450_499_2019 = sum(rent_450_499_2019, na.rm = TRUE),
rent_500_549_2019 = sum(rent_500_549_2019, na.rm = TRUE),
rent_550_599_2019 = sum(rent_550_599_2019, na.rm = TRUE),
rent_600_649_2019 = sum(rent_600_649_2019, na.rm = TRUE),
rent_650_699_2019 = sum(rent_650_699_2019, na.rm = TRUE),
rent_700_749_2019 = sum(rent_700_749_2019, na.rm = TRUE),
rent_750_799_2019 = sum(rent_750_799_2019, na.rm = TRUE),
rent_800_899_2019 = sum(rent_800_899_2019, na.rm = TRUE),
rent_900_999_2019 = sum(rent_900_999_2019, na.rm = TRUE),
rent_1000_1249_2019 = sum(rent_1000_1249_2019, na.rm = TRUE),
rent_1250_1499_2019 = sum(rent_1250_1499_2019, na.rm = TRUE),
rent_1500_1999_2019 = sum(rent_1500_1999_2019, na.rm = TRUE),
rent_2000_2499_2019 = sum(rent_2000_2499_2019, na.rm = TRUE),
rent_2500_2999_2019 = sum(rent_2500_2999_2019, na.rm = TRUE),
rent_3000_3499_2019 = sum(rent_3000_3499_2019, na.rm = TRUE),
rent_3500_plus_2019 = sum(rent_3500_plus_2019, na.rm = TRUE),
households_cash_rent_2019 = sum(households_cash_rent_2019, na.rm = TRUE),
households_no_cash_rent_2019 = sum(households_no_cash_rent_2019, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2019 = sum(white_NH_race_2019, na.rm = TRUE),
    black_NH_race_2019 = sum(black_NH_race_2019, na.rm = TRUE),
    asian_NH_race_2019 = sum(asian_NH_race_2019, na.rm = TRUE),
    hisp_race_2019 = sum(hisp_race_2019, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2019 = sum(public_transit_users_2019, na.rm = TRUE),
    mean_commute_time_2019 = mean(mean_commute_time_2019, na.rm = TRUE),
    no_vehicle_households_2019 = sum(no_vehicle_households_2019, na.rm = TRUE),
    commute_alone_2019 = sum(commute_alone_2019, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2019)


# Aggregate data by Neighborhood
newark_nbd_wide_2018 <- newark_tract_wide_2018 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2018 = sum(total_population_2018, na.rm = TRUE),
    total_male_population_2018 = sum(total_male_population_2018, na.rm = TRUE),
    total_female_population_2018 = sum(total_female_population_2018, na.rm = TRUE),
    median_age_2018 = mean(median_age_2018, na.rm = TRUE),
    male_median_age_2018 = mean(male_median_age_2018, na.rm = TRUE),
    female_median_age_2018 = mean(female_median_age_2018, na.rm = TRUE),
    recent_movers_2018 = sum(recent_movers_2018, na.rm = TRUE),
    foreign_born_population_2018 = sum(foreign_born_population_2018, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2018 = sum(self_employed_incorporated_2018, na.rm = TRUE),
    self_employed_not_incorporated_2018 = sum(self_employed_not_incorporated_2018, na.rm = TRUE),
    employment_industry_2018 = sum(employment_industry_2018, na.rm = TRUE),
    worker_class_2018 = sum(worker_class_2018, na.rm = TRUE),
    median_hh_income_2018 = mean(median_hh_income_2018, na.rm = TRUE),
    per_capita_income_2018 = mean(per_capita_income_2018, na.rm = TRUE),
    gini_index_2018 = mean(gini_index_2018, na.rm = TRUE),
    poverty_level_2018 = sum(poverty_level_2018, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2018 = sum(bachelor_degree_or_higher_2018, na.rm = TRUE),
    bachelor_male_2018 = sum(bachelor_male_2018, na.rm = TRUE),
    masters_male_2018 = sum(masters_male_2018, na.rm = TRUE),
    doctorate_male_2018 = sum(doctorate_male_2018, na.rm = TRUE),
    bachelor_female_2018 = sum(bachelor_female_2018, na.rm = TRUE),
    masters_female_2018 = sum(masters_female_2018, na.rm = TRUE),
    doctorate_female_2018 = sum(doctorate_female_2018, na.rm = TRUE),
    professional_degree_male_2018 = sum(professional_degree_male_2018, na.rm = TRUE),
    professional_degree_female_2018 = sum(professional_degree_female_2018, na.rm = TRUE),
    educational_attainment_total_2018 = sum(educational_attainment_total_2018, na.rm = TRUE),
    highschool_dropout_2018 = sum(highschool_dropout_2018, na.rm = TRUE),

    # Employment
    total_labor_force_2018 = sum(total_labor_force_2018, na.rm = TRUE),
    total_employed_2018 = sum(total_employed_2018, na.rm = TRUE),
    total_unemployed_2018 = sum(total_unemployed_2018, na.rm = TRUE),
    remote_workers_2018 = sum(remote_workers_2018, na.rm = TRUE),
    service_industry_2018 = sum(service_industry_2018, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2018 = sum(mgmt_business_sc_arts_industry_2018, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2018 = sum(total_households_2018, na.rm = TRUE),
    family_households_2018 = sum(family_households_2018, na.rm = TRUE),
    nonfamily_households_2018 = sum(nonfamily_households_2018, na.rm = TRUE),
    households_with_children_2018 = sum(households_with_children_2018, na.rm = TRUE),

    # Health
    disabled_population_2018 = sum(disabled_population_2018, na.rm = TRUE),

    # Housing
    total_housing_units_2018 = sum(total_housing_units_2018, na.rm = TRUE),
    median_gross_rent_2018 = mean(median_gross_rent_2018, na.rm = TRUE),
    median_home_value_2018 = mean(median_home_value_2018, na.rm = TRUE),
    rent_burden_30plus_2018 = sum(rent_burden_30plus_2018, na.rm = TRUE),
    rent_burden_50plus_2018 = sum(rent_burden_50plus_2018, na.rm = TRUE),
    owner_occupied_units_2018 = sum(owner_occupied_units_2018, na.rm = TRUE),
    renter_occupied_units_2018 = sum(renter_occupied_units_2018, na.rm = TRUE),
    total_occupied_units_2018 = sum(total_occupied_units_2018, na.rm = TRUE),
    total_vacant_units_2018 = sum(total_vacant_units_2018, na.rm = TRUE),
    units_built_2020plus_2018 = sum(units_built_2020plus_2018, na.rm = TRUE),
overcrowded_owner_occupied_households_2018 = sum(overcrowded_owner_occupied_households_2018, na.rm = TRUE),
housing_before_1939_2018 = sum(housing_before_1939_2018, na.rm = TRUE),
households_receiving_assistance_2018 = sum(households_receiving_assistance_2018, na.rm = TRUE),
rent_100_below_2018 = sum(rent_100_below_2018, na.rm = TRUE),
rent_100_149_2018 = sum(rent_100_149_2018, na.rm = TRUE),
rent_150_199_2018 = sum(rent_150_199_2018, na.rm = TRUE),
rent_200_249_2018 = sum(rent_200_249_2018, na.rm = TRUE),
rent_250_299_2018 = sum(rent_250_299_2018, na.rm = TRUE),
rent_300_349_2018 = sum(rent_300_349_2018, na.rm = TRUE),
rent_350_399_2018 = sum(rent_350_399_2018, na.rm = TRUE),
rent_400_449_2018 = sum(rent_400_449_2018, na.rm = TRUE),
rent_450_499_2018 = sum(rent_450_499_2018, na.rm = TRUE),
rent_500_549_2018 = sum(rent_500_549_2018, na.rm = TRUE),
rent_550_599_2018 = sum(rent_550_599_2018, na.rm = TRUE),
rent_600_649_2018 = sum(rent_600_649_2018, na.rm = TRUE),
rent_650_699_2018 = sum(rent_650_699_2018, na.rm = TRUE),
rent_700_749_2018 = sum(rent_700_749_2018, na.rm = TRUE),
rent_750_799_2018 = sum(rent_750_799_2018, na.rm = TRUE),
rent_800_899_2018 = sum(rent_800_899_2018, na.rm = TRUE),
rent_900_999_2018 = sum(rent_900_999_2018, na.rm = TRUE),
rent_1000_1249_2018 = sum(rent_1000_1249_2018, na.rm = TRUE),
rent_1250_1499_2018 = sum(rent_1250_1499_2018, na.rm = TRUE),
rent_1500_1999_2018 = sum(rent_1500_1999_2018, na.rm = TRUE),
rent_2000_2499_2018 = sum(rent_2000_2499_2018, na.rm = TRUE),
rent_2500_2999_2018 = sum(rent_2500_2999_2018, na.rm = TRUE),
rent_3000_3499_2018 = sum(rent_3000_3499_2018, na.rm = TRUE),
rent_3500_plus_2018 = sum(rent_3500_plus_2018, na.rm = TRUE),
households_cash_rent_2018 = sum(households_cash_rent_2018, na.rm = TRUE),
households_no_cash_rent_2018 = sum(households_no_cash_rent_2018, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2018 = sum(white_NH_race_2018, na.rm = TRUE),
    black_NH_race_2018 = sum(black_NH_race_2018, na.rm = TRUE),
    asian_NH_race_2018 = sum(asian_NH_race_2018, na.rm = TRUE),
    hisp_race_2018 = sum(hisp_race_2018, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2018 = sum(public_transit_users_2018, na.rm = TRUE),
    mean_commute_time_2018 = mean(mean_commute_time_2018, na.rm = TRUE),
    no_vehicle_households_2018 = sum(no_vehicle_households_2018, na.rm = TRUE),
    commute_alone_2018 = sum(commute_alone_2018, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2018)



# Aggregate data by Neighborhood
newark_nbd_wide_2017 <- newark_tract_wide_2017 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2017 = sum(total_population_2017, na.rm = TRUE),
    total_male_population_2017 = sum(total_male_population_2017, na.rm = TRUE),
    total_female_population_2017 = sum(total_female_population_2017, na.rm = TRUE),
    median_age_2017 = mean(median_age_2017, na.rm = TRUE),
    male_median_age_2017 = mean(male_median_age_2017, na.rm = TRUE),
    female_median_age_2017 = mean(female_median_age_2017, na.rm = TRUE),
    recent_movers_2017 = sum(recent_movers_2017, na.rm = TRUE),
    foreign_born_population_2017 = sum(foreign_born_population_2017, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2017 = sum(self_employed_incorporated_2017, na.rm = TRUE),
    self_employed_not_incorporated_2017 = sum(self_employed_not_incorporated_2017, na.rm = TRUE),
    employment_industry_2017 = sum(employment_industry_2017, na.rm = TRUE),
    worker_class_2017 = sum(worker_class_2017, na.rm = TRUE),
    median_hh_income_2017 = mean(median_hh_income_2017, na.rm = TRUE),
    per_capita_income_2017 = mean(per_capita_income_2017, na.rm = TRUE),
    gini_index_2017 = mean(gini_index_2017, na.rm = TRUE),
    poverty_level_2017 = sum(poverty_level_2017, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2017 = sum(bachelor_degree_or_higher_2017, na.rm = TRUE),
    bachelor_male_2017 = sum(bachelor_male_2017, na.rm = TRUE),
    masters_male_2017 = sum(masters_male_2017, na.rm = TRUE),
    doctorate_male_2017 = sum(doctorate_male_2017, na.rm = TRUE),
    bachelor_female_2017 = sum(bachelor_female_2017, na.rm = TRUE),
    masters_female_2017 = sum(masters_female_2017, na.rm = TRUE),
    doctorate_female_2017 = sum(doctorate_female_2017, na.rm = TRUE),
    professional_degree_male_2017 = sum(professional_degree_male_2017, na.rm = TRUE),
    professional_degree_female_2017 = sum(professional_degree_female_2017, na.rm = TRUE),
    educational_attainment_total_2017 = sum(educational_attainment_total_2017, na.rm = TRUE),
    highschool_dropout_2017 = sum(highschool_dropout_2017, na.rm = TRUE),

    # Employment
    total_labor_force_2017 = sum(total_labor_force_2017, na.rm = TRUE),
    total_employed_2017 = sum(total_employed_2017, na.rm = TRUE),
    total_unemployed_2017 = sum(total_unemployed_2017, na.rm = TRUE),
    remote_workers_2017 = sum(remote_workers_2017, na.rm = TRUE),
    service_industry_2017 = sum(service_industry_2017, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2017 = sum(mgmt_business_sc_arts_industry_2017, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2017 = sum(total_households_2017, na.rm = TRUE),
    family_households_2017 = sum(family_households_2017, na.rm = TRUE),
    nonfamily_households_2017 = sum(nonfamily_households_2017, na.rm = TRUE),
    households_with_children_2017 = sum(households_with_children_2017, na.rm = TRUE),

    # Health
    disabled_population_2017 = sum(disabled_population_2017, na.rm = TRUE),

    # Housing
    total_housing_units_2017 = sum(total_housing_units_2017, na.rm = TRUE),
    median_gross_rent_2017 = mean(median_gross_rent_2017, na.rm = TRUE),
    median_home_value_2017 = mean(median_home_value_2017, na.rm = TRUE),
    rent_burden_30plus_2017 = sum(rent_burden_30plus_2017, na.rm = TRUE),
    rent_burden_50plus_2017 = sum(rent_burden_50plus_2017, na.rm = TRUE),
    owner_occupied_units_2017 = sum(owner_occupied_units_2017, na.rm = TRUE),
    renter_occupied_units_2017 = sum(renter_occupied_units_2017, na.rm = TRUE),
    total_occupied_units_2017 = sum(total_occupied_units_2017, na.rm = TRUE),
    total_vacant_units_2017 = sum(total_vacant_units_2017, na.rm = TRUE),
    units_built_2020plus_2017 = sum(units_built_2020plus_2017, na.rm = TRUE),
overcrowded_owner_occupied_households_2017 = sum(overcrowded_owner_occupied_households_2017, na.rm = TRUE),
housing_before_1939_2017 = sum(housing_before_1939_2017, na.rm = TRUE),
households_receiving_assistance_2017 = sum(households_receiving_assistance_2017, na.rm = TRUE),
rent_100_below_2017 = sum(rent_100_below_2017, na.rm = TRUE),
rent_100_149_2017 = sum(rent_100_149_2017, na.rm = TRUE),
rent_150_199_2017 = sum(rent_150_199_2017, na.rm = TRUE),
rent_200_249_2017 = sum(rent_200_249_2017, na.rm = TRUE),
rent_250_299_2017 = sum(rent_250_299_2017, na.rm = TRUE),
rent_300_349_2017 = sum(rent_300_349_2017, na.rm = TRUE),
rent_350_399_2017 = sum(rent_350_399_2017, na.rm = TRUE),
rent_400_449_2017 = sum(rent_400_449_2017, na.rm = TRUE),
rent_450_499_2017 = sum(rent_450_499_2017, na.rm = TRUE),
rent_500_549_2017 = sum(rent_500_549_2017, na.rm = TRUE),
rent_550_599_2017 = sum(rent_550_599_2017, na.rm = TRUE),
rent_600_649_2017 = sum(rent_600_649_2017, na.rm = TRUE),
rent_650_699_2017 = sum(rent_650_699_2017, na.rm = TRUE),
rent_700_749_2017 = sum(rent_700_749_2017, na.rm = TRUE),
rent_750_799_2017 = sum(rent_750_799_2017, na.rm = TRUE),
rent_800_899_2017 = sum(rent_800_899_2017, na.rm = TRUE),
rent_900_999_2017 = sum(rent_900_999_2017, na.rm = TRUE),
rent_1000_1249_2017 = sum(rent_1000_1249_2017, na.rm = TRUE),
rent_1250_1499_2017 = sum(rent_1250_1499_2017, na.rm = TRUE),
rent_1500_1999_2017 = sum(rent_1500_1999_2017, na.rm = TRUE),
rent_2000_2499_2017 = sum(rent_2000_2499_2017, na.rm = TRUE),
rent_2500_2999_2017 = sum(rent_2500_2999_2017, na.rm = TRUE),
rent_3000_3499_2017 = sum(rent_3000_3499_2017, na.rm = TRUE),
rent_3500_plus_2017 = sum(rent_3500_plus_2017, na.rm = TRUE),
households_cash_rent_2017 = sum(households_cash_rent_2017, na.rm = TRUE),
households_no_cash_rent_2017 = sum(households_no_cash_rent_2017, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2017 = sum(white_NH_race_2017, na.rm = TRUE),
    black_NH_race_2017 = sum(black_NH_race_2017, na.rm = TRUE),
    asian_NH_race_2017 = sum(asian_NH_race_2017, na.rm = TRUE),
    hisp_race_2017 = sum(hisp_race_2017, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2017 = sum(public_transit_users_2017, na.rm = TRUE),
    mean_commute_time_2017 = mean(mean_commute_time_2017, na.rm = TRUE),
    no_vehicle_households_2017 = sum(no_vehicle_households_2017, na.rm = TRUE),
    commute_alone_2017 = sum(commute_alone_2017, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2017)



# Aggregate data by Neighborhood
newark_nbd_wide_2016 <- newark_tract_wide_2016 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2016 = sum(total_population_2016, na.rm = TRUE),
    total_male_population_2016 = sum(total_male_population_2016, na.rm = TRUE),
    total_female_population_2016 = sum(total_female_population_2016, na.rm = TRUE),
    median_age_2016 = mean(median_age_2016, na.rm = TRUE),
    male_median_age_2016 = mean(male_median_age_2016, na.rm = TRUE),
    female_median_age_2016 = mean(female_median_age_2016, na.rm = TRUE),
    recent_movers_2016 = sum(recent_movers_2016, na.rm = TRUE),
    foreign_born_population_2016 = sum(foreign_born_population_2016, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2016 = sum(self_employed_incorporated_2016, na.rm = TRUE),
    self_employed_not_incorporated_2016 = sum(self_employed_not_incorporated_2016, na.rm = TRUE),
    employment_industry_2016 = sum(employment_industry_2016, na.rm = TRUE),
    worker_class_2016 = sum(worker_class_2016, na.rm = TRUE),
    median_hh_income_2016 = mean(median_hh_income_2016, na.rm = TRUE),
    per_capita_income_2016 = mean(per_capita_income_2016, na.rm = TRUE),
    gini_index_2016 = mean(gini_index_2016, na.rm = TRUE),
    poverty_level_2016 = sum(poverty_level_2016, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2016 = sum(bachelor_degree_or_higher_2016, na.rm = TRUE),
    bachelor_male_2016 = sum(bachelor_male_2016, na.rm = TRUE),
    masters_male_2016 = sum(masters_male_2016, na.rm = TRUE),
    doctorate_male_2016 = sum(doctorate_male_2016, na.rm = TRUE),
    bachelor_female_2016 = sum(bachelor_female_2016, na.rm = TRUE),
    masters_female_2016 = sum(masters_female_2016, na.rm = TRUE),
    doctorate_female_2016 = sum(doctorate_female_2016, na.rm = TRUE),
    professional_degree_male_2016 = sum(professional_degree_male_2016, na.rm = TRUE),
    professional_degree_female_2016 = sum(professional_degree_female_2016, na.rm = TRUE),
    educational_attainment_total_2016 = sum(educational_attainment_total_2016, na.rm = TRUE),
    highschool_dropout_2016 = sum(highschool_dropout_2016, na.rm = TRUE),

    # Employment
    total_labor_force_2016 = sum(total_labor_force_2016, na.rm = TRUE),
    total_employed_2016 = sum(total_employed_2016, na.rm = TRUE),
    total_unemployed_2016 = sum(total_unemployed_2016, na.rm = TRUE),
    remote_workers_2016 = sum(remote_workers_2016, na.rm = TRUE),
    service_industry_2016 = sum(service_industry_2016, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2016 = sum(mgmt_business_sc_arts_industry_2016, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2016 = sum(total_households_2016, na.rm = TRUE),
    family_households_2016 = sum(family_households_2016, na.rm = TRUE),
    nonfamily_households_2016 = sum(nonfamily_households_2016, na.rm = TRUE),
    households_with_children_2016 = sum(households_with_children_2016, na.rm = TRUE),

    # Health
    disabled_population_2016 = sum(disabled_population_2016, na.rm = TRUE),

    # Housing
    total_housing_units_2016 = sum(total_housing_units_2016, na.rm = TRUE),
    median_gross_rent_2016 = mean(median_gross_rent_2016, na.rm = TRUE),
    median_home_value_2016 = mean(median_home_value_2016, na.rm = TRUE),
    rent_burden_30plus_2016 = sum(rent_burden_30plus_2016, na.rm = TRUE),
    rent_burden_50plus_2016 = sum(rent_burden_50plus_2016, na.rm = TRUE),
    owner_occupied_units_2016 = sum(owner_occupied_units_2016, na.rm = TRUE),
    renter_occupied_units_2016 = sum(renter_occupied_units_2016, na.rm = TRUE),
    total_occupied_units_2016 = sum(total_occupied_units_2016, na.rm = TRUE),
    total_vacant_units_2016 = sum(total_vacant_units_2016, na.rm = TRUE),
    units_built_2020plus_2016 = sum(units_built_2020plus_2016, na.rm = TRUE),
overcrowded_owner_occupied_households_2016 = sum(overcrowded_owner_occupied_households_2016, na.rm = TRUE),
housing_before_1939_2016 = sum(housing_before_1939_2016, na.rm = TRUE),
households_receiving_assistance_2016 = sum(households_receiving_assistance_2016, na.rm = TRUE),
rent_100_below_2016 = sum(rent_100_below_2016, na.rm = TRUE),
rent_100_149_2016 = sum(rent_100_149_2016, na.rm = TRUE),
rent_150_199_2016 = sum(rent_150_199_2016, na.rm = TRUE),
rent_200_249_2016 = sum(rent_200_249_2016, na.rm = TRUE),
rent_250_299_2016 = sum(rent_250_299_2016, na.rm = TRUE),
rent_300_349_2016 = sum(rent_300_349_2016, na.rm = TRUE),
rent_350_399_2016 = sum(rent_350_399_2016, na.rm = TRUE),
rent_400_449_2016 = sum(rent_400_449_2016, na.rm = TRUE),
rent_450_499_2016 = sum(rent_450_499_2016, na.rm = TRUE),
rent_500_549_2016 = sum(rent_500_549_2016, na.rm = TRUE),
rent_550_599_2016 = sum(rent_550_599_2016, na.rm = TRUE),
rent_600_649_2016 = sum(rent_600_649_2016, na.rm = TRUE),
rent_650_699_2016 = sum(rent_650_699_2016, na.rm = TRUE),
rent_700_749_2016 = sum(rent_700_749_2016, na.rm = TRUE),
rent_750_799_2016 = sum(rent_750_799_2016, na.rm = TRUE),
rent_800_899_2016 = sum(rent_800_899_2016, na.rm = TRUE),
rent_900_999_2016 = sum(rent_900_999_2016, na.rm = TRUE),
rent_1000_1249_2016 = sum(rent_1000_1249_2016, na.rm = TRUE),
rent_1250_1499_2016 = sum(rent_1250_1499_2016, na.rm = TRUE),
rent_1500_1999_2016 = sum(rent_1500_1999_2016, na.rm = TRUE),
rent_2000_2499_2016 = sum(rent_2000_2499_2016, na.rm = TRUE),
rent_2500_2999_2016 = sum(rent_2500_2999_2016, na.rm = TRUE),
rent_3000_3499_2016 = sum(rent_3000_3499_2016, na.rm = TRUE),
rent_3500_plus_2016 = sum(rent_3500_plus_2016, na.rm = TRUE),
households_cash_rent_2016 = sum(households_cash_rent_2016, na.rm = TRUE),
households_no_cash_rent_2016 = sum(households_no_cash_rent_2016, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2016 = sum(white_NH_race_2016, na.rm = TRUE),
    black_NH_race_2016 = sum(black_NH_race_2016, na.rm = TRUE),
    asian_NH_race_2016 = sum(asian_NH_race_2016, na.rm = TRUE),
    hisp_race_2016 = sum(hisp_race_2016, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2016 = sum(public_transit_users_2016, na.rm = TRUE),
    mean_commute_time_2016 = mean(mean_commute_time_2016, na.rm = TRUE),
    no_vehicle_households_2016 = sum(no_vehicle_households_2016, na.rm = TRUE),
    commute_alone_2016 = sum(commute_alone_2016, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2016)



# Aggregate data by Neighborhood
newark_nbd_wide_2015 <- newark_tract_wide_2015 %>%
  group_by(Neighborhood) %>%
  summarize(
    # Population and Demographics
    total_population_2015 = sum(total_population_2015, na.rm = TRUE),
    total_male_population_2015 = sum(total_male_population_2015, na.rm = TRUE),
    total_female_population_2015 = sum(total_female_population_2015, na.rm = TRUE),
    median_age_2015 = mean(median_age_2015, na.rm = TRUE),
    male_median_age_2015 = mean(male_median_age_2015, na.rm = TRUE),
    female_median_age_2015 = mean(female_median_age_2015, na.rm = TRUE),
    recent_movers_2015 = sum(recent_movers_2015, na.rm = TRUE),
    foreign_born_population_2015 = sum(foreign_born_population_2015, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2015 = sum(self_employed_incorporated_2015, na.rm = TRUE),
    self_employed_not_incorporated_2015 = sum(self_employed_not_incorporated_2015, na.rm = TRUE),
    employment_industry_2015 = sum(employment_industry_2015, na.rm = TRUE),
    worker_class_2015 = sum(worker_class_2015, na.rm = TRUE),
    median_hh_income_2015 = mean(median_hh_income_2015, na.rm = TRUE),
    per_capita_income_2015 = mean(per_capita_income_2015, na.rm = TRUE),
    gini_index_2015 = mean(gini_index_2015, na.rm = TRUE),
    poverty_level_2015 = sum(poverty_level_2015, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2015 = sum(bachelor_degree_or_higher_2015, na.rm = TRUE),
    bachelor_male_2015 = sum(bachelor_male_2015, na.rm = TRUE),
    masters_male_2015 = sum(masters_male_2015, na.rm = TRUE),
    doctorate_male_2015 = sum(doctorate_male_2015, na.rm = TRUE),
    bachelor_female_2015 = sum(bachelor_female_2015, na.rm = TRUE),
    masters_female_2015 = sum(masters_female_2015, na.rm = TRUE),
    doctorate_female_2015 = sum(doctorate_female_2015, na.rm = TRUE),
    professional_degree_male_2015 = sum(professional_degree_male_2015, na.rm = TRUE),
    professional_degree_female_2015 = sum(professional_degree_female_2015, na.rm = TRUE),
    educational_attainment_total_2015 = sum(educational_attainment_total_2015, na.rm = TRUE),
    highschool_dropout_2015 = sum(highschool_dropout_2015, na.rm = TRUE),

    # Employment
    total_labor_force_2015 = sum(total_labor_force_2015, na.rm = TRUE),
    total_employed_2015 = sum(total_employed_2015, na.rm = TRUE),
    total_unemployed_2015 = sum(total_unemployed_2015, na.rm = TRUE),
    remote_workers_2015 = sum(remote_workers_2015, na.rm = TRUE),
    service_industry_2015 = sum(service_industry_2015, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2015 = sum(mgmt_business_sc_arts_industry_2015, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2015 = sum(total_households_2015, na.rm = TRUE),
    family_households_2015 = sum(family_households_2015, na.rm = TRUE),
    nonfamily_households_2015 = sum(nonfamily_households_2015, na.rm = TRUE),
    households_with_children_2015 = sum(households_with_children_2015, na.rm = TRUE),

    # Health
    disabled_population_2015 = sum(disabled_population_2015, na.rm = TRUE),

    # Housing
    total_housing_units_2015 = sum(total_housing_units_2015, na.rm = TRUE),
    median_gross_rent_2015 = mean(median_gross_rent_2015, na.rm = TRUE),
    median_home_value_2015 = mean(median_home_value_2015, na.rm = TRUE),
    rent_burden_30plus_2015 = sum(rent_burden_30plus_2015, na.rm = TRUE),
    rent_burden_50plus_2015 = sum(rent_burden_50plus_2015, na.rm = TRUE),
    owner_occupied_units_2015 = sum(owner_occupied_units_2015, na.rm = TRUE),
    renter_occupied_units_2015 = sum(renter_occupied_units_2015, na.rm = TRUE),
    total_occupied_units_2015 = sum(total_occupied_units_2015, na.rm = TRUE),
    total_vacant_units_2015 = sum(total_vacant_units_2015, na.rm = TRUE),
    units_built_2020plus_2015 = sum(units_built_2020plus_2015, na.rm = TRUE),
overcrowded_owner_occupied_households_2015 = sum(overcrowded_owner_occupied_households_2015, na.rm = TRUE),
housing_before_1939_2015 = sum(housing_before_1939_2015, na.rm = TRUE),
households_receiving_assistance_2015 = sum(households_receiving_assistance_2015, na.rm = TRUE),
rent_100_below_2015 = sum(rent_100_below_2015, na.rm = TRUE),
rent_100_149_2015 = sum(rent_100_149_2015, na.rm = TRUE),
rent_150_199_2015 = sum(rent_150_199_2015, na.rm = TRUE),
rent_200_249_2015 = sum(rent_200_249_2015, na.rm = TRUE),
rent_250_299_2015 = sum(rent_250_299_2015, na.rm = TRUE),
rent_300_349_2015 = sum(rent_300_349_2015, na.rm = TRUE),
rent_350_399_2015 = sum(rent_350_399_2015, na.rm = TRUE),
rent_400_449_2015 = sum(rent_400_449_2015, na.rm = TRUE),
rent_450_499_2015 = sum(rent_450_499_2015, na.rm = TRUE),
rent_500_549_2015 = sum(rent_500_549_2015, na.rm = TRUE),
rent_550_599_2015 = sum(rent_550_599_2015, na.rm = TRUE),
rent_600_649_2015 = sum(rent_600_649_2015, na.rm = TRUE),
rent_650_699_2015 = sum(rent_650_699_2015, na.rm = TRUE),
rent_700_749_2015 = sum(rent_700_749_2015, na.rm = TRUE),
rent_750_799_2015 = sum(rent_750_799_2015, na.rm = TRUE),
rent_800_899_2015 = sum(rent_800_899_2015, na.rm = TRUE),
rent_900_999_2015 = sum(rent_900_999_2015, na.rm = TRUE),
rent_1000_1249_2015 = sum(rent_1000_1249_2015, na.rm = TRUE),
rent_1250_1499_2015 = sum(rent_1250_1499_2015, na.rm = TRUE),
rent_1500_1999_2015 = sum(rent_1500_1999_2015, na.rm = TRUE),
rent_2000_2499_2015 = sum(rent_2000_2499_2015, na.rm = TRUE),
rent_2500_2999_2015 = sum(rent_2500_2999_2015, na.rm = TRUE),
rent_3000_3499_2015 = sum(rent_3000_3499_2015, na.rm = TRUE),
rent_3500_plus_2015 = sum(rent_3500_plus_2015, na.rm = TRUE),
households_cash_rent_2015 = sum(households_cash_rent_2015, na.rm = TRUE),
households_no_cash_rent_2015 = sum(households_no_cash_rent_2015, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2015 = sum(white_NH_race_2015, na.rm = TRUE),
    black_NH_race_2015 = sum(black_NH_race_2015, na.rm = TRUE),
    asian_NH_race_2015 = sum(asian_NH_race_2015, na.rm = TRUE),
    hisp_race_2015 = sum(hisp_race_2015, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2015 = sum(public_transit_users_2015, na.rm = TRUE),
    mean_commute_time_2015 = mean(mean_commute_time_2015, na.rm = TRUE),
    no_vehicle_households_2015 = sum(no_vehicle_households_2015, na.rm = TRUE),
    commute_alone_2015 = sum(commute_alone_2015, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_nbd_wide_2015)



```
```{r trial plots geometry, warning=FALSE, message=FALSE, results='hide'}

# Download the boundary of Newark city using places (for cities in NJ)
newark_city_sf <- places(state = "NJ", cb = TRUE) %>%
  filter(NAME == "Newark")  # Filter to only Newark city

# Download census tracts for Essex County (includes Newark city)
newark_tracts_sf_new <- get_acs(geography = "tract",
                                state = "NJ",
                                county = "Essex",
                                variables = "B01001_001",  # Total population
                                geometry = TRUE)

# Ensure both datasets (tracts and Newark city) are in the same CRS
newark_tracts_sf_new <- st_transform(newark_tracts_sf_new, st_crs(newark_city_sf))

# Filter tracts to keep only those within Newark city
newark_tracts_sf_new <- st_intersection(newark_tracts_sf_new, newark_city_sf)

# Ensure both datasets are in the same CRS
newark_nbd_sf <- st_transform(newark_nbd_sf, st_crs(newark_tracts_sf_new))

# Plot Census Tracts for Newark city
ggplot() + 
  geom_sf(data = newark_tracts_sf_new, fill = NA, color = "blue", lwd = 0.5) + 
  labs(title = "Census Tracts in Newark", 
       subtitle = "Blue: Census Tracts") + 
  theme_minimal()

# Plot Neighborhoods for Newark city
ggplot() + 
  geom_sf(data = newark_nbd_sf, fill = NA, color = "red", lwd = 1) + 
  labs(title = "Neighborhoods in Newark", 
       subtitle = "Red: Neighborhoods") + 
  theme_minimal()

# Plot Wards for Newark city
ggplot() + 
  geom_sf(data = newark_ward_sf, fill = NA, color = "green", lwd = 1) + 
  labs(title = "Wards in Newark", 
       subtitle = "Green: Wards") + 
  theme_minimal()

# Plot both Census Tracts and Neighborhoods for Newark city
ggplot() + 
  geom_sf(data = newark_tracts_sf_new, fill = NA, color = "blue", lwd = 0.5) +  # Census tracts in blue
  geom_sf(data = newark_nbd_sf, fill = NA, color = "red", lwd = 1) +  # Neighborhoods in red
  geom_sf(data = newark_ward_sf, fill = NA, color = "green", lwd = 1.3) +  # Wards in green
  labs(title = "Census Tracts, Neighborhoods and Wards in Newark", 
       subtitle = "Blue: Census Tracts | Red: Neighborhoods | Green: Wards") + 
  theme_minimal()



```

```{r large correlation matrix, warning=FALSE, message=FALSE, results='hide'}

# Set large figure size
options(repr.plot.width = 14, repr.plot.height = 14)

# Create correlation matrix for 2023
numeric_data_2023 <- newark_nbd_wide_2023 %>% select(where(is.numeric))
corr_matrix_2023 <- cor(numeric_data_2023, use = "pairwise.complete.obs", method = "pearson")

# Plot readable heatmap
ggcorrplot(corr_matrix_2023, 
           method = "square", # More space-efficient than "circle"
           type = "lower", 
           lab = TRUE, 
           tl.cex = 8, # Adjust text size
           tl.srt = 45, # Rotate labels for readability
           lab_size = 3, # Reduce number label size
           outline.color = "white", 
           ggtheme = theme_minimal(),
           title = "Correlation Matrix - Newark Neighborhoods (2023)",
           colors = c("red", "white", "blue"))

# Convert correlation matrix to data frame for interactive plotting
corr_df <- reshape2::melt(corr_matrix_2023)

# Create interactive plot with Plotly
p <- ggplot(corr_df, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "red", mid = "white", high = "blue") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Interactive Correlation Heatmap - Newark (2023)")

# Convert ggplot to interactive plot
ggplotly(p)

# Convert correlation matrix to long format
corr_long <- melt(corr_matrix_2023)

# Filter for strong correlations ( +0.9), excluding self-correlations
strong_corr <- corr_long %>%
  filter(abs(value) >= 0.9, Var1 != Var2) %>%
  arrange(desc(abs(value)))  # Sort by strength

# Remove duplicate pairs (since correlation matrix is symmetric)
strong_corr <- strong_corr %>%
  group_by(pmin(Var1, Var2), pmax(Var1, Var2)) %>%
  slice(1) %>%
  ungroup()

# View strong correlations
print(strong_corr)


# Filter for weak/negative correlations ( -0.5), excluding self-correlations
weak_corr <- corr_long %>%
  filter(value <= -0.5, Var1 != Var2) %>%
  arrange(value)  # Sort from most negative to least

# Remove duplicate pairs (since correlation matrix is symmetric)
weak_corr <- weak_corr %>%
  group_by(pmin(Var1, Var2), pmax(Var1, Var2)) %>%
  slice(1) %>%
  ungroup()

# View the weak correlation table
print(weak_corr)

```

```{r nbd selected variables, warning=FALSE, message=FALSE, results='hide'}

# List of selected variables with 2023 data
selected_variables_2023 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2023", "median_gross_rent_2023", "median_hh_income_2023", 
  "poverty_level_2023", "gini_index_2023", "highschool_dropout_2023", 
  "foreign_born_population_2023", "hisp_race_2023", "self_employed_not_incorporated_2023",
  "total_population_2023", "median_age_2023", "households_receiving_assistance_2023",
  "nonfamily_households_2023", "family_households_2023", # maybe use one variable for income and one for rent to avoid model bias
  
  # Market Dynamics
  "affordable_rents_2023", "high_rents_2023", "occupancy_permits_2023",
  "total_housing_units_2023", "total_occupied_units_2023", "units_built_2000_2009_2023",
  "public_transit_users_2023", "no_vehicle_households_2023", "median_home_value_2023",
  
  # "Gentrifier" Population
  "owner_occupied_units_2023", "renter_occupied_units_2023","owner_occupied_pct_2023", "non_hispanic_white_2023", 
  "bachelor_degree_or_higher_2023", "employment_industry_2023", 
  "female_median_age_2023", "male_median_age_2023", "remote_workers_2023",
  "service_industry_2023", "mgmt_business_sc_arts_industry_2023", # just use median age, not male female maybe # maybe can use commute_alone here too
  
  # Race & Ethnicity
  "white_NH_race_2023", "black_NH_race_2023", "asian_NH_race_2023", "hisp_race_2023"
)

# Create new data frame with only selected variables
newark_nbd_wide_selected_2023 <- newark_nbd_wide_2023 %>%
  select(any_of(selected_variables_2023))

# List of selected variables with 2022 data
selected_variables_2022 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2022", "median_gross_rent_2022", "median_hh_income_2022", 
  "poverty_level_2022", "gini_index_2022", "highschool_dropout_2022", 
  "foreign_born_population_2022", "hisp_race_2022", "self_employed_not_incorporated_2022",
  "total_population_2022", "median_age_2022", "households_receiving_assistance_2022",
  "nonfamily_households_2022", "family_households_2022",
  
  # Market Dynamics
  "affordable_rents_2022", "high_rents_2022", "occupancy_permits_2022",
  "total_housing_units_2022", "total_occupied_units_2022", "units_built_2000_2009_2022",
  "public_transit_users_2022", "no_vehicle_households_2022", "median_home_value_2022",
  
  # "Gentrifier" Population
  "owner_occupied_units_2022", "renter_occupied_units_2022", "owner_occupied_pct_2022", "non_hispanic_white_2022", 
  "bachelor_degree_or_higher_2022", "employment_industry_2022", 
  "female_median_age_2022", "male_median_age_2022", "remote_workers_2022",
  "service_industry_2022", "mgmt_business_sc_arts_industry_2022",
  
  # Race & Ethnicity
  "white_NH_race_2022", "black_NH_race_2022", "asian_NH_race_2022", "hisp_race_2022"
)

# Create new data frame with only selected variables for 2022
newark_nbd_wide_selected_2022 <- newark_nbd_wide_2022 %>%
  select(any_of(selected_variables_2022))

# List of selected variables with 2021 data
selected_variables_2021 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2021", "median_gross_rent_2021", "median_hh_income_2021", 
  "poverty_level_2021", "gini_index_2021", "highschool_dropout_2021", 
  "foreign_born_population_2021", "hisp_race_2021", "self_employed_not_incorporated_2021",
  "total_population_2021", "median_age_2021", "households_receiving_assistance_2021",
  "nonfamily_households_2021", "family_households_2021",
  
  # Market Dynamics
  "affordable_rents_2021", "high_rents_2021", "occupancy_permits_2021",
  "total_housing_units_2021", "total_occupied_units_2021", "units_built_2000_2009_2021",
  "public_transit_users_2021", "no_vehicle_households_2021", "median_home_value_2021",
  
  # "Gentrifier" Population
  "owner_occupied_units_2021", "renter_occupied_units_2021", "owner_occupied_pct_2021", "non_hispanic_white_2021", 
  "bachelor_degree_or_higher_2021", "employment_industry_2021", 
  "female_median_age_2021", "male_median_age_2021", "remote_workers_2021",
  "service_industry_2021", "mgmt_business_sc_arts_industry_2021",
  
  # Race & Ethnicity
  "white_NH_race_2021", "black_NH_race_2021", "asian_NH_race_2021", "hisp_race_2021"
)

# Create new data frame with only selected variables for 2021
newark_nbd_wide_selected_2021 <- newark_nbd_wide_2021 %>%
  select(any_of(selected_variables_2021))

# List of selected variables with 2020 data
selected_variables_2020 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2020", "median_gross_rent_2020", "median_hh_income_2020", 
  "poverty_level_2020", "gini_index_2020", "highschool_dropout_2020", 
  "foreign_born_population_2020", "hisp_race_2020", "self_employed_not_incorporated_2020",
  "total_population_2020", "median_age_2020", "households_receiving_assistance_2020",
  "nonfamily_households_2020", "family_households_2020",
  
  # Market Dynamics
  "affordable_rents_2020", "high_rents_2020", "occupancy_permits_2020",
  "total_housing_units_2020", "total_occupied_units_2020", "units_built_2000_2009_2020",
  "public_transit_users_2020", "no_vehicle_households_2020", "median_home_value_2020",
  
  # "Gentrifier" Population
  "owner_occupied_units_2020", "renter_occupied_units_2020", "owner_occupied_pct_2020", "non_hispanic_white_2020", 
  "bachelor_degree_or_higher_2020", "employment_industry_2020", 
  "female_median_age_2020", "male_median_age_2020", "remote_workers_2020",
  "service_industry_2020", "mgmt_business_sc_arts_industry_2020",
  
  # Race & Ethnicity
  "white_NH_race_2020", "black_NH_race_2020", "asian_NH_race_2020", "hisp_race_2020"
)

# Create new data frame with only selected variables for 2020
newark_nbd_wide_selected_2020 <- newark_nbd_wide_2020 %>%
  select(any_of(selected_variables_2020))

# List of selected variables with 2019 data
selected_variables_2019 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2019", "median_gross_rent_2019", "median_hh_income_2019", 
  "poverty_level_2019", "gini_index_2019", "highschool_dropout_2019", 
  "foreign_born_population_2019", "hisp_race_2019", "self_employed_not_incorporated_2019",
  "total_population_2019", "median_age_2019", "households_receiving_assistance_2019",
  "nonfamily_households_2019", "family_households_2019",
  
  # Market Dynamics
  "affordable_rents_2019", "high_rents_2019", "occupancy_permits_2019",
  "total_housing_units_2019", "total_occupied_units_2019", "units_built_2000_2009_2019",
  "public_transit_users_2019", "no_vehicle_households_2019", "median_home_value_2019",
  
  # "Gentrifier" Population
  "owner_occupied_units_2019", "renter_occupied_units_2019", "owner_occupied_pct_2019", "non_hispanic_white_2019", 
  "bachelor_degree_or_higher_2019", "employment_industry_2019", 
  "female_median_age_2019", "male_median_age_2019", "remote_workers_2019",
  "service_industry_2019", "mgmt_business_sc_arts_industry_2019",
  
  # Race & Ethnicity
  "white_NH_race_2019", "black_NH_race_2019", "asian_NH_race_2019", "hisp_race_2019"
)

# Create new data frame with only selected variables for 2019
newark_nbd_wide_selected_2019 <- newark_nbd_wide_2019 %>%
  select(any_of(selected_variables_2019))

# List of selected variables with 2018 data
selected_variables_2018 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2018", "median_gross_rent_2018", "median_hh_income_2018", 
  "poverty_level_2018", "gini_index_2018", "highschool_dropout_2018", 
  "foreign_born_population_2018", "hisp_race_2018", "self_employed_not_incorporated_2018",
  "total_population_2018", "median_age_2018", "households_receiving_assistance_2018",
  "nonfamily_households_2018", "family_households_2018",
  
  # Market Dynamics
  "affordable_rents_2018", "high_rents_2018", "occupancy_permits_2018",
  "total_housing_units_2018", "total_occupied_units_2018", "units_built_2000_2009_2018",
  "public_transit_users_2018", "no_vehicle_households_2018", "median_home_value_2018",
  
  # "Gentrifier" Population
  "owner_occupied_units_2018", "renter_occupied_units_2018", "owner_occupied_pct_2018", "non_hispanic_white_2018", 
  "bachelor_degree_or_higher_2018", "employment_industry_2018", 
  "female_median_age_2018", "male_median_age_2018", "remote_workers_2018",
  "service_industry_2018", "mgmt_business_sc_arts_industry_2018",
  
  # Race & Ethnicity
  "white_NH_race_2018", "black_NH_race_2018", "asian_NH_race_2018", "hisp_race_2018"
)

# Create new data frame with only selected variables for 2018
newark_nbd_wide_selected_2018 <- newark_nbd_wide_2018 %>%
  select(any_of(selected_variables_2018))

# List of selected variables with 2017 data
selected_variables_2017 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2017", "median_gross_rent_2017", "median_hh_income_2017", 
  "poverty_level_2017", "gini_index_2017", "highschool_dropout_2017", 
  "foreign_born_population_2017", "hisp_race_2017", "self_employed_not_incorporated_2017",
  "total_population_2017", "median_age_2017", "households_receiving_assistance_2017",
  "nonfamily_households_2017", "family_households_2017",
  
  # Market Dynamics
  "affordable_rents_2017", "high_rents_2017", "occupancy_permits_2017",
  "total_housing_units_2017", "total_occupied_units_2017", "units_built_2000_2009_2017",
  "public_transit_users_2017", "no_vehicle_households_2017", "median_home_value_2017",
  
  # "Gentrifier" Population
  "owner_occupied_units_2017", "renter_occupied_units_2017", "owner_occupied_pct_2017", "non_hispanic_white_2017", 
  "bachelor_degree_or_higher_2017", "employment_industry_2017", 
  "female_median_age_2017", "male_median_age_2017", "remote_workers_2017",
  "service_industry_2017", "mgmt_business_sc_arts_industry_2017",
  
  # Race & Ethnicity
  "white_NH_race_2017", "black_NH_race_2017", "asian_NH_race_2017", "hisp_race_2017"
)

# Create new data frame with only selected variables for 2017
newark_nbd_wide_selected_2017 <- newark_nbd_wide_2017 %>%
  select(any_of(selected_variables_2017))

# List of selected variables with 2016 data
selected_variables_2016 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2016", "median_gross_rent_2016", "median_hh_income_2016", 
  "poverty_level_2016", "gini_index_2016", "highschool_dropout_2016", 
  "foreign_born_population_2016", "hisp_race_2016", "self_employed_not_incorporated_2016",
  "total_population_2016", "median_age_2016", "households_receiving_assistance_2016",
  "nonfamily_households_2016", "family_households_2016",
  
  # Market Dynamics
  "affordable_rents_2016", "high_rents_2016", "occupancy_permits_2016",
  "total_housing_units_2016", "total_occupied_units_2016", "units_built_2000_2009_2016",
  "public_transit_users_2016", "no_vehicle_households_2016", "median_home_value_2016",
  
  # "Gentrifier" Population
  "owner_occupied_units_2016", "renter_occupied_units_2016", "owner_occupied_pct_2016", "non_hispanic_white_2016", 
  "bachelor_degree_or_higher_2016", "employment_industry_2016", 
  "female_median_age_2016", "male_median_age_2016", "remote_workers_2016",
  "service_industry_2016", "mgmt_business_sc_arts_industry_2016",
  
  # Race & Ethnicity
  "white_NH_race_2016", "black_NH_race_2016", "asian_NH_race_2016", "hisp_race_2016"
)

# Create new data frame with only selected variables for 2016
newark_nbd_wide_selected_2016 <- newark_nbd_wide_2016 %>%
  select(any_of(selected_variables_2016))

# List of selected variables with 2015 data
selected_variables_2015 <- c(
  "Neighborhood",
  # Vulnerability
  "rent_burden_50plus_2015", "median_gross_rent_2015", "median_hh_income_2015", 
  "poverty_level_2015", "gini_index_2015", "highschool_dropout_2015", 
  "foreign_born_population_2015", "hisp_race_2015", "self_employed_not_incorporated_2015",
  "total_population_2015", "median_age_2015", "households_receiving_assistance_2015",
  "nonfamily_households_2015", "family_households_2015",
  
  # Market Dynamics
  "affordable_rents_2015", "high_rents_2015", "occupancy_permits_2015",
  "total_housing_units_2015", "total_occupied_units_2015", "units_built_2000_2009_2015",
  "public_transit_users_2015", "no_vehicle_households_2015", "median_home_value_2015",
  
  # "Gentrifier" Population
  "owner_occupied_units_2015", "renter_occupied_units_2015", "owner_occupied_pct_2015", "non_hispanic_white_2015", 
  "bachelor_degree_or_higher_2015", "employment_industry_2015", 
  "female_median_age_2015", "male_median_age_2015", "remote_workers_2015",
  "service_industry_2015", "mgmt_business_sc_arts_industry_2015",
  
  # Race & Ethnicity
  "white_NH_race_2015", "black_NH_race_2015", "asian_NH_race_2015", "hisp_race_2015"
)

# Create new data frame with only selected variables for 2015
newark_nbd_wide_selected_2015 <- newark_nbd_wide_2015 %>%
  select(any_of(selected_variables_2015))



```

```{r nbd datasets, warning=FALSE, message=FALSE, results='hide'}

# Merge all years into one dataset with Neighborhood as the key
nbd_rent_burden_50plus <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, rent_burden_50plus_2015),
                                newark_nbd_wide_selected_2016 %>% select(Neighborhood, rent_burden_50plus_2016),
                                by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, rent_burden_50plus_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, rent_burden_50plus_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, rent_burden_50plus_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, rent_burden_50plus_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, rent_burden_50plus_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, rent_burden_50plus_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, rent_burden_50plus_2023), by = "Neighborhood")

nbd_median_gross_rent <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, median_gross_rent_2015),
                             newark_nbd_wide_selected_2016 %>% select(Neighborhood, median_gross_rent_2016),
                             by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, median_gross_rent_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, median_gross_rent_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, median_gross_rent_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, median_gross_rent_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, median_gross_rent_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, median_gross_rent_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, median_gross_rent_2023), by = "Neighborhood")

nbd_median_hh_income <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, median_hh_income_2015),
                            newark_nbd_wide_selected_2016 %>% select(Neighborhood, median_hh_income_2016),
                            by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, median_hh_income_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, median_hh_income_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, median_hh_income_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, median_hh_income_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, median_hh_income_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, median_hh_income_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, median_hh_income_2023), by = "Neighborhood")

nbd_poverty_level <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, poverty_level_2015),
                         newark_nbd_wide_selected_2016 %>% select(Neighborhood, poverty_level_2016),
                         by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, poverty_level_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, poverty_level_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, poverty_level_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, poverty_level_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, poverty_level_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, poverty_level_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, poverty_level_2023), by = "Neighborhood")

nbd_gini_index <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, gini_index_2015),
                      newark_nbd_wide_selected_2016 %>% select(Neighborhood, gini_index_2016),
                      by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, gini_index_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, gini_index_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, gini_index_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, gini_index_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, gini_index_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, gini_index_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, gini_index_2023), by = "Neighborhood")

nbd_highschool_dropout <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, highschool_dropout_2015),
                              newark_nbd_wide_selected_2016 %>% select(Neighborhood, highschool_dropout_2016),
                              by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, highschool_dropout_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, highschool_dropout_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, highschool_dropout_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, highschool_dropout_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, highschool_dropout_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, highschool_dropout_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, highschool_dropout_2023), by = "Neighborhood")

nbd_foreign_born_population <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, foreign_born_population_2015),
                                   newark_nbd_wide_selected_2016 %>% select(Neighborhood, foreign_born_population_2016),
                                   by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, foreign_born_population_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, foreign_born_population_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, foreign_born_population_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, foreign_born_population_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, foreign_born_population_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, foreign_born_population_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, foreign_born_population_2023), by = "Neighborhood")

nbd_hisp_race <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, hisp_race_2015),
                      newark_nbd_wide_selected_2016 %>% select(Neighborhood, hisp_race_2016),
                      by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, hisp_race_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, hisp_race_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, hisp_race_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, hisp_race_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, hisp_race_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, hisp_race_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, hisp_race_2023), by = "Neighborhood")

nbd_self_employed_not_incorporated <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, self_employed_not_incorporated_2015),
                                          newark_nbd_wide_selected_2016 %>% select(Neighborhood, self_employed_not_incorporated_2016),
                                          by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, self_employed_not_incorporated_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, self_employed_not_incorporated_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, self_employed_not_incorporated_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, self_employed_not_incorporated_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, self_employed_not_incorporated_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, self_employed_not_incorporated_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, self_employed_not_incorporated_2023), by = "Neighborhood")

nbd_total_population <- full_join(newark_nbd_wide_selected_2015 %>% select(Neighborhood, total_population_2015),
                            newark_nbd_wide_selected_2016 %>% select(Neighborhood, total_population_2016),
                            by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, total_population_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, total_population_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, total_population_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, total_population_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, total_population_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, total_population_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, total_population_2023), by = "Neighborhood")

nbd_median_age <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, median_age_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, median_age_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, median_age_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, median_age_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, median_age_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, median_age_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, median_age_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, median_age_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, median_age_2023), by = "Neighborhood")

nbd_households_receiving_assistance <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, households_receiving_assistance_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, households_receiving_assistance_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, households_receiving_assistance_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, households_receiving_assistance_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, households_receiving_assistance_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, households_receiving_assistance_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, households_receiving_assistance_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, households_receiving_assistance_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, households_receiving_assistance_2023), by = "Neighborhood")

nbd_nonfamily_households <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, nonfamily_households_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, nonfamily_households_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, nonfamily_households_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, nonfamily_households_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, nonfamily_households_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, nonfamily_households_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, nonfamily_households_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, nonfamily_households_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, nonfamily_households_2023), by = "Neighborhood")

nbd_family_households <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, family_households_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, family_households_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, family_households_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, family_households_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, family_households_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, family_households_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, family_households_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, family_households_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, family_households_2023), by = "Neighborhood")

nbd_total_housing_units <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, total_housing_units_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, total_housing_units_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, total_housing_units_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, total_housing_units_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, total_housing_units_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, total_housing_units_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, total_housing_units_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, total_housing_units_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, total_housing_units_2023), by = "Neighborhood")

nbd_total_occupied_units <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, total_occupied_units_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, total_occupied_units_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, total_occupied_units_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, total_occupied_units_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, total_occupied_units_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, total_occupied_units_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, total_occupied_units_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, total_occupied_units_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, total_occupied_units_2023), by = "Neighborhood")

nbd_public_transit_users <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, public_transit_users_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, public_transit_users_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, public_transit_users_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, public_transit_users_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, public_transit_users_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, public_transit_users_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, public_transit_users_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, public_transit_users_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, public_transit_users_2023), by = "Neighborhood")

nbd_no_vehicle_households <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, no_vehicle_households_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, no_vehicle_households_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, no_vehicle_households_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, no_vehicle_households_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, no_vehicle_households_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, no_vehicle_households_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, no_vehicle_households_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, no_vehicle_households_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, no_vehicle_households_2023), by = "Neighborhood")

nbd_median_home_value <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, median_home_value_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, median_home_value_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, median_home_value_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, median_home_value_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, median_home_value_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, median_home_value_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, median_home_value_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, median_home_value_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, median_home_value_2023), by = "Neighborhood")

nbd_owner_occupied_units <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, owner_occupied_units_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, owner_occupied_units_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, owner_occupied_units_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, owner_occupied_units_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, owner_occupied_units_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, owner_occupied_units_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, owner_occupied_units_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, owner_occupied_units_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, owner_occupied_units_2023), by = "Neighborhood")

nbd_renter_occupied_units <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, renter_occupied_units_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, renter_occupied_units_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, renter_occupied_units_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, renter_occupied_units_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, renter_occupied_units_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, renter_occupied_units_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, renter_occupied_units_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, renter_occupied_units_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, renter_occupied_units_2023), by = "Neighborhood")

nbd_bachelor_degree_or_higher <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, bachelor_degree_or_higher_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, bachelor_degree_or_higher_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, bachelor_degree_or_higher_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, bachelor_degree_or_higher_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, bachelor_degree_or_higher_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, bachelor_degree_or_higher_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, bachelor_degree_or_higher_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, bachelor_degree_or_higher_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, bachelor_degree_or_higher_2023), by = "Neighborhood")

nbd_employment_industry <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, employment_industry_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, employment_industry_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, employment_industry_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, employment_industry_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, employment_industry_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, employment_industry_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, employment_industry_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, employment_industry_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, employment_industry_2023), by = "Neighborhood")

nbd_remote_workers <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, remote_workers_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, remote_workers_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, remote_workers_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, remote_workers_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, remote_workers_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, remote_workers_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, remote_workers_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, remote_workers_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, remote_workers_2023), by = "Neighborhood")

nbd_service_industry <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, service_industry_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, service_industry_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, service_industry_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, service_industry_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, service_industry_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, service_industry_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, service_industry_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, service_industry_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, service_industry_2023), by = "Neighborhood")

nbd_mgmt_business_sc_arts_industry <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, mgmt_business_sc_arts_industry_2023), by = "Neighborhood")

nbd_white_NH_race <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, white_NH_race_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, white_NH_race_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, white_NH_race_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, white_NH_race_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, white_NH_race_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, white_NH_race_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, white_NH_race_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, white_NH_race_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, white_NH_race_2023), by = "Neighborhood")

nbd_black_NH_race <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, black_NH_race_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, black_NH_race_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, black_NH_race_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, black_NH_race_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, black_NH_race_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, black_NH_race_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, black_NH_race_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, black_NH_race_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, black_NH_race_2023), by = "Neighborhood")

nbd_asian_NH_race <- full_join(
  newark_nbd_wide_selected_2015 %>% select(Neighborhood, asian_NH_race_2015),
  newark_nbd_wide_selected_2016 %>% select(Neighborhood, asian_NH_race_2016),
  by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2017 %>% select(Neighborhood, asian_NH_race_2017), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2018 %>% select(Neighborhood, asian_NH_race_2018), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2019 %>% select(Neighborhood, asian_NH_race_2019), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2020 %>% select(Neighborhood, asian_NH_race_2020), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2021 %>% select(Neighborhood, asian_NH_race_2021), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2022 %>% select(Neighborhood, asian_NH_race_2022), by = "Neighborhood") %>%
  full_join(newark_nbd_wide_selected_2023 %>% select(Neighborhood, asian_NH_race_2023), by = "Neighborhood")


```


```{r nbd plots, warning=FALSE, message=FALSE, results='hide'}

#Median Age
# Reshape the wide-format dataset to long format
median_age_long <- nbd_median_age %>%
  pivot_longer(cols = starts_with("median_age"), 
               names_to = "Year", 
               values_to = "Median_Age") %>%
  mutate(Year = gsub("median_age_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
median_age_long$Year <- as.numeric(median_age_long$Year)

# Plot median age over the years for each neighborhood
ggplot(median_age_long, aes(x = Year, y = Median_Age, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Median Age Over the Years by Neighborhood",
       x = "Year",
       y = "Median Age",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Rent Burden 50Plus
# Reshape the wide-format dataset to long format
rent_burden_50plus_long <- nbd_rent_burden_50plus %>%
  pivot_longer(cols = starts_with("rent_burden_50plus"), 
               names_to = "Year", 
               values_to = "Rent_Burden_50plus") %>%
  mutate(Year = gsub("rent_burden_50plus_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
rent_burden_50plus_long$Year <- as.numeric(rent_burden_50plus_long$Year)

# Plot rent burdened households over the years for each neighborhood
ggplot(rent_burden_50plus_long, aes(x = Year, y = Rent_Burden_50plus, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Extreme Rent Burdened Households Over the Years by Neighborhood",
       x = "Year",
       y = "Rent Burden (50%)",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Median Gross Rent
# Reshape the wide-format dataset to long format
median_gross_rent_long <- nbd_median_gross_rent %>%
  pivot_longer(cols = starts_with("median_gross_rent"), 
               names_to = "Year", 
               values_to = "Median_Gross_Rent") %>%
  mutate(Year = gsub("median_gross_rent_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
median_gross_rent_long$Year <- as.numeric(median_gross_rent_long$Year)

# Plot median gross rent over the years for each neighborhood
ggplot(median_gross_rent_long, aes(x = Year, y = Median_Gross_Rent, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Median Gross Rent Over the Years by Neighborhood",
       x = "Year",
       y = "Median Gross Rent",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Median HH Income
# Reshape the wide-format dataset to long format
median_hh_income_long <- nbd_median_hh_income %>%
  pivot_longer(cols = starts_with("median_hh_income"), 
               names_to = "Year", 
               values_to = "Median_HH_Income") %>%
  mutate(Year = gsub("median_hh_income_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
median_hh_income_long$Year <- as.numeric(median_hh_income_long$Year)

# Plot median household income over the years for each neighborhood
ggplot(median_hh_income_long, aes(x = Year, y = Median_HH_Income, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Median Household Income Over the Years by Neighborhood",
       x = "Year",
       y = "Median Household Income",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Poverty Level
# Reshape the wide-format dataset to long format
poverty_level_long <- nbd_poverty_level %>%
  pivot_longer(cols = starts_with("poverty_level"), 
               names_to = "Year", 
               values_to = "Poverty_Level") %>%
  mutate(Year = gsub("poverty_level_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
poverty_level_long$Year <- as.numeric(poverty_level_long$Year)

# Plot poverty level over the years for each neighborhood
ggplot(poverty_level_long, aes(x = Year, y = Poverty_Level, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Poverty Level Over the Years by Neighborhood",
       x = "Year",
       y = "Poverty Level",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Gini Index
# Reshape the wide-format dataset to long format
gini_index_long <- nbd_gini_index %>%
  pivot_longer(cols = starts_with("gini_index"), 
               names_to = "Year", 
               values_to = "Gini_Index") %>%
  mutate(Year = gsub("gini_index_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
gini_index_long$Year <- as.numeric(gini_index_long$Year)

# Plot Gini index over the years for each neighborhood
ggplot(gini_index_long, aes(x = Year, y = Gini_Index, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Gini Index Over the Years by Neighborhood",
       x = "Year",
       y = "Gini Index",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Highschool Dropout
# Reshape the wide-format dataset to long format
highschool_dropout_long <- nbd_highschool_dropout %>%
  pivot_longer(cols = starts_with("highschool_dropout"), 
               names_to = "Year", 
               values_to = "Highschool_Dropout") %>%
  mutate(Year = gsub("highschool_dropout_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
highschool_dropout_long$Year <- as.numeric(highschool_dropout_long$Year)

# Plot high school dropout rate over the years for each neighborhood
ggplot(highschool_dropout_long, aes(x = Year, y = Highschool_Dropout, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "High School Dropout Rate Over the Years by Neighborhood",
       x = "Year",
       y = "High School Dropout Rate",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Foreign-born Population
# Reshape the wide-format dataset to long format
foreign_born_population_long <- nbd_foreign_born_population %>%
  pivot_longer(cols = starts_with("foreign_born_population"), 
               names_to = "Year", 
               values_to = "Foreign_Born_Population") %>%
  mutate(Year = gsub("foreign_born_population_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
foreign_born_population_long$Year <- as.numeric(foreign_born_population_long$Year)

# Plot foreign-born population over the years for each neighborhood
ggplot(foreign_born_population_long, aes(x = Year, y = Foreign_Born_Population, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Foreign-Born Population Over the Years by Neighborhood",
       x = "Year",
       y = "Foreign-Born Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Hispanic Race
# Reshape the wide-format dataset to long format
hisp_race_long <- nbd_hisp_race %>%
  pivot_longer(cols = starts_with("hisp_race"), 
               names_to = "Year", 
               values_to = "Hispanic_Race_Population") %>%
  mutate(Year = gsub("hisp_race_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
hisp_race_long$Year <- as.numeric(hisp_race_long$Year)

# Plot Hispanic race population over the years for each neighborhood
ggplot(hisp_race_long, aes(x = Year, y = Hispanic_Race_Population, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Hispanic Race Population Over the Years by Neighborhood",
       x = "Year",
       y = "Hispanic Race Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Self-employed Not Incorporated
# Reshape the wide-format dataset to long format
self_employed_not_incorporated_long <- nbd_self_employed_not_incorporated %>%
  pivot_longer(cols = starts_with("self_employed_not_incorporated"), 
               names_to = "Year", 
               values_to = "Self_Employed_Not_Incorporated") %>%
  mutate(Year = gsub("self_employed_not_incorporated_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
self_employed_not_incorporated_long$Year <- as.numeric(self_employed_not_incorporated_long$Year)

# Plot self-employed non-incorporated population over the years for each neighborhood
ggplot(self_employed_not_incorporated_long, aes(x = Year, y = Self_Employed_Not_Incorporated, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Self-Employed Non-Incorporated Population Over the Years by Neighborhood",
       x = "Year",
       y = "Self-Employed Non-Incorporated Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Total Population
# Reshape the wide-format dataset to long format
total_population_long <- nbd_total_population %>%
  pivot_longer(cols = starts_with("total_population"), 
               names_to = "Year", 
               values_to = "Total_Population") %>%
  mutate(Year = gsub("total_population_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
total_population_long$Year <- as.numeric(total_population_long$Year)

# Plot total population over the years for each neighborhood
ggplot(total_population_long, aes(x = Year, y = Total_Population, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Total Population Over the Years by Neighborhood",
       x = "Year",
       y = "Total Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Households Receiving Assistance
# Reshape the wide-format dataset to long format
households_receiving_assistance_long <- nbd_households_receiving_assistance %>%
  pivot_longer(cols = starts_with("households_receiving_assistance"), 
               names_to = "Year", 
               values_to = "Households_Receiving_Assistance") %>%
  mutate(Year = gsub("households_receiving_assistance_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
households_receiving_assistance_long$Year <- as.numeric(households_receiving_assistance_long$Year)

# Plot households receiving assistance over the years for each neighborhood
ggplot(households_receiving_assistance_long, aes(x = Year, y = Households_Receiving_Assistance, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Households Receiving Assistance Over the Years by Neighborhood",
       x = "Year",
       y = "Households Receiving Assistance",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Non-family Households
# Reshape the wide-format dataset to long format
nonfamily_households_long <- nbd_nonfamily_households %>%
  pivot_longer(cols = starts_with("nonfamily_households"), 
               names_to = "Year", 
               values_to = "Nonfamily_Households") %>%
  mutate(Year = gsub("nonfamily_households_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
nonfamily_households_long$Year <- as.numeric(nonfamily_households_long$Year)

# Plot non-family households over the years for each neighborhood
ggplot(nonfamily_households_long, aes(x = Year, y = Nonfamily_Households, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Non-Family Households Over the Years by Neighborhood",
       x = "Year",
       y = "Non-Family Households",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Family Households
# Reshape the wide-format dataset to long format
family_households_long <- nbd_family_households %>%
  pivot_longer(cols = starts_with("family_households"), 
               names_to = "Year", 
               values_to = "Family_Households") %>%
  mutate(Year = gsub("family_households_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
family_households_long$Year <- as.numeric(family_households_long$Year)

# Plot family households over the years for each neighborhood
ggplot(family_households_long, aes(x = Year, y = Family_Households, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Family Households Over the Years by Neighborhood",
       x = "Year",
       y = "Family Households",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Total Housing Units
# Reshape the wide-format dataset to long format
total_housing_units_long <- nbd_total_housing_units %>%
  pivot_longer(cols = starts_with("total_housing_units"), 
               names_to = "Year", 
               values_to = "Total_Housing_Units") %>%
  mutate(Year = gsub("total_housing_units_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
total_housing_units_long$Year <- as.numeric(total_housing_units_long$Year)

# Plot total housing units over the years for each neighborhood
ggplot(total_housing_units_long, aes(x = Year, y = Total_Housing_Units, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Total Housing Units Over the Years by Neighborhood",
       x = "Year",
       y = "Total Housing Units",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Total Occupied Units
# Reshape the wide-format dataset to long format
total_occupied_units_long <- nbd_total_occupied_units %>%
  pivot_longer(cols = starts_with("total_occupied_units"), 
               names_to = "Year", 
               values_to = "Total_Occupied_Units") %>%
  mutate(Year = gsub("total_occupied_units_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
total_occupied_units_long$Year <- as.numeric(total_occupied_units_long$Year)

# Plot total occupied units over the years for each neighborhood
ggplot(total_occupied_units_long, aes(x = Year, y = Total_Occupied_Units, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Total Occupied Units Over the Years by Neighborhood",
       x = "Year",
       y = "Total Occupied Units",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Public Transit Users
# Reshape the wide-format dataset to long format
public_transit_users_long <- nbd_public_transit_users %>%
  pivot_longer(cols = starts_with("public_transit_users"), 
               names_to = "Year", 
               values_to = "Public_Transit_Users") %>%
  mutate(Year = gsub("public_transit_users_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
public_transit_users_long$Year <- as.numeric(public_transit_users_long$Year)

# Plot public transit users over the years for each neighborhood
ggplot(public_transit_users_long, aes(x = Year, y = Public_Transit_Users, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Public Transit Users Over the Years by Neighborhood",
       x = "Year",
       y = "Public Transit Users",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# No Vehicle Households
# Reshape the wide-format dataset to long format
no_vehicle_households_long <- nbd_no_vehicle_households %>%
  pivot_longer(cols = starts_with("no_vehicle_households"), 
               names_to = "Year", 
               values_to = "No_Vehicle_Households") %>%
  mutate(Year = gsub("no_vehicle_households_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
no_vehicle_households_long$Year <- as.numeric(no_vehicle_households_long$Year)

# Plot households with no vehicle over the years for each neighborhood
ggplot(no_vehicle_households_long, aes(x = Year, y = No_Vehicle_Households, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Households with No Vehicle Over the Years by Neighborhood",
       x = "Year",
       y = "Households with No Vehicle",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Median Home Value
# Reshape the wide-format dataset to long format
median_home_value_long <- nbd_median_home_value %>%
  pivot_longer(cols = starts_with("median_home_value"), 
               names_to = "Year", 
               values_to = "Median_Home_Value") %>%
  mutate(Year = gsub("median_home_value_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
median_home_value_long$Year <- as.numeric(median_home_value_long$Year)

# Plot median home value over the years for each neighborhood
ggplot(median_home_value_long, aes(x = Year, y = Median_Home_Value, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Median Home Value Over the Years by Neighborhood",
       x = "Year",
       y = "Median Home Value",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Owner Occupied Units
# Reshape the wide-format dataset to long format
owner_occupied_units_long <- nbd_owner_occupied_units %>%
  pivot_longer(cols = starts_with("owner_occupied_units"), 
               names_to = "Year", 
               values_to = "Owner_Occupied_Units") %>%
  mutate(Year = gsub("owner_occupied_units_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
owner_occupied_units_long$Year <- as.numeric(owner_occupied_units_long$Year)

# Plot owner-occupied units over the years for each neighborhood
ggplot(owner_occupied_units_long, aes(x = Year, y = Owner_Occupied_Units, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Owner-Occupied Units Over the Years by Neighborhood",
       x = "Year",
       y = "Owner-Occupied Units",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Renter Occupied Units
# Reshape the wide-format dataset to long format
renter_occupied_units_long <- nbd_renter_occupied_units %>%
  pivot_longer(cols = starts_with("renter_occupied_units"), 
               names_to = "Year", 
               values_to = "Renter_Occupied_Units") %>%
  mutate(Year = gsub("renter_occupied_units_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
renter_occupied_units_long$Year <- as.numeric(renter_occupied_units_long$Year)

# Plot renter-occupied units over the years for each neighborhood
ggplot(renter_occupied_units_long, aes(x = Year, y = Renter_Occupied_Units, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Renter-Occupied Units Over the Years by Neighborhood",
       x = "Year",
       y = "Renter-Occupied Units",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Bachelors Degree or Higher
# Reshape the wide-format dataset to long format
bachelor_degree_or_higher_long <- nbd_bachelor_degree_or_higher %>%
  pivot_longer(cols = starts_with("bachelor_degree_or_higher"), 
               names_to = "Year", 
               values_to = "Bachelors_Degree_or_Higher") %>%
  mutate(Year = gsub("bachelor_degree_or_higher_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
bachelor_degree_or_higher_long$Year <- as.numeric(bachelor_degree_or_higher_long$Year)

# Plot bachelor's degree or higher population over the years for each neighborhood
ggplot(bachelor_degree_or_higher_long, aes(x = Year, y = Bachelors_Degree_or_Higher, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Bachelor's Degree or Higher Over the Years by Neighborhood",
       x = "Year",
       y = "Bachelor's Degree or Higher Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Remote Workers
# Reshape the wide-format dataset to long format
remote_workers_long <- nbd_remote_workers %>%
  pivot_longer(cols = starts_with("remote_workers"), 
               names_to = "Year", 
               values_to = "Remote_Workers") %>%
  mutate(Year = gsub("remote_workers_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
remote_workers_long$Year <- as.numeric(remote_workers_long$Year)

# Plot remote workers over the years for each neighborhood
ggplot(remote_workers_long, aes(x = Year, y = Remote_Workers, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Remote Workers Over the Years by Neighborhood",
       x = "Year",
       y = "Remote Workers",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Service Industry
# Reshape the wide-format dataset to long format
service_industry_long <- nbd_service_industry %>%
  pivot_longer(cols = starts_with("service_industry"), 
               names_to = "Year", 
               values_to = "Service_Industry") %>%
  mutate(Year = gsub("service_industry_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
service_industry_long$Year <- as.numeric(service_industry_long$Year)

# Plot service industry over the years for each neighborhood
ggplot(service_industry_long, aes(x = Year, y = Service_Industry, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Service Industry Employment Over the Years by Neighborhood",
       x = "Year",
       y = "Service Industry Employment",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Management, Business, Science, Arts Industry
# Reshape the wide-format dataset to long format
mgmt_business_sc_arts_industry_long <- nbd_mgmt_business_sc_arts_industry %>%
  pivot_longer(cols = starts_with("mgmt_business_sc_arts_industry"), 
               names_to = "Year", 
               values_to = "Mgmt_Business_Sc_Arts_Industry") %>%
  mutate(Year = gsub("mgmt_business_sc_arts_industry_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
mgmt_business_sc_arts_industry_long$Year <- as.numeric(mgmt_business_sc_arts_industry_long$Year)

# Plot management, business, science, and arts industry over the years for each neighborhood
ggplot(mgmt_business_sc_arts_industry_long, aes(x = Year, y = Mgmt_Business_Sc_Arts_Industry, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Management, Business, Science, and Arts Industry Employment Over the Years by Neighborhood",
       x = "Year",
       y = "Mgmt, Business, Science, and Arts Industry Employment",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# White Population
# Reshape the wide-format dataset to long format
white_NH_race_long <- nbd_white_NH_race %>%
  pivot_longer(cols = starts_with("white_NH_race"), 
               names_to = "Year", 
               values_to = "White_NH_Race") %>%
  mutate(Year = gsub("white_NH_race_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
white_NH_race_long$Year <- as.numeric(white_NH_race_long$Year)

# Plot white non-Hispanic population over the years for each neighborhood
ggplot(white_NH_race_long, aes(x = Year, y = White_NH_Race, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "White Non-Hispanic Population Over the Years by Neighborhood",
       x = "Year",
       y = "White Non-Hispanic Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Black Population
# Reshape the wide-format dataset to long format
black_NH_race_long <- nbd_black_NH_race %>%
  pivot_longer(cols = starts_with("black_NH_race"), 
               names_to = "Year", 
               values_to = "Black_NH_Race") %>%
  mutate(Year = gsub("black_NH_race_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
black_NH_race_long$Year <- as.numeric(black_NH_race_long$Year)

# Plot black non-Hispanic population over the years for each neighborhood
ggplot(black_NH_race_long, aes(x = Year, y = Black_NH_Race, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Black Non-Hispanic Population Over the Years by Neighborhood",
       x = "Year",
       y = "Black Non-Hispanic Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

# Asian Population
# Reshape the wide-format dataset to long format
asian_NH_race_long <- nbd_asian_NH_race %>%
  pivot_longer(cols = starts_with("asian_NH_race"), 
               names_to = "Year", 
               values_to = "Asian_NH_Race") %>%
  mutate(Year = gsub("asian_NH_race_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
asian_NH_race_long$Year <- as.numeric(asian_NH_race_long$Year)

# Plot asian non-Hispanic population over the years for each neighborhood
ggplot(asian_NH_race_long, aes(x = Year, y = Asian_NH_Race, color = Neighborhood, group = Neighborhood)) +
  geom_line() +  # Draw lines for each neighborhood
  labs(title = "Asian Non-Hispanic Population Over the Years by Neighborhood",
       x = "Year",
       y = "Asian Non-Hispanic Population",
       color = "Neighborhood") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right






```


```{r ward aggregate data, warning=FALSE, message=FALSE, results='hide'}

newark_tracts_sf_new <- st_transform(newark_tracts_sf_new, st_crs(newark_ward_sf))
newark_ward_sf <- st_transform(newark_ward_sf, st_crs(newark_tracts_sf_new))

# Ensure the same CRS
newark_tracts_sf_new <- st_transform(newark_tracts_sf_new, st_crs(newark_ward_sf))

# Convert to POLYGON if necessary
newark_ward_sf <- st_cast(newark_ward_sf, "POLYGON")

# Expand tract boundaries slightly
newark_tracts_sf_new <- st_buffer(newark_tracts_sf_new, dist = 0.0001)

# Spatial join using intersects instead of within
newark_tracts_with_wards <- st_join(newark_tracts_sf_new, newark_ward_sf, join = st_intersects)

# Select only necessary columns
newark_tracts_with_wards <- newark_tracts_with_wards[, c("NAME", "WARD_NAME")]

# Convert to a regular data frame if needed
newark_tracts_with_wards <- as.data.frame(newark_tracts_with_wards)

# Check for missing assignments
missing_tracts <- newark_tracts_with_wards %>% filter(is.na(WARD_NAME))
print(missing_tracts)

# Rename columns and clean up the NAME column
newark_tracts_with_wards <- newark_tracts_with_wards %>%
  rename(Census_Tract = NAME, Ward = WARD_NAME) %>%
  mutate(Census_Tract = gsub("; Essex County; New Jersey", "", Census_Tract))

# View the updated data frame
head(newark_tracts_with_wards)

# Merge the data to add the Ward column
newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2023 <- newark_tract_wide_2023 %>%
  relocate(Ward, .after = Neighborhood)

# Merge the data to add the Ward column
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2022 <- newark_tract_wide_2022 %>%
  relocate(Ward, .after = Neighborhood)

# Merge the data to add the Ward column
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2021 <- newark_tract_wide_2021 %>%
  relocate(Ward, .after = Neighborhood)

# Merge the data to add the Ward column
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2020 <- newark_tract_wide_2020 %>%
  relocate(Ward, .after = Neighborhood)

# Merge the data to add the Ward column
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2019 <- newark_tract_wide_2019 %>%
  relocate(Ward, .after = Neighborhood)


# Merge the data to add the Ward column
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2018 <- newark_tract_wide_2018 %>%
  relocate(Ward, .after = Neighborhood)


# Merge the data to add the Ward column
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2017 <- newark_tract_wide_2017 %>%
  relocate(Ward, .after = Neighborhood)


# Merge the data to add the Ward column
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2016 <- newark_tract_wide_2016 %>%
  relocate(Ward, .after = Neighborhood)


# Merge the data to add the Ward column
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  left_join(newark_tracts_with_wards, by = "Census_Tract")

# Reorder columns to place 'Ward' after 'Neighborhood'
newark_tract_wide_2015 <- newark_tract_wide_2015 %>%
  relocate(Ward, .after = Neighborhood)

```

```{r ward datsets, warning=FALSE, message=FALSE, results='hide'}

# Aggregate data by Ward
newark_ward_wide_2023 <- newark_tract_wide_2023 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2023 = sum(total_population_2023, na.rm = TRUE),
    total_male_population_2023 = sum(total_male_population_2023, na.rm = TRUE),
    total_female_population_2023 = sum(total_female_population_2023, na.rm = TRUE),
    median_age_2023 = mean(median_age_2023, na.rm = TRUE),
    male_median_age_2023 = mean(male_median_age_2023, na.rm = TRUE),
    female_median_age_2023 = mean(female_median_age_2023, na.rm = TRUE),
    recent_movers_2023 = sum(recent_movers_2023, na.rm = TRUE),
    foreign_born_population_2023 = sum(foreign_born_population_2023, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2023 = sum(self_employed_incorporated_2023, na.rm = TRUE),
    self_employed_not_incorporated_2023 = sum(self_employed_not_incorporated_2023, na.rm = TRUE),
    employment_industry_2023 = sum(employment_industry_2023, na.rm = TRUE),
    worker_class_2023 = sum(worker_class_2023, na.rm = TRUE),
    median_hh_income_2023 = mean(median_hh_income_2023, na.rm = TRUE),
    per_capita_income_2023 = mean(per_capita_income_2023, na.rm = TRUE),
    gini_index_2023 = mean(gini_index_2023, na.rm = TRUE),
    poverty_level_2023 = sum(poverty_level_2023, na.rm = TRUE), ####

    # Education
    bachelor_degree_or_higher_2023 = sum(bachelor_degree_or_higher_2023, na.rm = TRUE),
    bachelor_male_2023 = sum(bachelor_male_2023, na.rm = TRUE),
    masters_male_2023 = sum(masters_male_2023, na.rm = TRUE),
    doctorate_male_2023 = sum(doctorate_male_2023, na.rm = TRUE),
    bachelor_female_2023 = sum(bachelor_female_2023, na.rm = TRUE),
    masters_female_2023 = sum(masters_female_2023, na.rm = TRUE),
    doctorate_female_2023 = sum(doctorate_female_2023, na.rm = TRUE),
    professional_degree_male_2023 = sum(professional_degree_male_2023, na.rm = TRUE),
    professional_degree_female_2023 = sum(professional_degree_female_2023, na.rm = TRUE),
    educational_attainment_total_2023 = sum(educational_attainment_total_2023, na.rm = TRUE),
    highschool_dropout_2023 = sum(highschool_dropout_2023, na.rm = TRUE),

    # Employment
    total_labor_force_2023 = sum(total_labor_force_2023, na.rm = TRUE),
    total_employed_2023 = sum(total_employed_2023, na.rm = TRUE),
    total_unemployed_2023 = sum(total_unemployed_2023, na.rm = TRUE),
    remote_workers_2023 = sum(remote_workers_2023, na.rm = TRUE),
    service_industry_2023 = sum(service_industry_2023, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2023 = sum(mgmt_business_sc_arts_industry_2023, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2023 = sum(total_households_2023, na.rm = TRUE),
    family_households_2023 = sum(family_households_2023, na.rm = TRUE),
    nonfamily_households_2023 = sum(nonfamily_households_2023, na.rm = TRUE),
    households_with_children_2023 = sum(households_with_children_2023, na.rm = TRUE),

    # Health
    disabled_population_2023 = sum(disabled_population_2023, na.rm = TRUE),

    # Housing
    total_housing_units_2023 = sum(total_housing_units_2023, na.rm = TRUE),
    median_gross_rent_2023 = mean(median_gross_rent_2023, na.rm = TRUE),
    median_home_value_2023 = mean(median_home_value_2023, na.rm = TRUE),
    rent_burden_30plus_2023 = sum(rent_burden_30plus_2023, na.rm = TRUE),
    rent_burden_50plus_2023 = sum(rent_burden_50plus_2023, na.rm = TRUE),
    owner_occupied_units_2023 = sum(owner_occupied_units_2023, na.rm = TRUE),
    renter_occupied_units_2023 = sum(renter_occupied_units_2023, na.rm = TRUE),
    total_occupied_units_2023 = sum(total_occupied_units_2023, na.rm = TRUE),
    total_vacant_units_2023 = sum(total_vacant_units_2023, na.rm = TRUE),
    units_built_2020plus_2023 = sum(units_built_2020plus_2023, na.rm = TRUE),
    units_built_2010_2019_2023 = sum(units_built_2010_2019_2023, na.rm = TRUE),
    units_built_2000_2009_2023 = sum(units_built_2000_2009_2023, na.rm = TRUE),
    overcrowded_owner_occupied_households_2023 = sum(overcrowded_owner_occupied_households_2023, na.rm = TRUE),
    housing_before_1939_2023 = sum(housing_before_1939_2023, na.rm = TRUE),
    households_receiving_assistance_2023 = sum(households_receiving_assistance_2023, na.rm = TRUE),
    rent_100_below_2023 = sum(rent_100_below_2023, na.rm = TRUE),
    rent_100_149_2023 = sum(rent_100_149_2023, na.rm = TRUE),
    rent_150_199_2023 = sum(rent_150_199_2023, na.rm = TRUE),
    rent_200_249_2023 = sum(rent_200_249_2023, na.rm = TRUE),
    rent_250_299_2023 = sum(rent_250_299_2023, na.rm = TRUE),
    rent_300_349_2023 = sum(rent_300_349_2023, na.rm = TRUE),
    rent_350_399_2023 = sum(rent_350_399_2023, na.rm = TRUE),
    rent_400_449_2023 = sum(rent_400_449_2023, na.rm = TRUE),
    rent_450_499_2023 = sum(rent_450_499_2023, na.rm = TRUE),
    rent_500_549_2023 = sum(rent_500_549_2023, na.rm = TRUE),
    rent_550_599_2023 = sum(rent_550_599_2023, na.rm = TRUE),
    rent_600_649_2023 = sum(rent_600_649_2023, na.rm = TRUE),
    rent_650_699_2023 = sum(rent_650_699_2023, na.rm = TRUE),
    rent_700_749_2023 = sum(rent_700_749_2023, na.rm = TRUE),
    rent_750_799_2023 = sum(rent_750_799_2023, na.rm = TRUE),
    rent_800_899_2023 = sum(rent_800_899_2023, na.rm = TRUE),
    rent_900_999_2023 = sum(rent_900_999_2023, na.rm = TRUE),
    rent_1000_1249_2023 = sum(rent_1000_1249_2023, na.rm = TRUE),
    rent_1250_1499_2023 = sum(rent_1250_1499_2023, na.rm = TRUE),
    rent_1500_1999_2023 = sum(rent_1500_1999_2023, na.rm = TRUE),
    rent_2000_2499_2023 = sum(rent_2000_2499_2023, na.rm = TRUE),
    rent_2500_2999_2023 = sum(rent_2500_2999_2023, na.rm = TRUE),
    rent_3000_3499_2023 = sum(rent_3000_3499_2023, na.rm = TRUE),
    rent_3500_plus_2023 = sum(rent_3500_plus_2023, na.rm = TRUE),
    households_cash_rent_2023 = sum(households_cash_rent_2023, na.rm = TRUE),
    households_no_cash_rent_2023 = sum(households_no_cash_rent_2023, na.rm = TRUE),

    # Race & Ethnicity
    white_NH_race_2023 = sum(white_NH_race_2023, na.rm = TRUE),
    black_NH_race_2023 = sum(black_NH_race_2023, na.rm = TRUE),
    asian_NH_race_2023 = sum(asian_NH_race_2023, na.rm = TRUE),
    hisp_race_2023 = sum(hisp_race_2023, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2023 = sum(public_transit_users_2023, na.rm = TRUE),
    mean_commute_time_2023 = mean(mean_commute_time_2023, na.rm = TRUE),
    no_vehicle_households_2023 = sum(no_vehicle_households_2023, na.rm = TRUE),
    commute_alone_2023 = sum(commute_alone_2023, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2023)

# Aggregate data by Neighborhood
newark_ward_wide_2022 <- newark_tract_wide_2022 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2022 = sum(total_population_2022, na.rm = TRUE),
    total_male_population_2022 = sum(total_male_population_2022, na.rm = TRUE),
    total_female_population_2022 = sum(total_female_population_2022, na.rm = TRUE),
    median_age_2022 = mean(median_age_2022, na.rm = TRUE),
    male_median_age_2022 = mean(male_median_age_2022, na.rm = TRUE),
    female_median_age_2022 = mean(female_median_age_2022, na.rm = TRUE),
    recent_movers_2022 = sum(recent_movers_2022, na.rm = TRUE),
    foreign_born_population_2022 = sum(foreign_born_population_2022, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2022 = sum(self_employed_incorporated_2022, na.rm = TRUE),
    self_employed_not_incorporated_2022 = sum(self_employed_not_incorporated_2022, na.rm = TRUE),
    employment_industry_2022 = sum(employment_industry_2022, na.rm = TRUE),
    worker_class_2022 = sum(worker_class_2022, na.rm = TRUE),
    median_hh_income_2022 = mean(median_hh_income_2022, na.rm = TRUE),
    per_capita_income_2022 = mean(per_capita_income_2022, na.rm = TRUE),
    gini_index_2022 = mean(gini_index_2022, na.rm = TRUE),
    poverty_level_2022 = sum(poverty_level_2022, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2022 = sum(bachelor_degree_or_higher_2022, na.rm = TRUE),
    bachelor_male_2022 = sum(bachelor_male_2022, na.rm = TRUE),
    masters_male_2022 = sum(masters_male_2022, na.rm = TRUE),
    doctorate_male_2022 = sum(doctorate_male_2022, na.rm = TRUE),
    bachelor_female_2022 = sum(bachelor_female_2022, na.rm = TRUE),
    masters_female_2022 = sum(masters_female_2022, na.rm = TRUE),
    doctorate_female_2022 = sum(doctorate_female_2022, na.rm = TRUE),
    professional_degree_male_2022 = sum(professional_degree_male_2022, na.rm = TRUE),
    professional_degree_female_2022 = sum(professional_degree_female_2022, na.rm = TRUE),
    educational_attainment_total_2022 = sum(educational_attainment_total_2022, na.rm = TRUE),
    highschool_dropout_2022 = sum(highschool_dropout_2022, na.rm = TRUE),

    # Employment
    total_labor_force_2022 = sum(total_labor_force_2022, na.rm = TRUE),
    total_employed_2022 = sum(total_employed_2022, na.rm = TRUE),
    total_unemployed_2022 = sum(total_unemployed_2022, na.rm = TRUE),
    remote_workers_2022 = sum(remote_workers_2022, na.rm = TRUE),
    service_industry_2022 = sum(service_industry_2022, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2022 = sum(mgmt_business_sc_arts_industry_2022, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2022 = sum(total_households_2022, na.rm = TRUE),
    family_households_2022 = sum(family_households_2022, na.rm = TRUE),
    nonfamily_households_2022 = sum(nonfamily_households_2022, na.rm = TRUE),
    households_with_children_2022 = sum(households_with_children_2022, na.rm = TRUE),

    # Health
    disabled_population_2022 = sum(disabled_population_2022, na.rm = TRUE),

    # Housing
    total_housing_units_2022 = sum(total_housing_units_2022, na.rm = TRUE),
    median_gross_rent_2022 = mean(median_gross_rent_2022, na.rm = TRUE),
    median_home_value_2022 = mean(median_home_value_2022, na.rm = TRUE),
    rent_burden_30plus_2022 = sum(rent_burden_30plus_2022, na.rm = TRUE),
    rent_burden_50plus_2022 = sum(rent_burden_50plus_2022, na.rm = TRUE),
    owner_occupied_units_2022 = sum(owner_occupied_units_2022, na.rm = TRUE),
    renter_occupied_units_2022 = sum(renter_occupied_units_2022, na.rm = TRUE),
    total_occupied_units_2022 = sum(total_occupied_units_2022, na.rm = TRUE),
    total_vacant_units_2022 = sum(total_vacant_units_2022, na.rm = TRUE),
    units_built_2020plus_2022 = sum(units_built_2020plus_2022, na.rm = TRUE),
    units_built_2010_2019_2022 = sum(units_built_2010_2019_2022, na.rm = TRUE),
    units_built_2000_2009_2022 = sum(units_built_2000_2009_2022, na.rm = TRUE),
    overcrowded_owner_occupied_households_2022 = sum(overcrowded_owner_occupied_households_2022, na.rm = TRUE),
    housing_before_1939_2022 = sum(housing_before_1939_2022, na.rm = TRUE),
    households_receiving_assistance_2022 = sum(households_receiving_assistance_2022, na.rm = TRUE),
    rent_100_below_2022 = sum(rent_100_below_2022, na.rm = TRUE),
    rent_100_149_2022 = sum(rent_100_149_2022, na.rm = TRUE),
    rent_150_199_2022 = sum(rent_150_199_2022, na.rm = TRUE),
    rent_200_249_2022 = sum(rent_200_249_2022, na.rm = TRUE),
    rent_250_299_2022 = sum(rent_250_299_2022, na.rm = TRUE),
    rent_300_349_2022 = sum(rent_300_349_2022, na.rm = TRUE),
    rent_350_399_2022 = sum(rent_350_399_2022, na.rm = TRUE),
    rent_400_449_2022 = sum(rent_400_449_2022, na.rm = TRUE),
    rent_450_499_2022 = sum(rent_450_499_2022, na.rm = TRUE),
    rent_500_549_2022 = sum(rent_500_549_2022, na.rm = TRUE),
    rent_550_599_2022 = sum(rent_550_599_2022, na.rm = TRUE),
    rent_600_649_2022 = sum(rent_600_649_2022, na.rm = TRUE),
    rent_650_699_2022 = sum(rent_650_699_2022, na.rm = TRUE),
    rent_700_749_2022 = sum(rent_700_749_2022, na.rm = TRUE),
    rent_750_799_2022 = sum(rent_750_799_2022, na.rm = TRUE),
    rent_800_899_2022 = sum(rent_800_899_2022, na.rm = TRUE),
    rent_900_999_2022 = sum(rent_900_999_2022, na.rm = TRUE),
    rent_1000_1249_2022 = sum(rent_1000_1249_2022, na.rm = TRUE),
    rent_1250_1499_2022 = sum(rent_1250_1499_2022, na.rm = TRUE),
    rent_1500_1999_2022 = sum(rent_1500_1999_2022, na.rm = TRUE),
    rent_2000_2499_2022 = sum(rent_2000_2499_2022, na.rm = TRUE),
    rent_2500_2999_2022 = sum(rent_2500_2999_2022, na.rm = TRUE),
    rent_3000_3499_2022 = sum(rent_3000_3499_2022, na.rm = TRUE),
    rent_3500_plus_2022 = sum(rent_3500_plus_2022, na.rm = TRUE),
    households_cash_rent_2022 = sum(households_cash_rent_2022, na.rm = TRUE),
    households_no_cash_rent_2022 = sum(households_no_cash_rent_2022, na.rm = TRUE),

    # Race & Ethnicity
    white_NH_race_2022 = sum(white_NH_race_2022, na.rm = TRUE),
    black_NH_race_2022 = sum(black_NH_race_2022, na.rm = TRUE),
    asian_NH_race_2022 = sum(asian_NH_race_2022, na.rm = TRUE),
    hisp_race_2022 = sum(hisp_race_2022, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2022 = sum(public_transit_users_2022, na.rm = TRUE),
    mean_commute_time_2022 = mean(mean_commute_time_2022, na.rm = TRUE),
    no_vehicle_households_2022 = sum(no_vehicle_households_2022, na.rm = TRUE),
    commute_alone_2022 = sum(commute_alone_2022, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2022)


# Aggregate data by Neighborhood
newark_ward_wide_2021 <- newark_tract_wide_2021 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2021 = sum(total_population_2021, na.rm = TRUE),
    total_male_population_2021 = sum(total_male_population_2021, na.rm = TRUE),
    total_female_population_2021 = sum(total_female_population_2021, na.rm = TRUE),
    median_age_2021 = mean(median_age_2021, na.rm = TRUE),
    male_median_age_2021 = mean(male_median_age_2021, na.rm = TRUE),
    female_median_age_2021 = mean(female_median_age_2021, na.rm = TRUE),
    recent_movers_2021 = sum(recent_movers_2021, na.rm = TRUE),
    foreign_born_population_2021 = sum(foreign_born_population_2021, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2021 = sum(self_employed_incorporated_2021, na.rm = TRUE),
    self_employed_not_incorporated_2021 = sum(self_employed_not_incorporated_2021, na.rm = TRUE),
    employment_industry_2021 = sum(employment_industry_2021, na.rm = TRUE),
    worker_class_2021 = sum(worker_class_2021, na.rm = TRUE),
    median_hh_income_2021 = mean(median_hh_income_2021, na.rm = TRUE),
    per_capita_income_2021 = mean(per_capita_income_2021, na.rm = TRUE),
    gini_index_2021 = mean(gini_index_2021, na.rm = TRUE),
    poverty_level_2021 = sum(poverty_level_2021, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2021 = sum(bachelor_degree_or_higher_2021, na.rm = TRUE),
    bachelor_male_2021 = sum(bachelor_male_2021, na.rm = TRUE),
    masters_male_2021 = sum(masters_male_2021, na.rm = TRUE),
    doctorate_male_2021 = sum(doctorate_male_2021, na.rm = TRUE),
    bachelor_female_2021 = sum(bachelor_female_2021, na.rm = TRUE),
    masters_female_2021 = sum(masters_female_2021, na.rm = TRUE),
    doctorate_female_2021 = sum(doctorate_female_2021, na.rm = TRUE),
    professional_degree_male_2021 = sum(professional_degree_male_2021, na.rm = TRUE),
    professional_degree_female_2021 = sum(professional_degree_female_2021, na.rm = TRUE),
    educational_attainment_total_2021 = sum(educational_attainment_total_2021, na.rm = TRUE),
    highschool_dropout_2021 = sum(highschool_dropout_2021, na.rm = TRUE),

    # Employment
    total_labor_force_2021 = sum(total_labor_force_2021, na.rm = TRUE),
    total_employed_2021 = sum(total_employed_2021, na.rm = TRUE),
    total_unemployed_2021 = sum(total_unemployed_2021, na.rm = TRUE),
    remote_workers_2021 = sum(remote_workers_2021, na.rm = TRUE),
    service_industry_2021 = sum(service_industry_2021, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2021 = sum(mgmt_business_sc_arts_industry_2021, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2021 = sum(total_households_2021, na.rm = TRUE),
    family_households_2021 = sum(family_households_2021, na.rm = TRUE),
    nonfamily_households_2021 = sum(nonfamily_households_2021, na.rm = TRUE),
    households_with_children_2021 = sum(households_with_children_2021, na.rm = TRUE),

    # Health
    disabled_population_2021 = sum(disabled_population_2021, na.rm = TRUE),

    # Housing
    total_housing_units_2021 = sum(total_housing_units_2021, na.rm = TRUE),
    median_gross_rent_2021 = mean(median_gross_rent_2021, na.rm = TRUE),
    median_home_value_2021 = mean(median_home_value_2021, na.rm = TRUE),
    rent_burden_30plus_2021 = sum(rent_burden_30plus_2021, na.rm = TRUE),
    rent_burden_50plus_2021 = sum(rent_burden_50plus_2021, na.rm = TRUE),
    owner_occupied_units_2021 = sum(owner_occupied_units_2021, na.rm = TRUE),
    renter_occupied_units_2021 = sum(renter_occupied_units_2021, na.rm = TRUE),
    total_occupied_units_2021 = sum(total_occupied_units_2021, na.rm = TRUE),
    total_vacant_units_2021 = sum(total_vacant_units_2021, na.rm = TRUE),
    units_built_2020plus_2021 = sum(units_built_2020plus_2021, na.rm = TRUE),
units_built_2010_2019_2021 = sum(units_built_2010_2019_2021, na.rm = TRUE),
units_built_2000_2009_2021 = sum(units_built_2000_2009_2021, na.rm = TRUE),
overcrowded_owner_occupied_households_2021 = sum(overcrowded_owner_occupied_households_2021, na.rm = TRUE),
housing_before_1939_2021 = sum(housing_before_1939_2021, na.rm = TRUE),
households_receiving_assistance_2021 = sum(households_receiving_assistance_2021, na.rm = TRUE),
rent_100_below_2021 = sum(rent_100_below_2021, na.rm = TRUE),
rent_100_149_2021 = sum(rent_100_149_2021, na.rm = TRUE),
rent_150_199_2021 = sum(rent_150_199_2021, na.rm = TRUE),
rent_200_249_2021 = sum(rent_200_249_2021, na.rm = TRUE),
rent_250_299_2021 = sum(rent_250_299_2021, na.rm = TRUE),
rent_300_349_2021 = sum(rent_300_349_2021, na.rm = TRUE),
rent_350_399_2021 = sum(rent_350_399_2021, na.rm = TRUE),
rent_400_449_2021 = sum(rent_400_449_2021, na.rm = TRUE),
rent_450_499_2021 = sum(rent_450_499_2021, na.rm = TRUE),
rent_500_549_2021 = sum(rent_500_549_2021, na.rm = TRUE),
rent_550_599_2021 = sum(rent_550_599_2021, na.rm = TRUE),
rent_600_649_2021 = sum(rent_600_649_2021, na.rm = TRUE),
rent_650_699_2021 = sum(rent_650_699_2021, na.rm = TRUE),
rent_700_749_2021 = sum(rent_700_749_2021, na.rm = TRUE),
rent_750_799_2021 = sum(rent_750_799_2021, na.rm = TRUE),
rent_800_899_2021 = sum(rent_800_899_2021, na.rm = TRUE),
rent_900_999_2021 = sum(rent_900_999_2021, na.rm = TRUE),
rent_1000_1249_2021 = sum(rent_1000_1249_2021, na.rm = TRUE),
rent_1250_1499_2021 = sum(rent_1250_1499_2021, na.rm = TRUE),
rent_1500_1999_2021 = sum(rent_1500_1999_2021, na.rm = TRUE),
rent_2000_2499_2021 = sum(rent_2000_2499_2021, na.rm = TRUE),
rent_2500_2999_2021 = sum(rent_2500_2999_2021, na.rm = TRUE),
rent_3000_3499_2021 = sum(rent_3000_3499_2021, na.rm = TRUE),
rent_3500_plus_2021 = sum(rent_3500_plus_2021, na.rm = TRUE),
households_cash_rent_2021 = sum(households_cash_rent_2021, na.rm = TRUE),
households_no_cash_rent_2021 = sum(households_no_cash_rent_2021, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2021 = sum(white_NH_race_2021, na.rm = TRUE),
    black_NH_race_2021 = sum(black_NH_race_2021, na.rm = TRUE),
    asian_NH_race_2021 = sum(asian_NH_race_2021, na.rm = TRUE),
    hisp_race_2021 = sum(hisp_race_2021, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2021 = sum(public_transit_users_2021, na.rm = TRUE),
    mean_commute_time_2021 = mean(mean_commute_time_2021, na.rm = TRUE),
    no_vehicle_households_2021 = sum(no_vehicle_households_2021, na.rm = TRUE),
    commute_alone_2021 = sum(commute_alone_2021, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2021)


# Aggregate data by Neighborhood
newark_ward_wide_2020 <- newark_tract_wide_2020 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2020 = sum(total_population_2020, na.rm = TRUE),
    total_male_population_2020 = sum(total_male_population_2020, na.rm = TRUE),
    total_female_population_2020 = sum(total_female_population_2020, na.rm = TRUE),
    median_age_2020 = mean(median_age_2020, na.rm = TRUE),
    male_median_age_2020 = mean(male_median_age_2020, na.rm = TRUE),
    female_median_age_2020 = mean(female_median_age_2020, na.rm = TRUE),
    recent_movers_2020 = sum(recent_movers_2020, na.rm = TRUE),
    foreign_born_population_2020 = sum(foreign_born_population_2020, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2020 = sum(self_employed_incorporated_2020, na.rm = TRUE),
    self_employed_not_incorporated_2020 = sum(self_employed_not_incorporated_2020, na.rm = TRUE),
    employment_industry_2020 = sum(employment_industry_2020, na.rm = TRUE),
    worker_class_2020 = sum(worker_class_2020, na.rm = TRUE),
    median_hh_income_2020 = mean(median_hh_income_2020, na.rm = TRUE),
    per_capita_income_2020 = mean(per_capita_income_2020, na.rm = TRUE),
    gini_index_2020 = mean(gini_index_2020, na.rm = TRUE),
    poverty_level_2020 = sum(poverty_level_2020, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2020 = sum(bachelor_degree_or_higher_2020, na.rm = TRUE),
    bachelor_male_2020 = sum(bachelor_male_2020, na.rm = TRUE),
    masters_male_2020 = sum(masters_male_2020, na.rm = TRUE),
    doctorate_male_2020 = sum(doctorate_male_2020, na.rm = TRUE),
    bachelor_female_2020 = sum(bachelor_female_2020, na.rm = TRUE),
    masters_female_2020 = sum(masters_female_2020, na.rm = TRUE),
    doctorate_female_2020 = sum(doctorate_female_2020, na.rm = TRUE),
    professional_degree_male_2020 = sum(professional_degree_male_2020, na.rm = TRUE),
    professional_degree_female_2020 = sum(professional_degree_female_2020, na.rm = TRUE),
    educational_attainment_total_2020 = sum(educational_attainment_total_2020, na.rm = TRUE),
    highschool_dropout_2020 = sum(highschool_dropout_2020, na.rm = TRUE),

    # Employment
    total_labor_force_2020 = sum(total_labor_force_2020, na.rm = TRUE),
    total_employed_2020 = sum(total_employed_2020, na.rm = TRUE),
    total_unemployed_2020 = sum(total_unemployed_2020, na.rm = TRUE),
    remote_workers_2020 = sum(remote_workers_2020, na.rm = TRUE),
    service_industry_2020 = sum(service_industry_2020, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2020 = sum(mgmt_business_sc_arts_industry_2020, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2020 = sum(total_households_2020, na.rm = TRUE),
    family_households_2020 = sum(family_households_2020, na.rm = TRUE),
    nonfamily_households_2020 = sum(nonfamily_households_2020, na.rm = TRUE),
    households_with_children_2020 = sum(households_with_children_2020, na.rm = TRUE),

    # Health
    disabled_population_2020 = sum(disabled_population_2020, na.rm = TRUE),

    # Housing
    total_housing_units_2020 = sum(total_housing_units_2020, na.rm = TRUE),
    median_gross_rent_2020 = mean(median_gross_rent_2020, na.rm = TRUE),
    median_home_value_2020 = mean(median_home_value_2020, na.rm = TRUE),
    rent_burden_30plus_2020 = sum(rent_burden_30plus_2020, na.rm = TRUE),
    rent_burden_50plus_2020 = sum(rent_burden_50plus_2020, na.rm = TRUE),
    owner_occupied_units_2020 = sum(owner_occupied_units_2020, na.rm = TRUE),
    renter_occupied_units_2020 = sum(renter_occupied_units_2020, na.rm = TRUE),
    total_occupied_units_2020 = sum(total_occupied_units_2020, na.rm = TRUE),
    total_vacant_units_2020 = sum(total_vacant_units_2020, na.rm = TRUE),
    units_built_2020plus_2020 = sum(units_built_2020plus_2020, na.rm = TRUE),
units_built_2010_2019_2020 = sum(units_built_2010_2019_2020, na.rm = TRUE),
units_built_2000_2009_2020 = sum(units_built_2000_2009_2020, na.rm = TRUE),
overcrowded_owner_occupied_households_2020 = sum(overcrowded_owner_occupied_households_2020, na.rm = TRUE),
housing_before_1939_2020 = sum(housing_before_1939_2020, na.rm = TRUE),
households_receiving_assistance_2020 = sum(households_receiving_assistance_2020, na.rm = TRUE),
rent_100_below_2020 = sum(rent_100_below_2020, na.rm = TRUE),
rent_100_149_2020 = sum(rent_100_149_2020, na.rm = TRUE),
rent_150_199_2020 = sum(rent_150_199_2020, na.rm = TRUE),
rent_200_249_2020 = sum(rent_200_249_2020, na.rm = TRUE),
rent_250_299_2020 = sum(rent_250_299_2020, na.rm = TRUE),
rent_300_349_2020 = sum(rent_300_349_2020, na.rm = TRUE),
rent_350_399_2020 = sum(rent_350_399_2020, na.rm = TRUE),
rent_400_449_2020 = sum(rent_400_449_2020, na.rm = TRUE),
rent_450_499_2020 = sum(rent_450_499_2020, na.rm = TRUE),
rent_500_549_2020 = sum(rent_500_549_2020, na.rm = TRUE),
rent_550_599_2020 = sum(rent_550_599_2020, na.rm = TRUE),
rent_600_649_2020 = sum(rent_600_649_2020, na.rm = TRUE),
rent_650_699_2020 = sum(rent_650_699_2020, na.rm = TRUE),
rent_700_749_2020 = sum(rent_700_749_2020, na.rm = TRUE),
rent_750_799_2020 = sum(rent_750_799_2020, na.rm = TRUE),
rent_800_899_2020 = sum(rent_800_899_2020, na.rm = TRUE),
rent_900_999_2020 = sum(rent_900_999_2020, na.rm = TRUE),
rent_1000_1249_2020 = sum(rent_1000_1249_2020, na.rm = TRUE),
rent_1250_1499_2020 = sum(rent_1250_1499_2020, na.rm = TRUE),
rent_1500_1999_2020 = sum(rent_1500_1999_2020, na.rm = TRUE),
rent_2000_2499_2020 = sum(rent_2000_2499_2020, na.rm = TRUE),
rent_2500_2999_2020 = sum(rent_2500_2999_2020, na.rm = TRUE),
rent_3000_3499_2020 = sum(rent_3000_3499_2020, na.rm = TRUE),
rent_3500_plus_2020 = sum(rent_3500_plus_2020, na.rm = TRUE),
households_cash_rent_2020 = sum(households_cash_rent_2020, na.rm = TRUE),
households_no_cash_rent_2020 = sum(households_no_cash_rent_2020, na.rm = TRUE),

    # Race & Ethnicity
    white_NH_race_2020 = sum(white_NH_race_2020, na.rm = TRUE),
    black_NH_race_2020 = sum(black_NH_race_2020, na.rm = TRUE),
    asian_NH_race_2020 = sum(asian_NH_race_2020, na.rm = TRUE),
    hisp_race_2020 = sum(hisp_race_2020, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2020 = sum(public_transit_users_2020, na.rm = TRUE),
    mean_commute_time_2020 = mean(mean_commute_time_2020, na.rm = TRUE),
    no_vehicle_households_2020 = sum(no_vehicle_households_2020, na.rm = TRUE),
    commute_alone_2020 = sum(commute_alone_2020, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2020)


# Aggregate data by Neighborhood
newark_ward_wide_2019 <- newark_tract_wide_2019 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2019 = sum(total_population_2019, na.rm = TRUE),
    total_male_population_2019 = sum(total_male_population_2019, na.rm = TRUE),
    total_female_population_2019 = sum(total_female_population_2019, na.rm = TRUE),
    median_age_2019 = mean(median_age_2019, na.rm = TRUE),
    male_median_age_2019 = mean(male_median_age_2019, na.rm = TRUE),
    female_median_age_2019 = mean(female_median_age_2019, na.rm = TRUE),
    recent_movers_2019 = sum(recent_movers_2019, na.rm = TRUE),
    foreign_born_population_2019 = sum(foreign_born_population_2019, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2019 = sum(self_employed_incorporated_2019, na.rm = TRUE),
    self_employed_not_incorporated_2019 = sum(self_employed_not_incorporated_2019, na.rm = TRUE),
    employment_industry_2019 = sum(employment_industry_2019, na.rm = TRUE),
    worker_class_2019 = sum(worker_class_2019, na.rm = TRUE),
    median_hh_income_2019 = mean(median_hh_income_2019, na.rm = TRUE),
    per_capita_income_2019 = mean(per_capita_income_2019, na.rm = TRUE),
    gini_index_2019 = mean(gini_index_2019, na.rm = TRUE),
    poverty_level_2019 = sum(poverty_level_2019, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2019 = sum(bachelor_degree_or_higher_2019, na.rm = TRUE),
    bachelor_male_2019 = sum(bachelor_male_2019, na.rm = TRUE),
    masters_male_2019 = sum(masters_male_2019, na.rm = TRUE),
    doctorate_male_2019 = sum(doctorate_male_2019, na.rm = TRUE),
    bachelor_female_2019 = sum(bachelor_female_2019, na.rm = TRUE),
    masters_female_2019 = sum(masters_female_2019, na.rm = TRUE),
    doctorate_female_2019 = sum(doctorate_female_2019, na.rm = TRUE),
    professional_degree_male_2019 = sum(professional_degree_male_2019, na.rm = TRUE),
    professional_degree_female_2019 = sum(professional_degree_female_2019, na.rm = TRUE),
    educational_attainment_total_2019 = sum(educational_attainment_total_2019, na.rm = TRUE),
    highschool_dropout_2019 = sum(highschool_dropout_2019, na.rm = TRUE),

    # Employment
    total_labor_force_2019 = sum(total_labor_force_2019, na.rm = TRUE),
    total_employed_2019 = sum(total_employed_2019, na.rm = TRUE),
    total_unemployed_2019 = sum(total_unemployed_2019, na.rm = TRUE),
    remote_workers_2019 = sum(remote_workers_2019, na.rm = TRUE),
    service_industry_2019 = sum(service_industry_2019, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2019 = sum(mgmt_business_sc_arts_industry_2019, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2019 = sum(total_households_2019, na.rm = TRUE),
    family_households_2019 = sum(family_households_2019, na.rm = TRUE),
    nonfamily_households_2019 = sum(nonfamily_households_2019, na.rm = TRUE),
    households_with_children_2019 = sum(households_with_children_2019, na.rm = TRUE),

    # Health
    disabled_population_2019 = sum(disabled_population_2019, na.rm = TRUE),

    # Housing
    total_housing_units_2019 = sum(total_housing_units_2019, na.rm = TRUE),
    median_gross_rent_2019 = mean(median_gross_rent_2019, na.rm = TRUE),
    median_home_value_2019 = mean(median_home_value_2019, na.rm = TRUE),
    rent_burden_30plus_2019 = sum(rent_burden_30plus_2019, na.rm = TRUE),
    rent_burden_50plus_2019 = sum(rent_burden_50plus_2019, na.rm = TRUE),
    owner_occupied_units_2019 = sum(owner_occupied_units_2019, na.rm = TRUE),
    renter_occupied_units_2019 = sum(renter_occupied_units_2019, na.rm = TRUE),
    total_occupied_units_2019 = sum(total_occupied_units_2019, na.rm = TRUE),
    total_vacant_units_2019 = sum(total_vacant_units_2019, na.rm = TRUE),
    units_built_2020plus_2019 = sum(units_built_2020plus_2019, na.rm = TRUE),
units_built_2010_2019_2019 = sum(units_built_2010_2019_2019, na.rm = TRUE),
units_built_2000_2009_2019 = sum(units_built_2000_2009_2019, na.rm = TRUE),
overcrowded_owner_occupied_households_2019 = sum(overcrowded_owner_occupied_households_2019, na.rm = TRUE),
housing_before_1939_2019 = sum(housing_before_1939_2019, na.rm = TRUE),
households_receiving_assistance_2019 = sum(households_receiving_assistance_2019, na.rm = TRUE),
rent_100_below_2019 = sum(rent_100_below_2019, na.rm = TRUE),
rent_100_149_2019 = sum(rent_100_149_2019, na.rm = TRUE),
rent_150_199_2019 = sum(rent_150_199_2019, na.rm = TRUE),
rent_200_249_2019 = sum(rent_200_249_2019, na.rm = TRUE),
rent_250_299_2019 = sum(rent_250_299_2019, na.rm = TRUE),
rent_300_349_2019 = sum(rent_300_349_2019, na.rm = TRUE),
rent_350_399_2019 = sum(rent_350_399_2019, na.rm = TRUE),
rent_400_449_2019 = sum(rent_400_449_2019, na.rm = TRUE),
rent_450_499_2019 = sum(rent_450_499_2019, na.rm = TRUE),
rent_500_549_2019 = sum(rent_500_549_2019, na.rm = TRUE),
rent_550_599_2019 = sum(rent_550_599_2019, na.rm = TRUE),
rent_600_649_2019 = sum(rent_600_649_2019, na.rm = TRUE),
rent_650_699_2019 = sum(rent_650_699_2019, na.rm = TRUE),
rent_700_749_2019 = sum(rent_700_749_2019, na.rm = TRUE),
rent_750_799_2019 = sum(rent_750_799_2019, na.rm = TRUE),
rent_800_899_2019 = sum(rent_800_899_2019, na.rm = TRUE),
rent_900_999_2019 = sum(rent_900_999_2019, na.rm = TRUE),
rent_1000_1249_2019 = sum(rent_1000_1249_2019, na.rm = TRUE),
rent_1250_1499_2019 = sum(rent_1250_1499_2019, na.rm = TRUE),
rent_1500_1999_2019 = sum(rent_1500_1999_2019, na.rm = TRUE),
rent_2000_2499_2019 = sum(rent_2000_2499_2019, na.rm = TRUE),
rent_2500_2999_2019 = sum(rent_2500_2999_2019, na.rm = TRUE),
rent_3000_3499_2019 = sum(rent_3000_3499_2019, na.rm = TRUE),
rent_3500_plus_2019 = sum(rent_3500_plus_2019, na.rm = TRUE),
households_cash_rent_2019 = sum(households_cash_rent_2019, na.rm = TRUE),
households_no_cash_rent_2019 = sum(households_no_cash_rent_2019, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2019 = sum(white_NH_race_2019, na.rm = TRUE),
    black_NH_race_2019 = sum(black_NH_race_2019, na.rm = TRUE),
    asian_NH_race_2019 = sum(asian_NH_race_2019, na.rm = TRUE),
    hisp_race_2019 = sum(hisp_race_2019, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2019 = sum(public_transit_users_2019, na.rm = TRUE),
    mean_commute_time_2019 = mean(mean_commute_time_2019, na.rm = TRUE),
    no_vehicle_households_2019 = sum(no_vehicle_households_2019, na.rm = TRUE),
    commute_alone_2019 = sum(commute_alone_2019, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2019)


# Aggregate data by Neighborhood
newark_ward_wide_2018 <- newark_tract_wide_2018 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2018 = sum(total_population_2018, na.rm = TRUE),
    total_male_population_2018 = sum(total_male_population_2018, na.rm = TRUE),
    total_female_population_2018 = sum(total_female_population_2018, na.rm = TRUE),
    median_age_2018 = mean(median_age_2018, na.rm = TRUE),
    male_median_age_2018 = mean(male_median_age_2018, na.rm = TRUE),
    female_median_age_2018 = mean(female_median_age_2018, na.rm = TRUE),
    recent_movers_2018 = sum(recent_movers_2018, na.rm = TRUE),
    foreign_born_population_2018 = sum(foreign_born_population_2018, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2018 = sum(self_employed_incorporated_2018, na.rm = TRUE),
    self_employed_not_incorporated_2018 = sum(self_employed_not_incorporated_2018, na.rm = TRUE),
    employment_industry_2018 = sum(employment_industry_2018, na.rm = TRUE),
    worker_class_2018 = sum(worker_class_2018, na.rm = TRUE),
    median_hh_income_2018 = mean(median_hh_income_2018, na.rm = TRUE),
    per_capita_income_2018 = mean(per_capita_income_2018, na.rm = TRUE),
    gini_index_2018 = mean(gini_index_2018, na.rm = TRUE),
    poverty_level_2018 = sum(poverty_level_2018, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2018 = sum(bachelor_degree_or_higher_2018, na.rm = TRUE),
    bachelor_male_2018 = sum(bachelor_male_2018, na.rm = TRUE),
    masters_male_2018 = sum(masters_male_2018, na.rm = TRUE),
    doctorate_male_2018 = sum(doctorate_male_2018, na.rm = TRUE),
    bachelor_female_2018 = sum(bachelor_female_2018, na.rm = TRUE),
    masters_female_2018 = sum(masters_female_2018, na.rm = TRUE),
    doctorate_female_2018 = sum(doctorate_female_2018, na.rm = TRUE),
    professional_degree_male_2018 = sum(professional_degree_male_2018, na.rm = TRUE),
    professional_degree_female_2018 = sum(professional_degree_female_2018, na.rm = TRUE),
    educational_attainment_total_2018 = sum(educational_attainment_total_2018, na.rm = TRUE),
    highschool_dropout_2018 = sum(highschool_dropout_2018, na.rm = TRUE),

    # Employment
    total_labor_force_2018 = sum(total_labor_force_2018, na.rm = TRUE),
    total_employed_2018 = sum(total_employed_2018, na.rm = TRUE),
    total_unemployed_2018 = sum(total_unemployed_2018, na.rm = TRUE),
    remote_workers_2018 = sum(remote_workers_2018, na.rm = TRUE),
    service_industry_2018 = sum(service_industry_2018, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2018 = sum(mgmt_business_sc_arts_industry_2018, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2018 = sum(total_households_2018, na.rm = TRUE),
    family_households_2018 = sum(family_households_2018, na.rm = TRUE),
    nonfamily_households_2018 = sum(nonfamily_households_2018, na.rm = TRUE),
    households_with_children_2018 = sum(households_with_children_2018, na.rm = TRUE),

    # Health
    disabled_population_2018 = sum(disabled_population_2018, na.rm = TRUE),

    # Housing
    total_housing_units_2018 = sum(total_housing_units_2018, na.rm = TRUE),
    median_gross_rent_2018 = mean(median_gross_rent_2018, na.rm = TRUE),
    median_home_value_2018 = mean(median_home_value_2018, na.rm = TRUE),
    rent_burden_30plus_2018 = sum(rent_burden_30plus_2018, na.rm = TRUE),
    rent_burden_50plus_2018 = sum(rent_burden_50plus_2018, na.rm = TRUE),
    owner_occupied_units_2018 = sum(owner_occupied_units_2018, na.rm = TRUE),
    renter_occupied_units_2018 = sum(renter_occupied_units_2018, na.rm = TRUE),
    total_occupied_units_2018 = sum(total_occupied_units_2018, na.rm = TRUE),
    total_vacant_units_2018 = sum(total_vacant_units_2018, na.rm = TRUE),
    units_built_2020plus_2018 = sum(units_built_2020plus_2018, na.rm = TRUE),
overcrowded_owner_occupied_households_2018 = sum(overcrowded_owner_occupied_households_2018, na.rm = TRUE),
housing_before_1939_2018 = sum(housing_before_1939_2018, na.rm = TRUE),
households_receiving_assistance_2018 = sum(households_receiving_assistance_2018, na.rm = TRUE),
rent_100_below_2018 = sum(rent_100_below_2018, na.rm = TRUE),
rent_100_149_2018 = sum(rent_100_149_2018, na.rm = TRUE),
rent_150_199_2018 = sum(rent_150_199_2018, na.rm = TRUE),
rent_200_249_2018 = sum(rent_200_249_2018, na.rm = TRUE),
rent_250_299_2018 = sum(rent_250_299_2018, na.rm = TRUE),
rent_300_349_2018 = sum(rent_300_349_2018, na.rm = TRUE),
rent_350_399_2018 = sum(rent_350_399_2018, na.rm = TRUE),
rent_400_449_2018 = sum(rent_400_449_2018, na.rm = TRUE),
rent_450_499_2018 = sum(rent_450_499_2018, na.rm = TRUE),
rent_500_549_2018 = sum(rent_500_549_2018, na.rm = TRUE),
rent_550_599_2018 = sum(rent_550_599_2018, na.rm = TRUE),
rent_600_649_2018 = sum(rent_600_649_2018, na.rm = TRUE),
rent_650_699_2018 = sum(rent_650_699_2018, na.rm = TRUE),
rent_700_749_2018 = sum(rent_700_749_2018, na.rm = TRUE),
rent_750_799_2018 = sum(rent_750_799_2018, na.rm = TRUE),
rent_800_899_2018 = sum(rent_800_899_2018, na.rm = TRUE),
rent_900_999_2018 = sum(rent_900_999_2018, na.rm = TRUE),
rent_1000_1249_2018 = sum(rent_1000_1249_2018, na.rm = TRUE),
rent_1250_1499_2018 = sum(rent_1250_1499_2018, na.rm = TRUE),
rent_1500_1999_2018 = sum(rent_1500_1999_2018, na.rm = TRUE),
rent_2000_2499_2018 = sum(rent_2000_2499_2018, na.rm = TRUE),
rent_2500_2999_2018 = sum(rent_2500_2999_2018, na.rm = TRUE),
rent_3000_3499_2018 = sum(rent_3000_3499_2018, na.rm = TRUE),
rent_3500_plus_2018 = sum(rent_3500_plus_2018, na.rm = TRUE),
households_cash_rent_2018 = sum(households_cash_rent_2018, na.rm = TRUE),
households_no_cash_rent_2018 = sum(households_no_cash_rent_2018, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2018 = sum(white_NH_race_2018, na.rm = TRUE),
    black_NH_race_2018 = sum(black_NH_race_2018, na.rm = TRUE),
    asian_NH_race_2018 = sum(asian_NH_race_2018, na.rm = TRUE),
    hisp_race_2018 = sum(hisp_race_2018, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2018 = sum(public_transit_users_2018, na.rm = TRUE),
    mean_commute_time_2018 = mean(mean_commute_time_2018, na.rm = TRUE),
    no_vehicle_households_2018 = sum(no_vehicle_households_2018, na.rm = TRUE),
    commute_alone_2018 = sum(commute_alone_2018, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2018)



# Aggregate data by Neighborhood
newark_ward_wide_2017 <- newark_tract_wide_2017 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2017 = sum(total_population_2017, na.rm = TRUE),
    total_male_population_2017 = sum(total_male_population_2017, na.rm = TRUE),
    total_female_population_2017 = sum(total_female_population_2017, na.rm = TRUE),
    median_age_2017 = mean(median_age_2017, na.rm = TRUE),
    male_median_age_2017 = mean(male_median_age_2017, na.rm = TRUE),
    female_median_age_2017 = mean(female_median_age_2017, na.rm = TRUE),
    recent_movers_2017 = sum(recent_movers_2017, na.rm = TRUE),
    foreign_born_population_2017 = sum(foreign_born_population_2017, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2017 = sum(self_employed_incorporated_2017, na.rm = TRUE),
    self_employed_not_incorporated_2017 = sum(self_employed_not_incorporated_2017, na.rm = TRUE),
    employment_industry_2017 = sum(employment_industry_2017, na.rm = TRUE),
    worker_class_2017 = sum(worker_class_2017, na.rm = TRUE),
    median_hh_income_2017 = mean(median_hh_income_2017, na.rm = TRUE),
    per_capita_income_2017 = mean(per_capita_income_2017, na.rm = TRUE),
    gini_index_2017 = mean(gini_index_2017, na.rm = TRUE),
    poverty_level_2017 = sum(poverty_level_2017, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2017 = sum(bachelor_degree_or_higher_2017, na.rm = TRUE),
    bachelor_male_2017 = sum(bachelor_male_2017, na.rm = TRUE),
    masters_male_2017 = sum(masters_male_2017, na.rm = TRUE),
    doctorate_male_2017 = sum(doctorate_male_2017, na.rm = TRUE),
    bachelor_female_2017 = sum(bachelor_female_2017, na.rm = TRUE),
    masters_female_2017 = sum(masters_female_2017, na.rm = TRUE),
    doctorate_female_2017 = sum(doctorate_female_2017, na.rm = TRUE),
    professional_degree_male_2017 = sum(professional_degree_male_2017, na.rm = TRUE),
    professional_degree_female_2017 = sum(professional_degree_female_2017, na.rm = TRUE),
    educational_attainment_total_2017 = sum(educational_attainment_total_2017, na.rm = TRUE),
    highschool_dropout_2017 = sum(highschool_dropout_2017, na.rm = TRUE),

    # Employment
    total_labor_force_2017 = sum(total_labor_force_2017, na.rm = TRUE),
    total_employed_2017 = sum(total_employed_2017, na.rm = TRUE),
    total_unemployed_2017 = sum(total_unemployed_2017, na.rm = TRUE),
    remote_workers_2017 = sum(remote_workers_2017, na.rm = TRUE),
    service_industry_2017 = sum(service_industry_2017, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2017 = sum(mgmt_business_sc_arts_industry_2017, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2017 = sum(total_households_2017, na.rm = TRUE),
    family_households_2017 = sum(family_households_2017, na.rm = TRUE),
    nonfamily_households_2017 = sum(nonfamily_households_2017, na.rm = TRUE),
    households_with_children_2017 = sum(households_with_children_2017, na.rm = TRUE),

    # Health
    disabled_population_2017 = sum(disabled_population_2017, na.rm = TRUE),

    # Housing
    total_housing_units_2017 = sum(total_housing_units_2017, na.rm = TRUE),
    median_gross_rent_2017 = mean(median_gross_rent_2017, na.rm = TRUE),
    median_home_value_2017 = mean(median_home_value_2017, na.rm = TRUE),
    rent_burden_30plus_2017 = sum(rent_burden_30plus_2017, na.rm = TRUE),
    rent_burden_50plus_2017 = sum(rent_burden_50plus_2017, na.rm = TRUE),
    owner_occupied_units_2017 = sum(owner_occupied_units_2017, na.rm = TRUE),
    renter_occupied_units_2017 = sum(renter_occupied_units_2017, na.rm = TRUE),
    total_occupied_units_2017 = sum(total_occupied_units_2017, na.rm = TRUE),
    total_vacant_units_2017 = sum(total_vacant_units_2017, na.rm = TRUE),
    units_built_2020plus_2017 = sum(units_built_2020plus_2017, na.rm = TRUE),
overcrowded_owner_occupied_households_2017 = sum(overcrowded_owner_occupied_households_2017, na.rm = TRUE),
housing_before_1939_2017 = sum(housing_before_1939_2017, na.rm = TRUE),
households_receiving_assistance_2017 = sum(households_receiving_assistance_2017, na.rm = TRUE),
rent_100_below_2017 = sum(rent_100_below_2017, na.rm = TRUE),
rent_100_149_2017 = sum(rent_100_149_2017, na.rm = TRUE),
rent_150_199_2017 = sum(rent_150_199_2017, na.rm = TRUE),
rent_200_249_2017 = sum(rent_200_249_2017, na.rm = TRUE),
rent_250_299_2017 = sum(rent_250_299_2017, na.rm = TRUE),
rent_300_349_2017 = sum(rent_300_349_2017, na.rm = TRUE),
rent_350_399_2017 = sum(rent_350_399_2017, na.rm = TRUE),
rent_400_449_2017 = sum(rent_400_449_2017, na.rm = TRUE),
rent_450_499_2017 = sum(rent_450_499_2017, na.rm = TRUE),
rent_500_549_2017 = sum(rent_500_549_2017, na.rm = TRUE),
rent_550_599_2017 = sum(rent_550_599_2017, na.rm = TRUE),
rent_600_649_2017 = sum(rent_600_649_2017, na.rm = TRUE),
rent_650_699_2017 = sum(rent_650_699_2017, na.rm = TRUE),
rent_700_749_2017 = sum(rent_700_749_2017, na.rm = TRUE),
rent_750_799_2017 = sum(rent_750_799_2017, na.rm = TRUE),
rent_800_899_2017 = sum(rent_800_899_2017, na.rm = TRUE),
rent_900_999_2017 = sum(rent_900_999_2017, na.rm = TRUE),
rent_1000_1249_2017 = sum(rent_1000_1249_2017, na.rm = TRUE),
rent_1250_1499_2017 = sum(rent_1250_1499_2017, na.rm = TRUE),
rent_1500_1999_2017 = sum(rent_1500_1999_2017, na.rm = TRUE),
rent_2000_2499_2017 = sum(rent_2000_2499_2017, na.rm = TRUE),
rent_2500_2999_2017 = sum(rent_2500_2999_2017, na.rm = TRUE),
rent_3000_3499_2017 = sum(rent_3000_3499_2017, na.rm = TRUE),
rent_3500_plus_2017 = sum(rent_3500_plus_2017, na.rm = TRUE),
households_cash_rent_2017 = sum(households_cash_rent_2017, na.rm = TRUE),
households_no_cash_rent_2017 = sum(households_no_cash_rent_2017, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2017 = sum(white_NH_race_2017, na.rm = TRUE),
    black_NH_race_2017 = sum(black_NH_race_2017, na.rm = TRUE),
    asian_NH_race_2017 = sum(asian_NH_race_2017, na.rm = TRUE),
    hisp_race_2017 = sum(hisp_race_2017, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2017 = sum(public_transit_users_2017, na.rm = TRUE),
    mean_commute_time_2017 = mean(mean_commute_time_2017, na.rm = TRUE),
    no_vehicle_households_2017 = sum(no_vehicle_households_2017, na.rm = TRUE),
    commute_alone_2017 = sum(commute_alone_2017, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2017)



# Aggregate data by Neighborhood
newark_ward_wide_2016 <- newark_tract_wide_2016 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2016 = sum(total_population_2016, na.rm = TRUE),
    total_male_population_2016 = sum(total_male_population_2016, na.rm = TRUE),
    total_female_population_2016 = sum(total_female_population_2016, na.rm = TRUE),
    median_age_2016 = mean(median_age_2016, na.rm = TRUE),
    male_median_age_2016 = mean(male_median_age_2016, na.rm = TRUE),
    female_median_age_2016 = mean(female_median_age_2016, na.rm = TRUE),
    recent_movers_2016 = sum(recent_movers_2016, na.rm = TRUE),
    foreign_born_population_2016 = sum(foreign_born_population_2016, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2016 = sum(self_employed_incorporated_2016, na.rm = TRUE),
    self_employed_not_incorporated_2016 = sum(self_employed_not_incorporated_2016, na.rm = TRUE),
    employment_industry_2016 = sum(employment_industry_2016, na.rm = TRUE),
    worker_class_2016 = sum(worker_class_2016, na.rm = TRUE),
    median_hh_income_2016 = mean(median_hh_income_2016, na.rm = TRUE),
    per_capita_income_2016 = mean(per_capita_income_2016, na.rm = TRUE),
    gini_index_2016 = mean(gini_index_2016, na.rm = TRUE),
    poverty_level_2016 = sum(poverty_level_2016, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2016 = sum(bachelor_degree_or_higher_2016, na.rm = TRUE),
    bachelor_male_2016 = sum(bachelor_male_2016, na.rm = TRUE),
    masters_male_2016 = sum(masters_male_2016, na.rm = TRUE),
    doctorate_male_2016 = sum(doctorate_male_2016, na.rm = TRUE),
    bachelor_female_2016 = sum(bachelor_female_2016, na.rm = TRUE),
    masters_female_2016 = sum(masters_female_2016, na.rm = TRUE),
    doctorate_female_2016 = sum(doctorate_female_2016, na.rm = TRUE),
    professional_degree_male_2016 = sum(professional_degree_male_2016, na.rm = TRUE),
    professional_degree_female_2016 = sum(professional_degree_female_2016, na.rm = TRUE),
    educational_attainment_total_2016 = sum(educational_attainment_total_2016, na.rm = TRUE),
    highschool_dropout_2016 = sum(highschool_dropout_2016, na.rm = TRUE),

    # Employment
    total_labor_force_2016 = sum(total_labor_force_2016, na.rm = TRUE),
    total_employed_2016 = sum(total_employed_2016, na.rm = TRUE),
    total_unemployed_2016 = sum(total_unemployed_2016, na.rm = TRUE),
    remote_workers_2016 = sum(remote_workers_2016, na.rm = TRUE),
    service_industry_2016 = sum(service_industry_2016, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2016 = sum(mgmt_business_sc_arts_industry_2016, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2016 = sum(total_households_2016, na.rm = TRUE),
    family_households_2016 = sum(family_households_2016, na.rm = TRUE),
    nonfamily_households_2016 = sum(nonfamily_households_2016, na.rm = TRUE),
    households_with_children_2016 = sum(households_with_children_2016, na.rm = TRUE),

    # Health
    disabled_population_2016 = sum(disabled_population_2016, na.rm = TRUE),

    # Housing
    total_housing_units_2016 = sum(total_housing_units_2016, na.rm = TRUE),
    median_gross_rent_2016 = mean(median_gross_rent_2016, na.rm = TRUE),
    median_home_value_2016 = mean(median_home_value_2016, na.rm = TRUE),
    rent_burden_30plus_2016 = sum(rent_burden_30plus_2016, na.rm = TRUE),
    rent_burden_50plus_2016 = sum(rent_burden_50plus_2016, na.rm = TRUE),
    owner_occupied_units_2016 = sum(owner_occupied_units_2016, na.rm = TRUE),
    renter_occupied_units_2016 = sum(renter_occupied_units_2016, na.rm = TRUE),
    total_occupied_units_2016 = sum(total_occupied_units_2016, na.rm = TRUE),
    total_vacant_units_2016 = sum(total_vacant_units_2016, na.rm = TRUE),
    units_built_2020plus_2016 = sum(units_built_2020plus_2016, na.rm = TRUE),
overcrowded_owner_occupied_households_2016 = sum(overcrowded_owner_occupied_households_2016, na.rm = TRUE),
housing_before_1939_2016 = sum(housing_before_1939_2016, na.rm = TRUE),
households_receiving_assistance_2016 = sum(households_receiving_assistance_2016, na.rm = TRUE),
rent_100_below_2016 = sum(rent_100_below_2016, na.rm = TRUE),
rent_100_149_2016 = sum(rent_100_149_2016, na.rm = TRUE),
rent_150_199_2016 = sum(rent_150_199_2016, na.rm = TRUE),
rent_200_249_2016 = sum(rent_200_249_2016, na.rm = TRUE),
rent_250_299_2016 = sum(rent_250_299_2016, na.rm = TRUE),
rent_300_349_2016 = sum(rent_300_349_2016, na.rm = TRUE),
rent_350_399_2016 = sum(rent_350_399_2016, na.rm = TRUE),
rent_400_449_2016 = sum(rent_400_449_2016, na.rm = TRUE),
rent_450_499_2016 = sum(rent_450_499_2016, na.rm = TRUE),
rent_500_549_2016 = sum(rent_500_549_2016, na.rm = TRUE),
rent_550_599_2016 = sum(rent_550_599_2016, na.rm = TRUE),
rent_600_649_2016 = sum(rent_600_649_2016, na.rm = TRUE),
rent_650_699_2016 = sum(rent_650_699_2016, na.rm = TRUE),
rent_700_749_2016 = sum(rent_700_749_2016, na.rm = TRUE),
rent_750_799_2016 = sum(rent_750_799_2016, na.rm = TRUE),
rent_800_899_2016 = sum(rent_800_899_2016, na.rm = TRUE),
rent_900_999_2016 = sum(rent_900_999_2016, na.rm = TRUE),
rent_1000_1249_2016 = sum(rent_1000_1249_2016, na.rm = TRUE),
rent_1250_1499_2016 = sum(rent_1250_1499_2016, na.rm = TRUE),
rent_1500_1999_2016 = sum(rent_1500_1999_2016, na.rm = TRUE),
rent_2000_2499_2016 = sum(rent_2000_2499_2016, na.rm = TRUE),
rent_2500_2999_2016 = sum(rent_2500_2999_2016, na.rm = TRUE),
rent_3000_3499_2016 = sum(rent_3000_3499_2016, na.rm = TRUE),
rent_3500_plus_2016 = sum(rent_3500_plus_2016, na.rm = TRUE),
households_cash_rent_2016 = sum(households_cash_rent_2016, na.rm = TRUE),
households_no_cash_rent_2016 = sum(households_no_cash_rent_2016, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2016 = sum(white_NH_race_2016, na.rm = TRUE),
    black_NH_race_2016 = sum(black_NH_race_2016, na.rm = TRUE),
    asian_NH_race_2016 = sum(asian_NH_race_2016, na.rm = TRUE),
    hisp_race_2016 = sum(hisp_race_2016, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2016 = sum(public_transit_users_2016, na.rm = TRUE),
    mean_commute_time_2016 = mean(mean_commute_time_2016, na.rm = TRUE),
    no_vehicle_households_2016 = sum(no_vehicle_households_2016, na.rm = TRUE),
    commute_alone_2016 = sum(commute_alone_2016, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2016)



# Aggregate data by Neighborhood
newark_ward_wide_2015 <- newark_tract_wide_2015 %>%
  group_by(Ward) %>%
  summarize(
    # Population and Demographics
    total_population_2015 = sum(total_population_2015, na.rm = TRUE),
    total_male_population_2015 = sum(total_male_population_2015, na.rm = TRUE),
    total_female_population_2015 = sum(total_female_population_2015, na.rm = TRUE),
    median_age_2015 = mean(median_age_2015, na.rm = TRUE),
    male_median_age_2015 = mean(male_median_age_2015, na.rm = TRUE),
    female_median_age_2015 = mean(female_median_age_2015, na.rm = TRUE),
    recent_movers_2015 = sum(recent_movers_2015, na.rm = TRUE),
    foreign_born_population_2015 = sum(foreign_born_population_2015, na.rm = TRUE),

    # Business and Economy
    self_employed_incorporated_2015 = sum(self_employed_incorporated_2015, na.rm = TRUE),
    self_employed_not_incorporated_2015 = sum(self_employed_not_incorporated_2015, na.rm = TRUE),
    employment_industry_2015 = sum(employment_industry_2015, na.rm = TRUE),
    worker_class_2015 = sum(worker_class_2015, na.rm = TRUE),
    median_hh_income_2015 = mean(median_hh_income_2015, na.rm = TRUE),
    per_capita_income_2015 = mean(per_capita_income_2015, na.rm = TRUE),
    gini_index_2015 = mean(gini_index_2015, na.rm = TRUE),
    poverty_level_2015 = sum(poverty_level_2015, na.rm = TRUE),

    # Education
    bachelor_degree_or_higher_2015 = sum(bachelor_degree_or_higher_2015, na.rm = TRUE),
    bachelor_male_2015 = sum(bachelor_male_2015, na.rm = TRUE),
    masters_male_2015 = sum(masters_male_2015, na.rm = TRUE),
    doctorate_male_2015 = sum(doctorate_male_2015, na.rm = TRUE),
    bachelor_female_2015 = sum(bachelor_female_2015, na.rm = TRUE),
    masters_female_2015 = sum(masters_female_2015, na.rm = TRUE),
    doctorate_female_2015 = sum(doctorate_female_2015, na.rm = TRUE),
    professional_degree_male_2015 = sum(professional_degree_male_2015, na.rm = TRUE),
    professional_degree_female_2015 = sum(professional_degree_female_2015, na.rm = TRUE),
    educational_attainment_total_2015 = sum(educational_attainment_total_2015, na.rm = TRUE),
    highschool_dropout_2015 = sum(highschool_dropout_2015, na.rm = TRUE),

    # Employment
    total_labor_force_2015 = sum(total_labor_force_2015, na.rm = TRUE),
    total_employed_2015 = sum(total_employed_2015, na.rm = TRUE),
    total_unemployed_2015 = sum(total_unemployed_2015, na.rm = TRUE),
    remote_workers_2015 = sum(remote_workers_2015, na.rm = TRUE),
    service_industry_2015 = sum(service_industry_2015, na.rm = TRUE),
    mgmt_business_sc_arts_industry_2015 = sum(mgmt_business_sc_arts_industry_2015, na.rm = TRUE),

    # Families and Living Arrangements
    total_households_2015 = sum(total_households_2015, na.rm = TRUE),
    family_households_2015 = sum(family_households_2015, na.rm = TRUE),
    nonfamily_households_2015 = sum(nonfamily_households_2015, na.rm = TRUE),
    households_with_children_2015 = sum(households_with_children_2015, na.rm = TRUE),

    # Health
    disabled_population_2015 = sum(disabled_population_2015, na.rm = TRUE),

    # Housing
    total_housing_units_2015 = sum(total_housing_units_2015, na.rm = TRUE),
    median_gross_rent_2015 = mean(median_gross_rent_2015, na.rm = TRUE),
    median_home_value_2015 = mean(median_home_value_2015, na.rm = TRUE),
    rent_burden_30plus_2015 = sum(rent_burden_30plus_2015, na.rm = TRUE),
    rent_burden_50plus_2015 = sum(rent_burden_50plus_2015, na.rm = TRUE),
    owner_occupied_units_2015 = sum(owner_occupied_units_2015, na.rm = TRUE),
    renter_occupied_units_2015 = sum(renter_occupied_units_2015, na.rm = TRUE),
    total_occupied_units_2015 = sum(total_occupied_units_2015, na.rm = TRUE),
    total_vacant_units_2015 = sum(total_vacant_units_2015, na.rm = TRUE),
    units_built_2020plus_2015 = sum(units_built_2020plus_2015, na.rm = TRUE),
overcrowded_owner_occupied_households_2015 = sum(overcrowded_owner_occupied_households_2015, na.rm = TRUE),
housing_before_1939_2015 = sum(housing_before_1939_2015, na.rm = TRUE),
households_receiving_assistance_2015 = sum(households_receiving_assistance_2015, na.rm = TRUE),
rent_100_below_2015 = sum(rent_100_below_2015, na.rm = TRUE),
rent_100_149_2015 = sum(rent_100_149_2015, na.rm = TRUE),
rent_150_199_2015 = sum(rent_150_199_2015, na.rm = TRUE),
rent_200_249_2015 = sum(rent_200_249_2015, na.rm = TRUE),
rent_250_299_2015 = sum(rent_250_299_2015, na.rm = TRUE),
rent_300_349_2015 = sum(rent_300_349_2015, na.rm = TRUE),
rent_350_399_2015 = sum(rent_350_399_2015, na.rm = TRUE),
rent_400_449_2015 = sum(rent_400_449_2015, na.rm = TRUE),
rent_450_499_2015 = sum(rent_450_499_2015, na.rm = TRUE),
rent_500_549_2015 = sum(rent_500_549_2015, na.rm = TRUE),
rent_550_599_2015 = sum(rent_550_599_2015, na.rm = TRUE),
rent_600_649_2015 = sum(rent_600_649_2015, na.rm = TRUE),
rent_650_699_2015 = sum(rent_650_699_2015, na.rm = TRUE),
rent_700_749_2015 = sum(rent_700_749_2015, na.rm = TRUE),
rent_750_799_2015 = sum(rent_750_799_2015, na.rm = TRUE),
rent_800_899_2015 = sum(rent_800_899_2015, na.rm = TRUE),
rent_900_999_2015 = sum(rent_900_999_2015, na.rm = TRUE),
rent_1000_1249_2015 = sum(rent_1000_1249_2015, na.rm = TRUE),
rent_1250_1499_2015 = sum(rent_1250_1499_2015, na.rm = TRUE),
rent_1500_1999_2015 = sum(rent_1500_1999_2015, na.rm = TRUE),
rent_2000_2499_2015 = sum(rent_2000_2499_2015, na.rm = TRUE),
rent_2500_2999_2015 = sum(rent_2500_2999_2015, na.rm = TRUE),
rent_3000_3499_2015 = sum(rent_3000_3499_2015, na.rm = TRUE),
rent_3500_plus_2015 = sum(rent_3500_plus_2015, na.rm = TRUE),
households_cash_rent_2015 = sum(households_cash_rent_2015, na.rm = TRUE),
households_no_cash_rent_2015 = sum(households_no_cash_rent_2015, na.rm = TRUE),


    # Race & Ethnicity
    white_NH_race_2015 = sum(white_NH_race_2015, na.rm = TRUE),
    black_NH_race_2015 = sum(black_NH_race_2015, na.rm = TRUE),
    asian_NH_race_2015 = sum(asian_NH_race_2015, na.rm = TRUE),
    hisp_race_2015 = sum(hisp_race_2015, na.rm = TRUE),

    # Transportation & Mobility
    public_transit_users_2015 = sum(public_transit_users_2015, na.rm = TRUE),
    mean_commute_time_2015 = mean(mean_commute_time_2015, na.rm = TRUE),
    no_vehicle_households_2015 = sum(no_vehicle_households_2015, na.rm = TRUE),
    commute_alone_2015 = sum(commute_alone_2015, na.rm = TRUE)
  ) %>%
  ungroup()  # Always ungroup after summarizing

# View the final dataset
print(newark_ward_wide_2015)

```
```{r ward selected variables, warning=FALSE, message=FALSE, results='hide'}

# List of selected variables with 2023 data
selected_variables_2023 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2023", "median_gross_rent_2023", "median_hh_income_2023", 
  "poverty_level_2023", "gini_index_2023", "highschool_dropout_2023", 
  "foreign_born_population_2023", "hisp_race_2023", "self_employed_not_incorporated_2023",
  "total_population_2023", "median_age_2023", "households_receiving_assistance_2023",
  "nonfamily_households_2023", "family_households_2023",
  
  # Market Dynamics
  "affordable_rents_2023", "high_rents_2023", "occupancy_permits_2023",
  "total_housing_units_2023", "total_occupied_units_2023", "units_built_2000_2009_2023",
  "public_transit_users_2023", "no_vehicle_households_2023", "median_home_value_2023",
  
  # "Gentrifier" Population
  "owner_occupied_units_2023", "renter_occupied_units_2023","owner_occupied_pct_2023", "non_hispanic_white_2023", 
  "bachelor_degree_or_higher_2023", "employment_industry_2023", 
  "female_median_age_2023", "male_median_age_2023", "remote_workers_2023",
  "service_industry_2023", "mgmt_business_sc_arts_industry_2023",
  
  # Race & Ethnicity
  "white_NH_race_2023", "black_NH_race_2023", "asian_NH_race_2023", "hisp_race_2023"
)

# Create new data frame with only selected variables
newark_ward_wide_selected_2023 <- newark_ward_wide_2023 %>%
  select(any_of(selected_variables_2023))

# List of selected variables with 2022 data
selected_variables_2022 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2022", "median_gross_rent_2022", "median_hh_income_2022", 
  "poverty_level_2022", "gini_index_2022", "highschool_dropout_2022", 
  "foreign_born_population_2022", "hisp_race_2022", "self_employed_not_incorporated_2022",
  "total_population_2022", "median_age_2022", "households_receiving_assistance_2022",
  "nonfamily_households_2022", "family_households_2022",
  
  # Market Dynamics
  "affordable_rents_2022", "high_rents_2022", "occupancy_permits_2022",
  "total_housing_units_2022", "total_occupied_units_2022", "units_built_2000_2009_2022",
  "public_transit_users_2022", "no_vehicle_households_2022", "median_home_value_2022",
  
  # "Gentrifier" Population
  "owner_occupied_units_2022", "renter_occupied_units_2022", "owner_occupied_pct_2022", "non_hispanic_white_2022", 
  "bachelor_degree_or_higher_2022", "employment_industry_2022", 
  "female_median_age_2022", "male_median_age_2022", "remote_workers_2022",
  "service_industry_2022", "mgmt_business_sc_arts_industry_2022",
  
  # Race & Ethnicity
  "white_NH_race_2022", "black_NH_race_2022", "asian_NH_race_2022", "hisp_race_2022"
)

# Create new data frame with only selected variables for 2022
newark_ward_wide_selected_2022 <- newark_ward_wide_2022 %>%
  select(any_of(selected_variables_2022))

# List of selected variables with 2021 data
selected_variables_2021 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2021", "median_gross_rent_2021", "median_hh_income_2021", 
  "poverty_level_2021", "gini_index_2021", "highschool_dropout_2021", 
  "foreign_born_population_2021", "hisp_race_2021", "self_employed_not_incorporated_2021",
  "total_population_2021", "median_age_2021", "households_receiving_assistance_2021",
  "nonfamily_households_2021", "family_households_2021",
  
  # Market Dynamics
  "affordable_rents_2021", "high_rents_2021", "occupancy_permits_2021",
  "total_housing_units_2021", "total_occupied_units_2021", "units_built_2000_2009_2021",
  "public_transit_users_2021", "no_vehicle_households_2021", "median_home_value_2021",
  
  # "Gentrifier" Population
  "owner_occupied_units_2021", "renter_occupied_units_2021", "owner_occupied_pct_2021", "non_hispanic_white_2021", 
  "bachelor_degree_or_higher_2021", "employment_industry_2021", 
  "female_median_age_2021", "male_median_age_2021", "remote_workers_2021",
  "service_industry_2021", "mgmt_business_sc_arts_industry_2021",
  
  # Race & Ethnicity
  "white_NH_race_2021", "black_NH_race_2021", "asian_NH_race_2021", "hisp_race_2021"
)

# Create new data frame with only selected variables for 2021
newark_ward_wide_selected_2021 <- newark_ward_wide_2021 %>%
  select(any_of(selected_variables_2021))

# List of selected variables with 2020 data
selected_variables_2020 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2020", "median_gross_rent_2020", "median_hh_income_2020", 
  "poverty_level_2020", "gini_index_2020", "highschool_dropout_2020", 
  "foreign_born_population_2020", "hisp_race_2020", "self_employed_not_incorporated_2020",
  "total_population_2020", "median_age_2020", "households_receiving_assistance_2020",
  "nonfamily_households_2020", "family_households_2020",
  
  # Market Dynamics
  "affordable_rents_2020", "high_rents_2020", "occupancy_permits_2020",
  "total_housing_units_2020", "total_occupied_units_2020", "units_built_2000_2009_2020",
  "public_transit_users_2020", "no_vehicle_households_2020", "median_home_value_2020",
  
  # "Gentrifier" Population
  "owner_occupied_units_2020", "renter_occupied_units_2020", "owner_occupied_pct_2020", "non_hispanic_white_2020", 
  "bachelor_degree_or_higher_2020", "employment_industry_2020", 
  "female_median_age_2020", "male_median_age_2020", "remote_workers_2020",
  "service_industry_2020", "mgmt_business_sc_arts_industry_2020",
  
  # Race & Ethnicity
  "white_NH_race_2020", "black_NH_race_2020", "asian_NH_race_2020", "hisp_race_2020"
)

# Create new data frame with only selected variables for 2020
newark_ward_wide_selected_2020 <- newark_ward_wide_2020 %>%
  select(any_of(selected_variables_2020))

# List of selected variables with 2019 data
selected_variables_2019 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2019", "median_gross_rent_2019", "median_hh_income_2019", 
  "poverty_level_2019", "gini_index_2019", "highschool_dropout_2019", 
  "foreign_born_population_2019", "hisp_race_2019", "self_employed_not_incorporated_2019",
  "total_population_2019", "median_age_2019", "households_receiving_assistance_2019",
  "nonfamily_households_2019", "family_households_2019",
  
  # Market Dynamics
  "affordable_rents_2019", "high_rents_2019", "occupancy_permits_2019",
  "total_housing_units_2019", "total_occupied_units_2019", "units_built_2000_2009_2019",
  "public_transit_users_2019", "no_vehicle_households_2019", "median_home_value_2019",
  
  # "Gentrifier" Population
  "owner_occupied_units_2019", "renter_occupied_units_2019", "owner_occupied_pct_2019", "non_hispanic_white_2019", 
  "bachelor_degree_or_higher_2019", "employment_industry_2019", 
  "female_median_age_2019", "male_median_age_2019", "remote_workers_2019",
  "service_industry_2019", "mgmt_business_sc_arts_industry_2019",
  
  # Race & Ethnicity
  "white_NH_race_2019", "black_NH_race_2019", "asian_NH_race_2019", "hisp_race_2019"
)

# Create new data frame with only selected variables for 2019
newark_ward_wide_selected_2019 <- newark_ward_wide_2019 %>%
  select(any_of(selected_variables_2019))

# List of selected variables with 2018 data
selected_variables_2018 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2018", "median_gross_rent_2018", "median_hh_income_2018", 
  "poverty_level_2018", "gini_index_2018", "highschool_dropout_2018", 
  "foreign_born_population_2018", "hisp_race_2018", "self_employed_not_incorporated_2018",
  "total_population_2018", "median_age_2018", "households_receiving_assistance_2018",
  "nonfamily_households_2018", "family_households_2018",
  
  # Market Dynamics
  "affordable_rents_2018", "high_rents_2018", "occupancy_permits_2018",
  "total_housing_units_2018", "total_occupied_units_2018", "units_built_2000_2009_2018",
  "public_transit_users_2018", "no_vehicle_households_2018", "median_home_value_2018",
  
  # "Gentrifier" Population
  "owner_occupied_units_2018", "renter_occupied_units_2018", "owner_occupied_pct_2018", "non_hispanic_white_2018", 
  "bachelor_degree_or_higher_2018", "employment_industry_2018", 
  "female_median_age_2018", "male_median_age_2018", "remote_workers_2018",
  "service_industry_2018", "mgmt_business_sc_arts_industry_2018",
  
  # Race & Ethnicity
  "white_NH_race_2018", "black_NH_race_2018", "asian_NH_race_2018", "hisp_race_2018"
)

# Create new data frame with only selected variables for 2018
newark_ward_wide_selected_2018 <- newark_ward_wide_2018 %>%
  select(any_of(selected_variables_2018))

# List of selected variables with 2017 data
selected_variables_2017 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2017", "median_gross_rent_2017", "median_hh_income_2017", 
  "poverty_level_2017", "gini_index_2017", "highschool_dropout_2017", 
  "foreign_born_population_2017", "hisp_race_2017", "self_employed_not_incorporated_2017",
  "total_population_2017", "median_age_2017", "households_receiving_assistance_2017",
  "nonfamily_households_2017", "family_households_2017",
  
  # Market Dynamics
  "affordable_rents_2017", "high_rents_2017", "occupancy_permits_2017",
  "total_housing_units_2017", "total_occupied_units_2017", "units_built_2000_2009_2017",
  "public_transit_users_2017", "no_vehicle_households_2017", "median_home_value_2017",
  
  # "Gentrifier" Population
  "owner_occupied_units_2017", "renter_occupied_units_2017", "owner_occupied_pct_2017", "non_hispanic_white_2017", 
  "bachelor_degree_or_higher_2017", "employment_industry_2017", 
  "female_median_age_2017", "male_median_age_2017", "remote_workers_2017",
  "service_industry_2017", "mgmt_business_sc_arts_industry_2017",
  
  # Race & Ethnicity
  "white_NH_race_2017", "black_NH_race_2017", "asian_NH_race_2017", "hisp_race_2017"
)

# Create new data frame with only selected variables for 2017
newark_ward_wide_selected_2017 <- newark_ward_wide_2017 %>%
  select(any_of(selected_variables_2017))

# List of selected variables with 2016 data
selected_variables_2016 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2016", "median_gross_rent_2016", "median_hh_income_2016", 
  "poverty_level_2016", "gini_index_2016", "highschool_dropout_2016", 
  "foreign_born_population_2016", "hisp_race_2016", "self_employed_not_incorporated_2016",
  "total_population_2016", "median_age_2016", "households_receiving_assistance_2016",
  "nonfamily_households_2016", "family_households_2016",
  
  # Market Dynamics
  "affordable_rents_2016", "high_rents_2016", "occupancy_permits_2016",
  "total_housing_units_2016", "total_occupied_units_2016", "units_built_2000_2009_2016",
  "public_transit_users_2016", "no_vehicle_households_2016", "median_home_value_2016",
  
  # "Gentrifier" Population
  "owner_occupied_units_2016", "renter_occupied_units_2016", "owner_occupied_pct_2016", "non_hispanic_white_2016", 
  "bachelor_degree_or_higher_2016", "employment_industry_2016", 
  "female_median_age_2016", "male_median_age_2016", "remote_workers_2016",
  "service_industry_2016", "mgmt_business_sc_arts_industry_2016",
  
  # Race & Ethnicity
  "white_NH_race_2016", "black_NH_race_2016", "asian_NH_race_2016", "hisp_race_2016"
)

# Create new data frame with only selected variables for 2016
newark_ward_wide_selected_2016 <- newark_ward_wide_2016 %>%
  select(any_of(selected_variables_2016))

# List of selected variables with 2015 data
selected_variables_2015 <- c(
  "Ward",
  # Vulnerability
  "rent_burden_50plus_2015", "median_gross_rent_2015", "median_hh_income_2015", 
  "poverty_level_2015", "gini_index_2015", "highschool_dropout_2015", 
  "foreign_born_population_2015", "hisp_race_2015", "self_employed_not_incorporated_2015",
  "total_population_2015", "median_age_2015", "households_receiving_assistance_2015",
  "nonfamily_households_2015", "family_households_2015",
  
  # Market Dynamics
  "affordable_rents_2015", "high_rents_2015", "occupancy_permits_2015",
  "total_housing_units_2015", "total_occupied_units_2015", "units_built_2000_2009_2015",
  "public_transit_users_2015", "no_vehicle_households_2015", "median_home_value_2015",
  
  # "Gentrifier" Population
  "owner_occupied_units_2015", "renter_occupied_units_2015", "owner_occupied_pct_2015", "non_hispanic_white_2015", 
  "bachelor_degree_or_higher_2015", "employment_industry_2015", 
  "female_median_age_2015", "male_median_age_2015", "remote_workers_2015",
  "service_industry_2015", "mgmt_business_sc_arts_industry_2015",
  
  # Race & Ethnicity
  "white_NH_race_2015", "black_NH_race_2015", "asian_NH_race_2015", "hisp_race_2015"
)

# Create new data frame with only selected variables for 2015
newark_ward_wide_selected_2015 <- newark_ward_wide_2015 %>%
  select(any_of(selected_variables_2015))


```


```{r ward datasets, warning=FALSE, message=FALSE, results='hide'}

# Merge all years into one dataset with Ward as the key
ward_rent_burden_50plus <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, rent_burden_50plus_2015),
                                newark_ward_wide_selected_2016 %>% select(Ward, rent_burden_50plus_2016),
                                by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, rent_burden_50plus_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, rent_burden_50plus_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, rent_burden_50plus_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, rent_burden_50plus_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, rent_burden_50plus_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, rent_burden_50plus_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, rent_burden_50plus_2023), by = "Ward")

ward_median_gross_rent <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, median_gross_rent_2015),
                             newark_ward_wide_selected_2016 %>% select(Ward, median_gross_rent_2016),
                             by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, median_gross_rent_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, median_gross_rent_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, median_gross_rent_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, median_gross_rent_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, median_gross_rent_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, median_gross_rent_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, median_gross_rent_2023), by = "Ward")

ward_median_hh_income <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, median_hh_income_2015),
                            newark_ward_wide_selected_2016 %>% select(Ward, median_hh_income_2016),
                            by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, median_hh_income_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, median_hh_income_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, median_hh_income_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, median_hh_income_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, median_hh_income_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, median_hh_income_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, median_hh_income_2023), by = "Ward")

ward_poverty_level <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, poverty_level_2015),
                         newark_ward_wide_selected_2016 %>% select(Ward, poverty_level_2016),
                         by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, poverty_level_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, poverty_level_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, poverty_level_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, poverty_level_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, poverty_level_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, poverty_level_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, poverty_level_2023), by = "Ward")


ward_gini_index <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, gini_index_2015),                       
                       newark_ward_wide_selected_2016 %>% select(Ward, gini_index_2016),                       
                       by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, gini_index_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, gini_index_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, gini_index_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, gini_index_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, gini_index_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, gini_index_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, gini_index_2023), by = "Ward")


ward_highschool_dropout <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, highschool_dropout_2015),
                              newark_ward_wide_selected_2016 %>% select(Ward, highschool_dropout_2016),
                              by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, highschool_dropout_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, highschool_dropout_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, highschool_dropout_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, highschool_dropout_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, highschool_dropout_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, highschool_dropout_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, highschool_dropout_2023), by = "Ward")


ward_foreign_born_population <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, foreign_born_population_2015),
                                   newark_ward_wide_selected_2016 %>% select(Ward, foreign_born_population_2016),
                                   by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, foreign_born_population_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, foreign_born_population_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, foreign_born_population_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, foreign_born_population_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, foreign_born_population_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, foreign_born_population_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, foreign_born_population_2023), by = "Ward")


ward_hisp_race <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, hisp_race_2015),
                      newark_ward_wide_selected_2016 %>% select(Ward, hisp_race_2016),
                      by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, hisp_race_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, hisp_race_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, hisp_race_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, hisp_race_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, hisp_race_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, hisp_race_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, hisp_race_2023), by = "Ward")


ward_self_employed_not_incorporated <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, self_employed_not_incorporated_2015),
                                          newark_ward_wide_selected_2016 %>% select(Ward, self_employed_not_incorporated_2016),
                                          by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, self_employed_not_incorporated_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, self_employed_not_incorporated_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, self_employed_not_incorporated_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, self_employed_not_incorporated_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, self_employed_not_incorporated_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, self_employed_not_incorporated_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, self_employed_not_incorporated_2023), by = "Ward")


ward_total_population <- full_join(newark_ward_wide_selected_2015 %>% select(Ward, total_population_2015),
                            newark_ward_wide_selected_2016 %>% select(Ward, total_population_2016),
                            by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, total_population_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, total_population_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, total_population_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, total_population_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, total_population_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, total_population_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, total_population_2023), by = "Ward")


ward_median_age <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, median_age_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, median_age_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, median_age_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, median_age_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, median_age_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, median_age_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, median_age_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, median_age_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, median_age_2023), by = "Ward")


ward_households_receiving_assistance <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, households_receiving_assistance_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, households_receiving_assistance_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, households_receiving_assistance_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, households_receiving_assistance_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, households_receiving_assistance_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, households_receiving_assistance_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, households_receiving_assistance_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, households_receiving_assistance_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, households_receiving_assistance_2023), by = "Ward")


ward_nonfamily_households <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, nonfamily_households_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, nonfamily_households_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, nonfamily_households_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, nonfamily_households_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, nonfamily_households_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, nonfamily_households_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, nonfamily_households_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, nonfamily_households_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, nonfamily_households_2023), by = "Ward")


ward_family_households <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, family_households_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, family_households_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, family_households_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, family_households_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, family_households_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, family_households_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, family_households_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, family_households_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, family_households_2023), by = "Ward")


ward_total_housing_units <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, total_housing_units_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, total_housing_units_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, total_housing_units_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, total_housing_units_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, total_housing_units_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, total_housing_units_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, total_housing_units_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, total_housing_units_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, total_housing_units_2023), by = "Ward")


ward_total_occupied_units <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, total_occupied_units_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, total_occupied_units_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, total_occupied_units_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, total_occupied_units_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, total_occupied_units_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, total_occupied_units_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, total_occupied_units_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, total_occupied_units_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, total_occupied_units_2023), by = "Ward")


ward_public_transit_users <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, public_transit_users_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, public_transit_users_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, public_transit_users_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, public_transit_users_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, public_transit_users_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, public_transit_users_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, public_transit_users_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, public_transit_users_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, public_transit_users_2023), by = "Ward")


ward_no_vehicle_households <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, no_vehicle_households_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, no_vehicle_households_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, no_vehicle_households_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, no_vehicle_households_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, no_vehicle_households_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, no_vehicle_households_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, no_vehicle_households_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, no_vehicle_households_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, no_vehicle_households_2023), by = "Ward")


ward_median_home_value <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, median_home_value_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, median_home_value_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, median_home_value_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, median_home_value_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, median_home_value_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, median_home_value_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, median_home_value_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, median_home_value_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, median_home_value_2023), by = "Ward")


ward_owner_occupied_units <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, owner_occupied_units_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, owner_occupied_units_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, owner_occupied_units_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, owner_occupied_units_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, owner_occupied_units_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, owner_occupied_units_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, owner_occupied_units_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, owner_occupied_units_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, owner_occupied_units_2023), by = "Ward")

ward_renter_occupied_units <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, renter_occupied_units_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, renter_occupied_units_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, renter_occupied_units_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, renter_occupied_units_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, renter_occupied_units_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, renter_occupied_units_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, renter_occupied_units_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, renter_occupied_units_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, renter_occupied_units_2023), by = "Ward")


ward_bachelor_degree_or_higher <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, bachelor_degree_or_higher_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, bachelor_degree_or_higher_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, bachelor_degree_or_higher_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, bachelor_degree_or_higher_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, bachelor_degree_or_higher_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, bachelor_degree_or_higher_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, bachelor_degree_or_higher_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, bachelor_degree_or_higher_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, bachelor_degree_or_higher_2023), by = "Ward")


ward_employment_industry <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, employment_industry_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, employment_industry_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, employment_industry_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, employment_industry_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, employment_industry_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, employment_industry_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, employment_industry_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, employment_industry_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, employment_industry_2023), by = "Ward")


ward_remote_workers <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, remote_workers_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, remote_workers_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, remote_workers_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, remote_workers_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, remote_workers_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, remote_workers_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, remote_workers_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, remote_workers_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, remote_workers_2023), by = "Ward")


ward_service_industry <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, service_industry_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, service_industry_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, service_industry_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, service_industry_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, service_industry_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, service_industry_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, service_industry_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, service_industry_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, service_industry_2023), by = "Ward")


ward_mgmt_business_sc_arts_industry <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, mgmt_business_sc_arts_industry_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, mgmt_business_sc_arts_industry_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, mgmt_business_sc_arts_industry_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, mgmt_business_sc_arts_industry_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, mgmt_business_sc_arts_industry_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, mgmt_business_sc_arts_industry_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, mgmt_business_sc_arts_industry_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, mgmt_business_sc_arts_industry_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, mgmt_business_sc_arts_industry_2023), by = "Ward")


ward_white_NH_race <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, white_NH_race_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, white_NH_race_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, white_NH_race_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, white_NH_race_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, white_NH_race_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, white_NH_race_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, white_NH_race_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, white_NH_race_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, white_NH_race_2023), by = "Ward")


ward_black_NH_race <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, black_NH_race_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, black_NH_race_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, black_NH_race_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, black_NH_race_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, black_NH_race_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, black_NH_race_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, black_NH_race_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, black_NH_race_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, black_NH_race_2023), by = "Ward")


ward_asian_NH_race <- full_join(
  newark_ward_wide_selected_2015 %>% select(Ward, asian_NH_race_2015),
  newark_ward_wide_selected_2016 %>% select(Ward, asian_NH_race_2016),
  by = "Ward") %>%
  full_join(newark_ward_wide_selected_2017 %>% select(Ward, asian_NH_race_2017), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2018 %>% select(Ward, asian_NH_race_2018), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2019 %>% select(Ward, asian_NH_race_2019), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2020 %>% select(Ward, asian_NH_race_2020), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2021 %>% select(Ward, asian_NH_race_2021), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2022 %>% select(Ward, asian_NH_race_2022), by = "Ward") %>%
  full_join(newark_ward_wide_selected_2023 %>% select(Ward, asian_NH_race_2023), by = "Ward")


```

```{r ward plots, warning=FALSE, message=FALSE, results='hide'}

# Median Age
# Reshape the wide-format dataset to long format
median_age_longward <- ward_median_age %>%
  pivot_longer(cols = starts_with("median_age"), 
               names_to = "Year", 
               values_to = "Median_Age") %>%
  mutate(Year = gsub("median_age_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
median_age_longward$Year <- as.numeric(median_age_longward$Year)

# Plot median age over the years for each ward
ward_median_age_plot <- ggplot(median_age_longward, aes(x = Year, y = Median_Age, color = Ward, group = Ward)) +
  geom_line() +  # Draw lines for each ward
  labs(title = "Median Age Over the Years by Ward",
       x = "Year",
       y = "Median Age",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right")  # Display legend on the right

ggsave("ward_median_age.png", plot = ward_median_age_plot, width = 10, height = 6, dpi = 300)

# Rent Burden 50Plus
# Reshape the wide-format dataset to long format
rent_burden_50plus_longward <- ward_rent_burden_50plus %>%
  pivot_longer(cols = starts_with("rent_burden_50plus"), 
               names_to = "Year", 
               values_to = "Rent_Burden_50plus") %>%
  mutate(Year = gsub("rent_burden_50plus_", "", Year))  # Clean year names to remove prefix

# Convert Year to numeric for better plotting
rent_burden_50plus_longward$Year <- as.numeric(rent_burden_50plus_longward$Year)

# Plot rent burdened households over the years for each ward
ward_rent_burden_50plus_plot <- ggplot(rent_burden_50plus_longward, aes(x = Year, y = Rent_Burden_50plus, color = Ward, group = Ward)) +
  geom_line() +  
  labs(title = "Extreme Rent Burdened Households Over the Years by Ward",
       x = "Year",
       y = "Rent Burden (50%)",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_rent_burden_50plus.png", plot = ward_rent_burden_50plus_plot, width = 10, height = 6, dpi = 300)

# Median Gross Rent
median_gross_rent_longward <- ward_median_gross_rent %>%
  pivot_longer(cols = starts_with("median_gross_rent"), 
               names_to = "Year", 
               values_to = "Median_Gross_Rent") %>%
  mutate(Year = gsub("median_gross_rent_", "", Year))

median_gross_rent_longward$Year <- as.numeric(median_gross_rent_longward$Year)

ward_median_gross_rent_plot <- ggplot(median_gross_rent_longward, aes(x = Year, y = Median_Gross_Rent, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Median Gross Rent Over the Years by Ward",
       x = "Year",
       y = "Median Gross Rent",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_median_gross_rent.png", plot = ward_median_gross_rent_plot, width = 10, height = 6, dpi = 300)

# Median Household Income
median_hh_income_longward <- ward_median_hh_income %>%
  pivot_longer(cols = starts_with("median_hh_income"), 
               names_to = "Year", 
               values_to = "Median_HH_Income") %>%
  mutate(Year = gsub("median_hh_income_", "", Year))

median_hh_income_longward$Year <- as.numeric(median_hh_income_longward$Year)

ward_median_hh_income_plot <- ggplot(median_hh_income_longward, aes(x = Year, y = Median_HH_Income, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Median Household Income Over the Years by Ward",
       x = "Year",
       y = "Median Household Income",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_median_hh_income.png", plot = ward_median_hh_income_plot, width = 10, height = 6, dpi = 300)

# Poverty Level
poverty_level_longward <- ward_poverty_level %>%
  pivot_longer(cols = starts_with("poverty_level"), 
               names_to = "Year", 
               values_to = "Poverty_Level") %>%
  mutate(Year = gsub("poverty_level_", "", Year))

poverty_level_longward$Year <- as.numeric(poverty_level_longward$Year)

ward_poverty_level_plot <- ggplot(poverty_level_longward, aes(x = Year, y = Poverty_Level, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Poverty Level Over the Years by Ward",
       x = "Year",
       y = "Poverty Level",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_poverty_level.png", plot = ward_poverty_level_plot, width = 10, height = 6, dpi = 300)

# Gini Index
gini_index_longward <- ward_gini_index %>%
  pivot_longer(cols = starts_with("gini_index"), 
               names_to = "Year", 
               values_to = "Gini_Index") %>%
  mutate(Year = gsub("gini_index_", "", Year))

gini_index_longward$Year <- as.numeric(gini_index_longward$Year)

ward_gini_index_plot <- ggplot(gini_index_longward, aes(x = Year, y = Gini_Index, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Gini Index Over the Years by Ward",
       x = "Year",
       y = "Gini Index",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_gini_index.png", plot = ward_gini_index_plot, width = 10, height = 6, dpi = 300)

# Highschool Dropout
highschool_dropout_longward <- ward_highschool_dropout %>%
  pivot_longer(cols = starts_with("highschool_dropout"), 
               names_to = "Year", 
               values_to = "Highschool_Dropout") %>%
  mutate(Year = gsub("highschool_dropout_", "", Year))

highschool_dropout_longward$Year <- as.numeric(highschool_dropout_longward$Year)

ward_highschool_dropout_plot <- ggplot(highschool_dropout_longward, aes(x = Year, y = Highschool_Dropout, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "High School Dropout Rate Over the Years by Ward",
       x = "Year",
       y = "High School Dropout Rate",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_highschool_dropout.png", plot = ward_highschool_dropout_plot, width = 10, height = 6, dpi = 300)

# Foreign-born Population
foreign_born_population_longward <- ward_foreign_born_population %>%
  pivot_longer(cols = starts_with("foreign_born_population"), 
               names_to = "Year", 
               values_to = "Foreign_Born_Population") %>%
  mutate(Year = gsub("foreign_born_population_", "", Year))

foreign_born_population_longward$Year <- as.numeric(foreign_born_population_longward$Year)

ward_foreign_born_population_plot <- ggplot(foreign_born_population_longward, aes(x = Year, y = Foreign_Born_Population, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Foreign-Born Population Over the Years by Ward",
       x = "Year",
       y = "Foreign-Born Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_foreign_born_population.png", plot = ward_foreign_born_population_plot, width = 10, height = 6, dpi = 300)

# Hispanic Race
hisp_race_longward <- ward_hisp_race %>%
  pivot_longer(cols = starts_with("hisp_race"), 
               names_to = "Year", 
               values_to = "Hispanic_Race_Population") %>%
  mutate(Year = gsub("hisp_race_", "", Year))

hisp_race_longward$Year <- as.numeric(hisp_race_longward$Year)

ward_hisp_race_plot <- ggplot(hisp_race_longward, aes(x = Year, y = Hispanic_Race_Population, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Hispanic Race Population Over the Years by Ward",
       x = "Year",
       y = "Hispanic Race Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_hisp_race.png", plot = ward_hisp_race_plot, width = 10, height = 6, dpi = 300)

# Self-employed Not Incorporated
self_employed_not_incorporated_longward <- ward_self_employed_not_incorporated %>%
  pivot_longer(cols = starts_with("self_employed_not_incorporated"), 
               names_to = "Year", 
               values_to = "Self_Employed_Not_Incorporated") %>%
  mutate(Year = gsub("self_employed_not_incorporated_", "", Year)) 

self_employed_not_incorporated_longward$Year <- as.numeric(self_employed_not_incorporated_longward$Year)

ward_self_employed_not_incorporated_plot <- ggplot(self_employed_not_incorporated_longward, aes(x = Year, y = Self_Employed_Not_Incorporated, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Self-Employed Non-Incorporated Population Over the Years by Ward",
       x = "Year",
       y = "Self-Employed Non-Incorporated Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_self_employed_not_incorporated.png", plot = ward_self_employed_not_incorporated_plot, width = 10, height = 6, dpi = 300)

# Total Population
total_population_longward <- ward_total_population %>%
  pivot_longer(cols = starts_with("total_population"), 
               names_to = "Year", 
               values_to = "Total_Population") %>%
  mutate(Year = gsub("total_population_", "", Year))

total_population_longward$Year <- as.numeric(total_population_longward$Year)

ward_total_population_plot <- ggplot(total_population_longward, aes(x = Year, y = Total_Population, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Total Population Over the Years by Ward",
       x = "Year",
       y = "Total Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_total_population.png", plot = ward_total_population_plot, width = 10, height = 6, dpi = 300)

# Households Receiving Assistance
households_receiving_assistance_longward <- ward_households_receiving_assistance %>%
  pivot_longer(cols = starts_with("households_receiving_assistance"), 
               names_to = "Year", 
               values_to = "Households_Receiving_Assistance") %>%
  mutate(Year = gsub("households_receiving_assistance_", "", Year))

households_receiving_assistance_longward$Year <- as.numeric(households_receiving_assistance_longward$Year)

ward_households_receiving_assistance_plot <- ggplot(households_receiving_assistance_longward, aes(x = Year, y = Households_Receiving_Assistance, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Households Receiving Assistance Over the Years by Ward",
       x = "Year",
       y = "Households Receiving Assistance",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_households_receiving_assistance.png", plot = ward_households_receiving_assistance_plot, width = 10, height = 6, dpi = 300)

# Non-family Households
nonfamily_households_longward <- ward_nonfamily_households %>%
  pivot_longer(cols = starts_with("nonfamily_households"), 
               names_to = "Year", 
               values_to = "Nonfamily_Households") %>%
  mutate(Year = gsub("nonfamily_households_", "", Year))

nonfamily_households_longward$Year <- as.numeric(nonfamily_households_longward$Year)

ward_nonfamily_households_plot <- ggplot(nonfamily_households_longward, aes(x = Year, y = Nonfamily_Households, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Non-Family Households Over the Years by Ward",
       x = "Year",
       y = "Non-Family Households",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_nonfamily_households.png", plot = ward_nonfamily_households_plot, width = 10, height = 6, dpi = 300)

# Family Households
family_households_longward <- ward_family_households %>%
  pivot_longer(cols = starts_with("family_households"), 
               names_to = "Year", 
               values_to = "Family_Households") %>%
  mutate(Year = gsub("family_households_", "", Year))

family_households_longward$Year <- as.numeric(family_households_longward$Year)

ward_family_households_plot <- ggplot(family_households_longward, aes(x = Year, y = Family_Households, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Family Households Over the Years by Ward",
       x = "Year",
       y = "Family Households",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_family_households.png", plot = ward_family_households_plot, width = 10, height = 6, dpi = 300)

# Total Housing Units
total_housing_units_longward <- ward_total_housing_units %>%
  pivot_longer(cols = starts_with("total_housing_units"), 
               names_to = "Year", 
               values_to = "Total_Housing_Units") %>%
  mutate(Year = gsub("total_housing_units_", "", Year))

total_housing_units_longward$Year <- as.numeric(total_housing_units_longward$Year)


ward_total_housing_units_plot <- ggplot(total_housing_units_longward, aes(x = Year, y = Total_Housing_Units, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Total Housing Units Over the Years by Ward",
       x = "Year",
       y = "Total Housing Units",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_total_housing_units.png", plot = ward_total_housing_units_plot, width = 10, height = 6, dpi = 300)

# Total Occupied Units
total_occupied_units_longward <- ward_total_occupied_units %>%
  pivot_longer(cols = starts_with("total_occupied_units"), 
               names_to = "Year", 
               values_to = "Total_Occupied_Units") %>%
  mutate(Year = gsub("total_occupied_units_", "", Year))

total_occupied_units_longward$Year <- as.numeric(total_occupied_units_longward$Year)

ward_total_occupied_units_plot <- ggplot(total_occupied_units_longward, aes(x = Year, y = Total_Occupied_Units, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Total Occupied Units Over the Years by Ward",
       x = "Year",
       y = "Total Occupied Units",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_total_occupied_units.png", plot = ward_total_occupied_units_plot, width = 10, height = 6, dpi = 300)

# Public Transit Users
public_transit_users_longward <- ward_public_transit_users %>%
  pivot_longer(cols = starts_with("public_transit_users"), 
               names_to = "Year", 
               values_to = "Public_Transit_Users") %>%
  mutate(Year = gsub("public_transit_users_", "", Year))

public_transit_users_longward$Year <- as.numeric(public_transit_users_longward$Year)

ward_public_transit_users_plot <- ggplot(public_transit_users_longward, aes(x = Year, y = Public_Transit_Users, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Public Transit Users Over the Years by Ward",
       x = "Year",
       y = "Public Transit Users",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_public_transit_users.png", plot = ward_public_transit_users_plot, width = 10, height = 6, dpi = 300)

# No Vehicle Households
no_vehicle_households_longward <- ward_no_vehicle_households %>%
  pivot_longer(cols = starts_with("no_vehicle_households"), 
               names_to = "Year", 
               values_to = "No_Vehicle_Households") %>%
  mutate(Year = gsub("no_vehicle_households_", "", Year))

no_vehicle_households_longward$Year <- as.numeric(no_vehicle_households_longward$Year)

ward_no_vehicle_households_plot <- ggplot(no_vehicle_households_longward, aes(x = Year, y = No_Vehicle_Households, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Households with No Vehicle Over the Years by Ward",
       x = "Year",
       y = "Households with No Vehicle",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_no_vehicle_households.png", plot = ward_no_vehicle_households_plot, width = 10, height = 6, dpi = 300)

# Median Home Value
median_home_value_longward <- ward_median_home_value %>%
  pivot_longer(cols = starts_with("median_home_value"), 
               names_to = "Year", 
               values_to = "Median_Home_Value") %>%
  mutate(Year = gsub("median_home_value_", "", Year))

median_home_value_longward$Year <- as.numeric(median_home_value_longward$Year)

ward_median_home_value_plot <- ggplot(median_home_value_longward, aes(x = Year, y = Median_Home_Value, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Median Home Value Over the Years by Ward",
       x = "Year",
       y = "Median Home Value",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_median_home_value.png", plot = ward_median_home_value_plot, width = 10, height = 6, dpi = 300)

# Owner Occupied Units
owner_occupied_units_longward <- ward_owner_occupied_units %>%
  pivot_longer(cols = starts_with("owner_occupied_units"), 
               names_to = "Year", 
               values_to = "Owner_Occupied_Units") %>%
  mutate(Year = gsub("owner_occupied_units_", "", Year))

owner_occupied_units_longward$Year <- as.numeric(owner_occupied_units_longward$Year)

ward_owner_occupied_units_plot <- ggplot(owner_occupied_units_longward, aes(x = Year, y = Owner_Occupied_Units, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Owner-Occupied Units Over the Years by Ward",
       x = "Year",
       y = "Owner-Occupied Units",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_owner_occupied_units.png", plot = ward_owner_occupied_units_plot, width = 10, height = 6, dpi = 300)

# Renter Occupied Units
renter_occupied_units_longward <- ward_renter_occupied_units %>%
  pivot_longer(cols = starts_with("renter_occupied_units"), 
               names_to = "Year", 
               values_to = "Renter_Occupied_Units") %>%
  mutate(Year = gsub("renter_occupied_units_", "", Year))

renter_occupied_units_longward$Year <- as.numeric(renter_occupied_units_longward$Year)

ward_renter_occupied_units_plot <- ggplot(renter_occupied_units_longward, aes(x = Year, y = Renter_Occupied_Units, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Renter-Occupied Units Over the Years by Ward",
       x = "Year",
       y = "Renter-Occupied Units",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_renter_occupied_units.png", plot = ward_renter_occupied_units_plot, width = 10, height = 6, dpi = 300)

# Bachelor's Degree or Higher
bachelor_degree_or_higher_longward <- ward_bachelor_degree_or_higher %>%
  pivot_longer(cols = starts_with("bachelor_degree_or_higher"), 
               names_to = "Year", 
               values_to = "Bachelors_Degree_or_Higher") %>%
  mutate(Year = gsub("bachelor_degree_or_higher_", "", Year))

bachelor_degree_or_higher_longward$Year <- as.numeric(bachelor_degree_or_higher_longward$Year)

ward_bachelor_degree_or_higher_plot <- ggplot(bachelor_degree_or_higher_longward, aes(x = Year, y = Bachelors_Degree_or_Higher, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Bachelor's Degree or Higher Over the Years by Ward",
       x = "Year",
       y = "Bachelor's Degree or Higher Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_bachelor_degree_or_higher.png", plot = ward_bachelor_degree_or_higher_plot, width = 10, height = 6, dpi = 300)

# Remote Workers
remote_workers_longward <- ward_remote_workers %>%
  pivot_longer(cols = starts_with("remote_workers"), 
               names_to = "Year", 
               values_to = "Remote_Workers") %>%
  mutate(Year = gsub("remote_workers_", "", Year))

remote_workers_longward$Year <- as.numeric(remote_workers_longward$Year)

ward_remote_workers_plot <- ggplot(remote_workers_longward, aes(x = Year, y = Remote_Workers, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Remote Workers Over the Years by Ward",
       x = "Year",
       y = "Remote Workers",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_remote_workers.png", plot = ward_remote_workers_plot, width = 10, height = 6, dpi = 300)

# Service Industry
service_industry_longward <- ward_service_industry %>%
  pivot_longer(cols = starts_with("service_industry"), 
               names_to = "Year", 
               values_to = "Service_Industry") %>%
  mutate(Year = gsub("service_industry_", "", Year))

service_industry_longward$Year <- as.numeric(service_industry_longward$Year)

ward_service_industry_plot <- ggplot(service_industry_longward, aes(x = Year, y = Service_Industry, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Service Industry Employment Over the Years by Ward",
       x = "Year",
       y = "Service Industry Employment",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_service_industry.png", plot = ward_service_industry_plot, width = 10, height = 6, dpi = 300)

# Management, Business, Science, Arts Industry
mgmt_business_sc_arts_industry_longward <- ward_mgmt_business_sc_arts_industry %>%
  pivot_longer(cols = starts_with("mgmt_business_sc_arts_industry"), 
               names_to = "Year", 
               values_to = "Mgmt_Business_Sc_Arts_Industry") %>%
  mutate(Year = gsub("mgmt_business_sc_arts_industry_", "", Year))

mgmt_business_sc_arts_industry_longward$Year <- as.numeric(mgmt_business_sc_arts_industry_longward$Year)

ward_mgmt_business_sc_arts_industry_plot <- ggplot(mgmt_business_sc_arts_industry_longward, aes(x = Year, y = Mgmt_Business_Sc_Arts_Industry, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Management, Business, Science, and Arts Industry Employment Over the Years by Ward",
       x = "Year",
       y = "Mgmt, Business, Science, and Arts Industry Employment",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_mgmt_business_sc_arts_industry.png", plot = ward_mgmt_business_sc_arts_industry_plot, width = 10, height = 6, dpi = 300)

# White Population
white_NH_race_longward <- ward_white_NH_race %>%
  pivot_longer(cols = starts_with("white_NH_race"), 
               names_to = "Year", 
               values_to = "White_NH_Race") %>%
  mutate(Year = gsub("white_NH_race_", "", Year))

white_NH_race_longward$Year <- as.numeric(white_NH_race_longward$Year)

ward_white_NH_race_plot <- ggplot(white_NH_race_longward, aes(x = Year, y = White_NH_Race, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "White Non-Hispanic Population Over the Years by Ward",
       x = "Year",
       y = "White Non-Hispanic Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_white_NH_race.png", plot = ward_white_NH_race_plot, width = 10, height = 6, dpi = 300)

# Black Population
black_NH_race_longward <- ward_black_NH_race %>%
  pivot_longer(cols = starts_with("black_NH_race"), 
               names_to = "Year", 
               values_to = "Black_NH_Race") %>%
  mutate(Year = gsub("black_NH_race_", "", Year))

black_NH_race_longward$Year <- as.numeric(black_NH_race_longward$Year)

ward_black_NH_race_plot <- ggplot(black_NH_race_longward, aes(x = Year, y = Black_NH_Race, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Black Non-Hispanic Population Over the Years by Ward",
       x = "Year",
       y = "Black Non-Hispanic Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_black_NH_race.png", plot = ward_black_NH_race_plot, width = 10, height = 6, dpi = 300)

# Asian Population
asian_NH_race_longward <- ward_asian_NH_race %>%
  pivot_longer(cols = starts_with("asian_NH_race"), 
               names_to = "Year", 
               values_to = "Asian_NH_Race") %>%
  mutate(Year = gsub("asian_NH_race_", "", Year))

asian_NH_race_longward$Year <- as.numeric(asian_NH_race_longward$Year)

ward_asian_NH_race_plot <- ggplot(asian_NH_race_longward, aes(x = Year, y = Asian_NH_Race, color = Ward, group = Ward)) +
  geom_line() +
  labs(title = "Asian Non-Hispanic Population Over the Years by Ward",
       x = "Year",
       y = "Asian Non-Hispanic Population",
       color = "Ward") +
  theme_minimal() +
  theme(legend.position = "right") 

ggsave("ward_asian_NH_race.png", plot = ward_asian_NH_race_plot, width = 10, height = 6, dpi = 300)

















```












